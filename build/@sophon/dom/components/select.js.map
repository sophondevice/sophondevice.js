{"version":3,"file":"select.js","sources":["../../../../libs/dom/src/components/select.ts"],"sourcesContent":["import {RText} from './text';\r\nimport {RElementLayoutEvent, RTextEvent, RChangeEvent} from '../events';\r\nimport {RNode} from '../node';\r\nimport {RElement} from '../element';\r\nimport type {GUI} from '../gui';\r\nimport type {IStyleSheet} from '../style';\r\n\r\nexport class Option extends RElement {\r\n  /** @internal */\r\n  private _hiddenOption: HTMLOptionElement;\r\n  constructor(uiscene: GUI) {\r\n    super(uiscene);\r\n    this._hiddenOption = document.createElement('option');\r\n  }\r\n  /** @internal */\r\n  _getHiddenOption(): HTMLOptionElement {\r\n    return this._hiddenOption;\r\n  }\r\n  /** @internal */\r\n  _getDefaultStyleSheet(): IStyleSheet {\r\n    const style = super._getDefaultStyleSheet();\r\n    style.width = '0px';\r\n    style.height = '0px';\r\n    style.backgroundColor = 'transparent';\r\n    style.display = 'none';\r\n    return style;\r\n  }\r\n  setAttribute(k: string, v?: string) {\r\n    this._hiddenOption.setAttribute(k, v || '');\r\n    super.setAttribute(k, v);\r\n  }\r\n  /** @internal */\r\n  _reparent(p: RNode, at?: RNode): RNode {\r\n    if (p.nodeType === RNode.ELEMENT_NODE && (p as RElement).tagName === 'select') {\r\n      let nextOption: RNode;\r\n      for (\r\n        nextOption = this._getNextSibling(true);\r\n        nextOption && (nextOption as RElement).tagName !== 'option';\r\n        nextOption = nextOption._getNextSibling(true)\r\n      );\r\n      if (nextOption) {\r\n        (p as Select)\r\n          ._getHiddenInput()\r\n          .insertBefore(this._hiddenOption, (nextOption as Option)._getHiddenOption());\r\n      } else {\r\n        (p as Select)._getHiddenInput().appendChild(this._hiddenOption);\r\n      }\r\n    }\r\n    return super._reparent(p, at);\r\n  }\r\n  /** @internal */\r\n  protected _remove(): RNode {\r\n    if (\r\n      this._parent &&\r\n      this._parent.nodeType === RNode.ELEMENT_NODE &&\r\n      (this._parent as RElement).tagName === 'select'\r\n    ) {\r\n      (this._parent as Select)._getHiddenInput().removeChild(this._hiddenOption);\r\n    }\r\n    return super._remove();\r\n  }\r\n  /** @internal */\r\n  _insertChild(child: RNode, index: number) {\r\n    super._insertChild(child, index);\r\n    this._hiddenOption.textContent = this.textContent;\r\n  }\r\n  /** @internal */\r\n  _removeChild(index: number) {\r\n    super._removeChild(index);\r\n    this._hiddenOption.textContent = this.textContent;\r\n  }\r\n}\r\n\r\nexport class Select extends RElement {\r\n  /** @internal */\r\n  private _hiddenInput: HTMLSelectElement;\r\n  /** @internal */\r\n  private _text: RText;\r\n  constructor(uiscene: GUI) {\r\n    super(uiscene);\r\n    this._text = new RText(this._uiscene);\r\n    this._text._setInternal();\r\n    this._text.style.backgroundColor = 'transparent';\r\n    this._text.style.flex = '1 0 auto';\r\n    this.appendChild(this._text);\r\n    this._hiddenInput = document.createElement('select');\r\n    this._hiddenInput.style.position = 'absolute';\r\n    this._hiddenInput.style.boxSizing = 'border-box';\r\n    this._hiddenInput.style.opacity = '0';\r\n    this._hiddenInput.style.outline = 'none';\r\n    this._hiddenInput.style.pointerEvents = 'none';\r\n    this._hiddenInput.style.zIndex = '0';\r\n    this._hiddenInput.style.transform = 'scaleY(0)';\r\n    this._hiddenInput.style.transformOrigin = 'top';\r\n    this._updateHiddenInput();\r\n    document.body.appendChild(this._hiddenInput);\r\n    this.addDefaultEventListener(RElementLayoutEvent.NAME, function (this: Select) {\r\n      this._updateHiddenInput();\r\n    });\r\n    this.addDefaultEventListener(RTextEvent.NAME_FONT_CHANGE, function (this: Select) {\r\n      that._updateHiddenInput();\r\n    });\r\n    const that = this;\r\n    this._hiddenInput.addEventListener('input', function () {\r\n      that._oninput();\r\n    });\r\n    this._hiddenInput.addEventListener('change', function () {\r\n      console.log(`select change: ${that._hiddenInput.value}`);\r\n      that.dispatchEvent(new RChangeEvent());\r\n    });\r\n  }\r\n  get value() {\r\n    return this._hiddenInput.value;\r\n  }\r\n  /** @internal */\r\n  private _oninput() {\r\n    this._text.textContent = this._hiddenInput.options[this._hiddenInput.selectedIndex].textContent;\r\n  }\r\n  /** @internal */\r\n  _init(): void {\r\n  }\r\n  /** @internal */\r\n  _getDefaultStyleSheet(): IStyleSheet {\r\n    const style = super._getDefaultStyleSheet();\r\n    style.width = 'auto';\r\n    style.height = 'auto';\r\n    style.color = '#000000';\r\n    style.padding = '5';\r\n    style.justifyContent = 'flex-start';\r\n    style.backgroundColor = '#fff';\r\n    style.borderWidth = '1px';\r\n    style.borderColor = '#000';\r\n    style.overflow = 'hidden';\r\n    return style;\r\n  }\r\n  /** @internal */\r\n  _getHiddenInput(): HTMLSelectElement {\r\n    return this._hiddenInput;\r\n  }\r\n  /** @internal */\r\n  _updateHiddenInput() {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    let el: any = this._uiscene.renderer.getCanvas();\r\n    const v = this.toAbsolute({x: 0, y: 0});\r\n    let t = v.y;\r\n    let l = v.x;\r\n    if (el instanceof HTMLCanvasElement) {\r\n      t += el.offsetTop;\r\n      l += el.offsetLeft;\r\n      while ((el = el.offsetParent)) {\r\n        t += el.offsetTop;\r\n        l += el.offsetLeft;\r\n      }\r\n    }\r\n    this._hiddenInput.style.transform = '';\r\n    this._hiddenInput.style.pointerEvents = 'auto';\r\n    this._hiddenInput.style.left = `${l}px`;\r\n    this._hiddenInput.style.top = `${t}px`;\r\n    this._hiddenInput.style.width = `${this.getRect().width}px`;\r\n    this._hiddenInput.style.height = `${this.getRect().height}px`;\r\n    this._hiddenInput.style.font = `${this._getCachedFont().size}px ${\r\n      this._getCachedFont().family\r\n    }`;\r\n  }\r\n  /** @internal */\r\n  _insertChild(child: RNode, index: number) {\r\n    super._insertChild(child, index);\r\n    this._text.textContent = this._hiddenInput?.options\r\n      ? this._hiddenInput.options[this._hiddenInput.selectedIndex]?.textContent\r\n      : '';\r\n  }\r\n  /** @internal */\r\n  _removeChild(index: number) {\r\n    super._removeChild(index);\r\n    this._text.textContent = this._hiddenInput?.options\r\n      ? this._hiddenInput.options[this._hiddenInput.selectedIndex]?.textContent\r\n      : '';\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}