{"version":3,"file":"select.js","sources":["../../../../libs/dom/src/components/select.ts"],"sourcesContent":["import {RText} from './text';\nimport {RElementLayoutEvent, RTextEvent, RChangeEvent} from '../events';\nimport {RNode} from '../node';\nimport {RElement} from '../element';\nimport type {GUI} from '../gui';\nimport type {IStyleSheet} from '../style';\n\nexport class Option extends RElement {\n  /** @internal */\n  private _hiddenOption: HTMLOptionElement;\n  constructor(uiscene: GUI) {\n    super(uiscene);\n    this._hiddenOption = document.createElement('option');\n  }\n  /** @internal */\n  _getHiddenOption(): HTMLOptionElement {\n    return this._hiddenOption;\n  }\n  /** @internal */\n  _getDefaultStyleSheet(): IStyleSheet {\n    const style = super._getDefaultStyleSheet();\n    style.width = '0px';\n    style.height = '0px';\n    style.backgroundColor = 'transparent';\n    style.display = 'none';\n    return style;\n  }\n  setAttribute(k: string, v?: string) {\n    this._hiddenOption.setAttribute(k, v || '');\n    super.setAttribute(k, v);\n  }\n  /** @internal */\n  _reparent(p: RNode, at?: RNode): RNode {\n    if (p.nodeType === RNode.ELEMENT_NODE && (p as RElement).tagName === 'select') {\n      let nextOption: RNode;\n      for (\n        nextOption = this._getNextSibling(true);\n        nextOption && (nextOption as RElement).tagName !== 'option';\n        nextOption = nextOption._getNextSibling(true)\n      );\n      if (nextOption) {\n        (p as Select)\n          ._getHiddenInput()\n          .insertBefore(this._hiddenOption, (nextOption as Option)._getHiddenOption());\n      } else {\n        (p as Select)._getHiddenInput().appendChild(this._hiddenOption);\n      }\n    }\n    return super._reparent(p, at);\n  }\n  /** @internal */\n  protected _remove(): RNode {\n    if (\n      this._parent &&\n      this._parent.nodeType === RNode.ELEMENT_NODE &&\n      (this._parent as RElement).tagName === 'select'\n    ) {\n      (this._parent as Select)._getHiddenInput().removeChild(this._hiddenOption);\n    }\n    return super._remove();\n  }\n  /** @internal */\n  _insertChild(child: RNode, index: number) {\n    super._insertChild(child, index);\n    this._hiddenOption.textContent = this.textContent;\n  }\n  /** @internal */\n  _removeChild(index: number) {\n    super._removeChild(index);\n    this._hiddenOption.textContent = this.textContent;\n  }\n}\n\nexport class Select extends RElement {\n  /** @internal */\n  private _hiddenInput: HTMLSelectElement;\n  /** @internal */\n  private _text: RText;\n  constructor(uiscene: GUI) {\n    super(uiscene);\n    this._text = new RText(this._uiscene);\n    this._text._setInternal();\n    this._text.style.backgroundColor = 'transparent';\n    this._text.style.flex = '1 0 auto';\n    this.appendChild(this._text);\n    this._hiddenInput = document.createElement('select');\n    this._hiddenInput.style.position = 'absolute';\n    this._hiddenInput.style.boxSizing = 'border-box';\n    this._hiddenInput.style.opacity = '0';\n    this._hiddenInput.style.outline = 'none';\n    this._hiddenInput.style.pointerEvents = 'none';\n    this._hiddenInput.style.zIndex = '0';\n    this._hiddenInput.style.transform = 'scaleY(0)';\n    this._hiddenInput.style.transformOrigin = 'top';\n    this._updateHiddenInput();\n    document.body.appendChild(this._hiddenInput);\n    this.addDefaultEventListener(RElementLayoutEvent.NAME, function (this: Select) {\n      this._updateHiddenInput();\n    });\n    this.addDefaultEventListener(RTextEvent.NAME_FONT_CHANGE, function (this: Select) {\n      that._updateHiddenInput();\n    });\n    const that = this;\n    this._hiddenInput.addEventListener('input', function () {\n      that._oninput();\n    });\n    this._hiddenInput.addEventListener('change', function () {\n      console.log(`select change: ${that._hiddenInput.value}`);\n      that.dispatchEvent(new RChangeEvent());\n    });\n  }\n  get value() {\n    return this._hiddenInput.value;\n  }\n  /** @internal */\n  private _oninput() {\n    this._text.textContent = this._hiddenInput.options[this._hiddenInput.selectedIndex].textContent;\n  }\n  /** @internal */\n  _init(): void {\n  }\n  /** @internal */\n  _getDefaultStyleSheet(): IStyleSheet {\n    const style = super._getDefaultStyleSheet();\n    style.width = 'auto';\n    style.height = 'auto';\n    style.color = '#000000';\n    style.padding = '5';\n    style.justifyContent = 'flex-start';\n    style.backgroundColor = '#fff';\n    style.borderWidth = '1px';\n    style.borderColor = '#000';\n    style.overflow = 'hidden';\n    return style;\n  }\n  /** @internal */\n  _getHiddenInput(): HTMLSelectElement {\n    return this._hiddenInput;\n  }\n  /** @internal */\n  _updateHiddenInput() {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let el: any = this._uiscene.renderer.getCanvas();\n    const v = this.toAbsolute({x: 0, y: 0});\n    let t = v.y;\n    let l = v.x;\n    if (el instanceof HTMLCanvasElement) {\n      t += el.offsetTop;\n      l += el.offsetLeft;\n      while ((el = el.offsetParent)) {\n        t += el.offsetTop;\n        l += el.offsetLeft;\n      }\n    }\n    this._hiddenInput.style.transform = '';\n    this._hiddenInput.style.pointerEvents = 'auto';\n    this._hiddenInput.style.left = `${l}px`;\n    this._hiddenInput.style.top = `${t}px`;\n    this._hiddenInput.style.width = `${this.getRect().width}px`;\n    this._hiddenInput.style.height = `${this.getRect().height}px`;\n    this._hiddenInput.style.font = `${this._getCachedFont().size}px ${\n      this._getCachedFont().family\n    }`;\n  }\n  /** @internal */\n  _insertChild(child: RNode, index: number) {\n    super._insertChild(child, index);\n    this._text.textContent = this._hiddenInput?.options\n      ? this._hiddenInput.options[this._hiddenInput.selectedIndex]?.textContent\n      : '';\n  }\n  /** @internal */\n  _removeChild(index: number) {\n    super._removeChild(index);\n    this._text.textContent = this._hiddenInput?.options\n      ? this._hiddenInput.options[this._hiddenInput.selectedIndex]?.textContent\n      : '';\n  }\n}\n"],"names":[],"mappings":"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"}