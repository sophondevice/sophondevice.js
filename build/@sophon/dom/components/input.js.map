{"version":3,"file":"input.js","sources":["../../../../libs/dom/src/components/input.ts"],"sourcesContent":["import { REvent } from '@sophon/base'\r\nimport { RRectPrimitive, RPrimitiveBatchList } from '../primitive';\r\nimport { RText } from './text';\r\nimport { RElement } from '../element';\r\nimport {\r\n  RElementLayoutEvent,\r\n  RMouseEvent,\r\n  RFocusEvent,\r\n  RTextEvent,\r\n  RKeyEvent,\r\n  RChangeEvent,\r\n} from '../events';\r\nimport type { GUI } from '../gui';\r\nimport type { IStyleSheet } from '../style';\r\nimport type { GUIRenderer } from '../renderer';\r\n\r\nexport class Input extends RElement {\r\n  /** @internal */\r\n  private _hiddenInput: HTMLInputElement;\r\n  /** @internal */\r\n  private _selectionStart: number;\r\n  /** @internal */\r\n  private _selectionEnd: number;\r\n  /** @internal */\r\n  private _drawCursor: boolean;\r\n  /** @internal */\r\n  private _cursorTimer: number;\r\n  /** @internal */\r\n  private _cursorBatch: RPrimitiveBatchList;\r\n  /** @internal */\r\n  private _text: RText;\r\n  constructor(uiscene: GUI) {\r\n    super(uiscene);\r\n    this._selectionStart = 0;\r\n    this._selectionEnd = 0;\r\n    this._drawCursor = false;\r\n    this._cursorTimer = null;\r\n    this._cursorBatch = null;\r\n    this._text = new RText(this._uiscene);\r\n    this._text._setInternal();\r\n    this._text.style.backgroundColor = 'transparent';\r\n    this._text.style.flex = '1 0 auto';\r\n    this.appendChild(this._text);\r\n    this._hiddenInput = document.createElement('input');\r\n    this._hiddenInput.type = 'text';\r\n    this._hiddenInput.style.position = 'absolute';\r\n    this._hiddenInput.style.boxSizing = 'border-box';\r\n    this._hiddenInput.style.opacity = '0';\r\n    this._hiddenInput.style.outline = 'none';\r\n    this._hiddenInput.style.pointerEvents = 'none';\r\n    this._hiddenInput.style.zIndex = '0';\r\n    this._hiddenInput.style.transform = 'scaleY(0)';\r\n    this._hiddenInput.style.transformOrigin = 'top';\r\n    this._updateHiddenInput();\r\n    this._setHiddenInputSelection(this._selectionStart, this._selectionEnd);\r\n    this._updateCursorVertices();\r\n    document.body.appendChild(this._hiddenInput);\r\n    this.addDefaultEventListener(RElementLayoutEvent.NAME, function (this: Input) {\r\n      this._updateHiddenInput();\r\n    });\r\n    this.addDefaultEventListener(RFocusEvent.NAME_FOCUS, function (this: Input) {\r\n      if (this.type === 'text') {\r\n        this._hiddenInput.focus();\r\n        this._restartCursorTimer();\r\n      }\r\n    });\r\n    this.addDefaultEventListener(RFocusEvent.NAME_BLUR, function (this: Input) {\r\n      if (this.type === 'text') {\r\n        this._hiddenInput.blur();\r\n        this._stopCursorTimer();\r\n        this._drawCursor = false;\r\n      }\r\n    });\r\n    this.addDefaultEventListener(RMouseEvent.NAME_MOUSEDOWN, function (this: Input, e: REvent) {\r\n      const data = e as RMouseEvent;\r\n      if (data.button === 0) {\r\n        if (this.type === 'text') {\r\n          this._hiddenInput.focus();\r\n          const loc = this._text.measureTextLocation(\r\n            data.offsetX - this.getClientRect().x - this._text.getRect().x,\r\n            data.offsetY - this.getClientRect().y - this._text.getRect().y,\r\n          );\r\n          if (loc) {\r\n            console.assert(loc.line === 0);\r\n            this._selectionStart = loc.pos;\r\n            this._selectionEnd = loc.pos;\r\n            this._updateCursorVertices();\r\n            this._setHiddenInputCaretPosition(loc.pos);\r\n          }\r\n        } else if (this.type === 'color') {\r\n          const evt = new MouseEvent('click', {\r\n            bubbles: true,\r\n            cancelable: true,\r\n            view: window,\r\n          });\r\n          this._hiddenInput.dispatchEvent(evt);\r\n        }\r\n      }\r\n    });\r\n    this.addDefaultEventListener(RTextEvent.NAME_CONTENT_CHANGE, function (this: Input) {\r\n      if (this._hiddenInput.value !== this.textContent && this.type === 'text') {\r\n        this._hiddenInput.value = this.textContent;\r\n        this._selectionStart = Math.min(this._selectionStart, this.textContent.length);\r\n        this._selectionEnd = Math.max(\r\n          this._selectionStart,\r\n          Math.min(this._selectionEnd, this.textContent.length),\r\n        );\r\n        this._setHiddenInputSelection(this._selectionStart, this._selectionEnd);\r\n        this._updateCursorVertices();\r\n      }\r\n    });\r\n    this.addDefaultEventListener(RTextEvent.NAME_FONT_CHANGE, function (this: Input) {\r\n      that._updateHiddenInput();\r\n    });\r\n    const that = this;\r\n    this._hiddenInput.addEventListener('keydown', function (evt) {\r\n      if (this.type === 'text') {\r\n        setTimeout(function () {\r\n          const lastSelection = that._selectionStart;\r\n          that._selectionStart = that._hiddenInput.selectionStart;\r\n          that._selectionEnd = that._hiddenInput.selectionEnd;\r\n          if (that._selectionStart !== lastSelection) {\r\n            that._updateCursorVertices();\r\n            that._drawCursor = true;\r\n          }\r\n        }, 0);\r\n      }\r\n      const keyEvt = new RKeyEvent(\r\n        RKeyEvent.NAME_KEYDOWN,\r\n        evt.code,\r\n        evt.key,\r\n        evt.repeat,\r\n        evt.ctrlKey,\r\n        evt.shiftKey,\r\n        evt.altKey,\r\n        evt.metaKey,\r\n      );\r\n      that.dispatchEvent(keyEvt);\r\n    });\r\n    this._hiddenInput.addEventListener('keyup', function (evt) {\r\n      const keyEvt = new RKeyEvent(\r\n        RKeyEvent.NAME_KEYUP,\r\n        evt.code,\r\n        evt.key,\r\n        evt.repeat,\r\n        evt.ctrlKey,\r\n        evt.shiftKey,\r\n        evt.altKey,\r\n        evt.metaKey,\r\n      );\r\n      that.dispatchEvent(keyEvt);\r\n    });\r\n    this._hiddenInput.addEventListener('keypress', function (evt) {\r\n      const keyEvt = new RKeyEvent(\r\n        RKeyEvent.NAME_KEYPRESS,\r\n        evt.code,\r\n        evt.key,\r\n        evt.repeat,\r\n        evt.ctrlKey,\r\n        evt.shiftKey,\r\n        evt.altKey,\r\n        evt.metaKey,\r\n      );\r\n      that.dispatchEvent(keyEvt);\r\n    });\r\n    this._hiddenInput.addEventListener('input', function () {\r\n      that._oninput();\r\n    });\r\n    this._hiddenInput.addEventListener('change', function () {\r\n      that.dispatchEvent(new RChangeEvent());\r\n    });\r\n  }\r\n  /** @internal */\r\n  private _oninput() {\r\n    if (this.type === 'text') {\r\n      this._text.textContent = this._hiddenInput.value;\r\n      this._selectionStart = this._hiddenInput.selectionStart;\r\n      this._selectionEnd = this._hiddenInput.selectionEnd;\r\n      this._updateCursorVertices();\r\n    } else if (this.type === 'color') {\r\n      this._text.style.backgroundColor = this._hiddenInput.value;\r\n    }\r\n  }\r\n  /** @internal */\r\n  protected _draw(renderer: GUIRenderer) {\r\n    super._draw(renderer);\r\n    if (this._drawCursor && this._cursorBatch) {\r\n      this._uiscene._drawBatchList(this._cursorBatch);\r\n    }\r\n  }\r\n  get type(): string {\r\n    return this.getAttribute('type') || 'text';\r\n  }\r\n  set type(val: string) {\r\n    if (val !== this.type) {\r\n      if (val === 'text' || val === 'color') {\r\n        this.setAttribute('type', val);\r\n        this._hiddenInput.type = val;\r\n        if (val === 'text') {\r\n          this._text.textContent = this._hiddenInput.value;\r\n          this._text.style.backgroundColor = 'transparent';\r\n          this._selectionStart = 0;\r\n          this._selectionEnd = 0;\r\n          this.style.cursor = 'text';\r\n          if (this === this._uiscene.getFocus()) {\r\n            this._uiscene.setFocus(null);\r\n          }\r\n          this._invalidateContent();\r\n        } else {\r\n          this._stopCursorTimer();\r\n          this._drawCursor = false;\r\n          this.style.cursor = 'default';\r\n          if (val === 'color') {\r\n            this._text.textContent = '';\r\n            this._text.style.backgroundColor = this._hiddenInput.value;\r\n          }\r\n        }\r\n      }\r\n      this._updateHiddenInput();\r\n    }\r\n  }\r\n  get value() {\r\n    return this._hiddenInput.value;\r\n  }\r\n  set value(val: string) {\r\n    this._hiddenInput.value = val;\r\n    this._oninput();\r\n  }\r\n  /** @internal */\r\n  _init(): void { }\r\n  /** @internal */\r\n  _getDefaultStyleSheet(): IStyleSheet {\r\n    const style = super._getDefaultStyleSheet();\r\n    style.width = '150px';\r\n    style.height = 'auto';\r\n    style.cursor = 'text';\r\n    style.color = '#000000';\r\n    style.padding = '5';\r\n    style.justifyContent = 'flex-start';\r\n    style.backgroundColor = '#fff';\r\n    style.borderWidth = '1px';\r\n    style.borderColor = '#000';\r\n    style.overflow = 'hidden';\r\n    return style;\r\n  }\r\n  /** @internal */\r\n  _updateHiddenInput() {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    let el: any = this._uiscene.renderer.getCanvas();\r\n    const v = this.toAbsolute({ x: 0, y: 0 });\r\n    let t = v.y + this.getRect().height;\r\n    let l = v.x;\r\n    if (el instanceof HTMLCanvasElement) {\r\n      t += el.offsetTop;\r\n      l += el.offsetLeft;\r\n      while ((el = el.offsetParent)) {\r\n        t += el.offsetTop;\r\n        l += el.offsetLeft;\r\n      }\r\n    }\r\n    if (this.type === 'color') {\r\n      t -= this.getRect().height;\r\n      this._hiddenInput.style.transform = '';\r\n      this._hiddenInput.style.pointerEvents = 'auto';\r\n    } else {\r\n      this._hiddenInput.style.transform = 'scaleY(0)';\r\n      this._hiddenInput.style.pointerEvents = 'none';\r\n    }\r\n    this._hiddenInput.style.left = `${l}px`;\r\n    this._hiddenInput.style.top = `${t}px`;\r\n    this._hiddenInput.style.width = `${this.getRect().width}px`;\r\n    this._hiddenInput.style.height = `${this.getRect().height}px`;\r\n    this._hiddenInput.style.font = `${this._getCachedFont().size}px ${this._getCachedFont().family\r\n      }`;\r\n  }\r\n  /** @internal */\r\n  protected _buildVertexData() {\r\n    super._buildVertexData();\r\n    this._updateCursorVertices();\r\n  }\r\n  /** @internal */\r\n  private _setHiddenInputSelection(start: number, end: number) {\r\n    if (this._hiddenInput.setSelectionRange) {\r\n      this._hiddenInput.focus();\r\n      this._hiddenInput.selectionStart = start;\r\n      this._hiddenInput.selectionEnd = end;\r\n    } else {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      const ieInput: any = this._hiddenInput;\r\n      if (ieInput.createTextRange) {\r\n        const range = ieInput.createTextRange();\r\n        range.collapse(true);\r\n        range.moveEnd('character', start);\r\n        range.moveStart('character', end);\r\n        range.select();\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  private _setHiddenInputCaretPosition(pos: number) {\r\n    this._setHiddenInputSelection(pos, pos);\r\n  }\r\n  /** @internal */\r\n  private _calcCursorPos(pos: number): number {\r\n    let x = this.getClientRect().x;\r\n    for (let i = 0; i < pos; i++) {\r\n      const width = this._uiscene._getCharWidth(this._text.textContent[i], this._getCachedFont());\r\n      x += width + this._text.charMargin;\r\n    }\r\n    return x;\r\n  }\r\n  /** @internal */\r\n  private _updateCursorVertices() {\r\n    const clipper = this._getClipper(true);\r\n    if (clipper) {\r\n      const x = this._calcCursorPos(this._selectionStart);\r\n      const v = this.toAbsolute({ x: 0, y: 0 });\r\n      this._cursorBatch = new RPrimitiveBatchList(v.x, v.y);\r\n      this._cursorBatch.addPrimitive(\r\n        new RRectPrimitive(\r\n          x,\r\n          this.getClientRect().y - 2,\r\n          1,\r\n          this.getClientRect().height,\r\n          0,\r\n          0,\r\n          0,\r\n          0,\r\n        ),\r\n        clipper,\r\n        null,\r\n        this._getCachedFontColor(),\r\n      );\r\n    }\r\n  }\r\n  /** @internal */\r\n  private _stopCursorTimer() {\r\n    if (this._cursorTimer) {\r\n      window.clearInterval(this._cursorTimer);\r\n      this._cursorTimer = null;\r\n    }\r\n  }\r\n  /** @internal */\r\n  private _restartCursorTimer() {\r\n    this._stopCursorTimer();\r\n    this._drawCursor = true;\r\n    this._cursorTimer = window.setInterval(() => {\r\n      this._drawCursor = !this._drawCursor;\r\n    }, 500);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}