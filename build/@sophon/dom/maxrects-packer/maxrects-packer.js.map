{"version":3,"file":"maxrects-packer.js","sources":["../../../../libs/dom/src/maxrects-packer/maxrects-packer.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport {Rectangle, IRectangle} from './geom/Rectangle';\r\nimport {MaxRectsBin} from './maxrects-bin';\r\nimport {OversizedElementBin} from './oversized-element-bin';\r\nimport {Bin, IBin} from './abstract-bin';\r\n\r\nexport const EDGE_MAX_VALUE = 4096;\r\nexport const EDGE_MIN_VALUE = 128;\r\nexport enum PACKING_LOGIC {\r\n  MAX_AREA = 0,\r\n  MAX_EDGE = 1,\r\n}\r\n\r\n/**\r\n * Options for MaxRect Packer\r\n * @property {boolean} options.smart Smart sizing packer (default is true)\r\n * @property {boolean} options.pot use power of 2 sizing (default is true)\r\n * @property {boolean} options.square use square size (default is false)\r\n * @property {boolean} options.allowRotation allow rotation packing (default is false)\r\n * @property {boolean} options.tag allow auto grouping based on `rect.tag` (default is false)\r\n * @property {boolean} options.border atlas edge spacing (default is 0)\r\n * @property {PACKING_LOGIC} options.logic MAX_AREA or MAX_EDGE based sorting logic (default is MAX_EDGE)\r\n * @export\r\n * @interface Option\r\n */\r\nexport interface IOption {\r\n  smart?: boolean;\r\n  pot?: boolean;\r\n  square?: boolean;\r\n  allowRotation?: boolean;\r\n  tag?: boolean;\r\n  border?: number;\r\n  logic?: PACKING_LOGIC;\r\n}\r\n\r\nexport class MaxRectsPacker<T extends IRectangle = Rectangle> {\r\n  /**\r\n   * The Bin array added to the packer\r\n   *\r\n   * @type {Bin[]}\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public bins: Bin<T>[];\r\n\r\n  /**\r\n   * Creates an instance of MaxRectsPacker.\r\n   * @param {number} width of the output atlas (default is 4096)\r\n   * @param {number} height of the output atlas (default is 4096)\r\n   * @param {number} padding between glyphs/images (default is 0)\r\n   * @param {IOption} [options={}] (Optional) packing options\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  constructor(\r\n    public width: number = EDGE_MAX_VALUE,\r\n    public height: number = EDGE_MAX_VALUE,\r\n    public padding: number = 0,\r\n    public options: IOption = {\r\n      smart: true,\r\n      pot: true,\r\n      square: false,\r\n      allowRotation: false,\r\n      tag: false,\r\n      border: 0,\r\n      logic: PACKING_LOGIC.MAX_EDGE,\r\n    },\r\n  ) {\r\n    this.bins = [];\r\n  }\r\n\r\n  /**\r\n   * Add a bin/rectangle object with data to packer\r\n   * @param {number} width of the input bin/rectangle\r\n   * @param {number} height of the input bin/rectangle\r\n   * @param {*} data custom data object\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public add(width: number, height: number, data: any): T;\r\n  /**\r\n   * Add a bin/rectangle object extends IRectangle to packer\r\n   * @template T Generic type extends IRectangle interface\r\n   * @param {T} rect the rect object add to the packer bin\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public add(rect: T): T;\r\n  public add(...args: any[]): any {\r\n    if (args.length === 1) {\r\n      if (typeof args[0] !== 'object') throw new Error('MacrectsPacker.add(): Wrong parameters');\r\n      const rect = args[0] as T;\r\n      if (rect.width > this.width || rect.height > this.height) {\r\n        this.bins.push(new OversizedElementBin<T>(rect));\r\n      } else {\r\n        const added = this.bins\r\n          .slice(this._currentBinIndex)\r\n          .find((bin) => bin.add(rect) !== undefined);\r\n        if (!added) {\r\n          const bin = new MaxRectsBin<T>(this.width, this.height, this.padding, this.options);\r\n          const tag = rect.data && rect.data.tag ? rect.data.tag : rect.tag ? rect.tag : undefined;\r\n          if (this.options.tag && tag) bin.tag = tag;\r\n          bin.add(rect);\r\n          this.bins.push(bin);\r\n        }\r\n      }\r\n      return rect;\r\n    } else {\r\n      const rect: IRectangle = new Rectangle(args[0], args[1]);\r\n      if (args.length > 2) rect.data = args[2];\r\n\r\n      if (rect.width > this.width || rect.height > this.height) {\r\n        this.bins.push(new OversizedElementBin<T>(rect as T));\r\n      } else {\r\n        const added = this.bins\r\n          .slice(this._currentBinIndex)\r\n          .find((bin) => bin.add(rect as T) !== undefined);\r\n        if (!added) {\r\n          const bin = new MaxRectsBin<T>(this.width, this.height, this.padding, this.options);\r\n          if (this.options.tag && rect.data.tag) bin.tag = rect.data.tag;\r\n          bin.add(rect as T);\r\n          this.bins.push(bin);\r\n        }\r\n      }\r\n      return rect as T;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an Array of bins/rectangles to the packer.\r\n   *\r\n   * `Javascript`: Any object has property: { width, height, ... } is accepted.\r\n   *\r\n   * `Typescript`: object shall extends `MaxrectsPacker.IRectangle`.\r\n   *\r\n   * note: object has `hash` property will have more stable packing result\r\n   *\r\n   * @param {IRectangle[]} rects Array of bin/rectangles\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public addArray(rects: T[]) {\r\n    this.sort(rects, this.options.logic).forEach((rect) => this.add(rect));\r\n  }\r\n\r\n  /**\r\n   * Reset entire packer to initial states, keep settings\r\n   *\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public reset(): void {\r\n    this.bins = [];\r\n    this._currentBinIndex = 0;\r\n  }\r\n\r\n  /**\r\n   * Repack all elements inside bins\r\n   *\r\n   * @param {boolean} [quick=true] quick repack only dirty bins\r\n   * @returns {void}\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public repack(quick = true): void {\r\n    if (quick) {\r\n      const unpack: T[] = [];\r\n      for (const bin of this.bins) {\r\n        if (bin.dirty) {\r\n          const up = bin.repack();\r\n          if (up) unpack.push(...up);\r\n        }\r\n      }\r\n      this.addArray(unpack);\r\n      return;\r\n    }\r\n    if (!this.dirty) return;\r\n    const allRects = this.rects;\r\n    this.reset();\r\n    this.addArray(allRects);\r\n  }\r\n\r\n  /**\r\n   * Stop adding new element to the current bin and return a new bin.\r\n   *\r\n   * note: After calling `next()` all elements will no longer added to previous bins.\r\n   *\r\n   * @returns {Bin}\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public next(): number {\r\n    this._currentBinIndex = this.bins.length;\r\n    return this._currentBinIndex;\r\n  }\r\n\r\n  /**\r\n   * Load bins to the packer, overwrite exist bins\r\n   * @param {MaxRectsBin[]} bins MaxRectsBin objects\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public load(bins: IBin[]) {\r\n    bins.forEach((bin, index) => {\r\n      if (bin.maxWidth > this.width || bin.maxHeight > this.height) {\r\n        this.bins.push(new OversizedElementBin(bin.width, bin.height, {}));\r\n      } else {\r\n        const newBin = new MaxRectsBin<T>(this.width, this.height, this.padding, bin.options);\r\n        newBin.freeRects.splice(0);\r\n        bin.freeRects.forEach((r) => {\r\n          newBin.freeRects.push(new Rectangle(r.width, r.height, r.x, r.y));\r\n        });\r\n        newBin.width = bin.width;\r\n        newBin.height = bin.height;\r\n        if (bin.tag) newBin.tag = bin.tag;\r\n        this.bins[index] = newBin;\r\n      }\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Output current bins to save\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  public save(): IBin[] {\r\n    const saveBins: IBin[] = [];\r\n    this.bins.forEach((bin) => {\r\n      let saveBin: IBin = {\r\n        width: bin.width,\r\n        height: bin.height,\r\n        maxWidth: bin.maxWidth,\r\n        maxHeight: bin.maxHeight,\r\n        freeRects: [],\r\n        rects: [],\r\n        options: bin.options,\r\n      };\r\n      if (bin.tag) saveBin = {...saveBin, tag: bin.tag};\r\n      bin.freeRects.forEach((r) => {\r\n        saveBin.freeRects.push({\r\n          x: r.x,\r\n          y: r.y,\r\n          width: r.width,\r\n          height: r.height,\r\n        });\r\n      });\r\n      saveBins.push(saveBin);\r\n    });\r\n    return saveBins;\r\n  }\r\n\r\n  /**\r\n   * Sort the given rects based on longest edge or surface area.\r\n   *\r\n   * If rects have the same sort value, will sort by second key `hash` if presented.\r\n   *\r\n   * @private\r\n   * @param {T[]} rects\r\n   * @param {PACKING_LOGIC} [logic=PACKING_LOGIC.MAX_EDGE] sorting logic, \"area\" or \"edge\"\r\n   * @returns\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  private sort(rects: T[], logic: IOption['logic'] = PACKING_LOGIC.MAX_EDGE) {\r\n    return rects.slice().sort((a, b) => {\r\n      const result =\r\n        logic === PACKING_LOGIC.MAX_EDGE\r\n          ? Math.max(b.width, b.height) - Math.max(a.width, a.height)\r\n          : b.width * b.height - a.width * a.height;\r\n      if (result === 0 && a.hash && b.hash) {\r\n        return a.hash > b.hash ? -1 : 1;\r\n      } else return result;\r\n    });\r\n  }\r\n\r\n  private _currentBinIndex = 0;\r\n  /**\r\n   * Return current functioning bin index, perior to this wont accept any new elements\r\n   *\r\n   * @readonly\r\n   * @type {number}\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  get currentBinIndex(): number {\r\n    return this._currentBinIndex;\r\n  }\r\n\r\n  /**\r\n   * Returns dirty status of all child bins\r\n   *\r\n   * @readonly\r\n   * @type {boolean}\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  get dirty(): boolean {\r\n    return this.bins.some((bin) => bin.dirty);\r\n  }\r\n\r\n  /**\r\n   * Return all rectangles in this packer\r\n   *\r\n   * @readonly\r\n   * @type {T[]}\r\n   * @memberof MaxRectsPacker\r\n   */\r\n  get rects(): T[] {\r\n    const allRects: T[] = [];\r\n    for (const bin of this.bins) {\r\n      allRects.push(...bin.rects);\r\n    }\r\n    return allRects;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;AAMO,MAAM,cAAc,GAAG,KAAK;IAEvB,cAGX;AAHD,CAAA,UAAY,aAAa,EAAA;AACvB,IAAA,aAAA,CAAA,aAAA,CAAA,UAAA,CAAA,GAAA,CAAA,CAAA,GAAA,UAAY,CAAA;AACZ,IAAA,aAAA,CAAA,aAAA,CAAA,UAAA,CAAA,GAAA,CAAA,CAAA,GAAA,UAAY,CAAA;AACd,CAAC,EAHW,aAAa,KAAb,aAAa,GAGxB,EAAA,CAAA,CAAA,CAAA;MAwBY,cAAc,CAAA;AAkBhB,IAAA,KAAA,CAAA;AACA,IAAA,MAAA,CAAA;AACA,IAAA,OAAA,CAAA;AACA,IAAA,OAAA,CAAA;AAdF,IAAA,IAAI,CAAW;IAUtB,WACS,CAAA,KAAA,GAAgB,cAAc,EAC9B,MAAA,GAAiB,cAAc,EAC/B,OAAA,GAAkB,CAAC,EACnB,OAAmB,GAAA;AACxB,QAAA,KAAK,EAAE,IAAI;AACX,QAAA,GAAG,EAAE,IAAI;AACT,QAAA,MAAM,EAAE,KAAK;AACb,QAAA,aAAa,EAAE,KAAK;AACpB,QAAA,GAAG,EAAE,KAAK;AACV,QAAA,MAAM,EAAE,CAAC;QACT,KAAK,EAAE,aAAa,CAAC,QAAQ;AAC9B,KAAA,EAAA;QAXM,IAAK,CAAA,KAAA,GAAL,KAAK,CAAyB;QAC9B,IAAM,CAAA,MAAA,GAAN,MAAM,CAAyB;QAC/B,IAAO,CAAA,OAAA,GAAP,OAAO,CAAY;QACnB,IAAO,CAAA,OAAA,GAAP,OAAO,CAQb;AAED,QAAA,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;KAChB;IAiBM,GAAG,CAAC,GAAG,IAAW,EAAA;AACvB,QAAA,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;AACrB,YAAA,IAAI,OAAO,IAAI,CAAC,CAAC,CAAC,KAAK,QAAQ;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;AAC3F,YAAA,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAM,CAAC;AAC1B,YAAA,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;gBACxD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,mBAAmB,CAAI,IAAI,CAAC,CAAC,CAAC;AAClD,aAAA;AAAM,iBAAA;AACL,gBAAA,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI;AACpB,qBAAA,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC;AAC5B,qBAAA,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC,CAAC;gBAC9C,IAAI,CAAC,KAAK,EAAE;oBACV,MAAM,GAAG,GAAG,IAAI,WAAW,CAAI,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;AACpF,oBAAA,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC;AACzF,oBAAA,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,GAAG;AAAE,wBAAA,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC;AAC3C,oBAAA,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACd,oBAAA,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACrB,iBAAA;AACF,aAAA;AACD,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;AAAM,aAAA;AACL,YAAA,MAAM,IAAI,GAAe,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACzD,YAAA,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC;AAAE,gBAAA,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AAEzC,YAAA,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;gBACxD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,mBAAmB,CAAI,IAAS,CAAC,CAAC,CAAC;AACvD,aAAA;AAAM,iBAAA;AACL,gBAAA,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI;AACpB,qBAAA,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC;AAC5B,qBAAA,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,CAAC,IAAS,CAAC,KAAK,SAAS,CAAC,CAAC;gBACnD,IAAI,CAAC,KAAK,EAAE;oBACV,MAAM,GAAG,GAAG,IAAI,WAAW,CAAI,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;oBACpF,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG;wBAAE,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC;AAC/D,oBAAA,GAAG,CAAC,GAAG,CAAC,IAAS,CAAC,CAAC;AACnB,oBAAA,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACrB,iBAAA;AACF,aAAA;AACD,YAAA,OAAO,IAAS,CAAC;AAClB,SAAA;KACF;AAcM,IAAA,QAAQ,CAAC,KAAU,EAAA;QACxB,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;KACxE;IAOM,KAAK,GAAA;AACV,QAAA,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;AACf,QAAA,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC;KAC3B;IASM,MAAM,CAAC,KAAK,GAAG,IAAI,EAAA;AACxB,QAAA,IAAI,KAAK,EAAE;YACT,MAAM,MAAM,GAAQ,EAAE,CAAC;AACvB,YAAA,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE;gBAC3B,IAAI,GAAG,CAAC,KAAK,EAAE;AACb,oBAAA,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC;AACxB,oBAAA,IAAI,EAAE;AAAE,wBAAA,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;AAC5B,iBAAA;AACF,aAAA;AACD,YAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;YACtB,OAAO;AACR,SAAA;QACD,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAO;AACxB,QAAA,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;QAC5B,IAAI,CAAC,KAAK,EAAE,CAAC;AACb,QAAA,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;KACzB;IAUM,IAAI,GAAA;QACT,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;QACzC,OAAO,IAAI,CAAC,gBAAgB,CAAC;KAC9B;AAOM,IAAA,IAAI,CAAC,IAAY,EAAA;QACtB,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,KAAK,KAAI;AAC1B,YAAA,IAAI,GAAG,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,IAAI,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,EAAE;AAC5D,gBAAA,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,mBAAmB,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;AACpE,aAAA;AAAM,iBAAA;gBACL,MAAM,MAAM,GAAG,IAAI,WAAW,CAAI,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC;AACtF,gBAAA,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC3B,GAAG,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,KAAI;oBAC1B,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACpE,iBAAC,CAAC,CAAC;AACH,gBAAA,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;AACzB,gBAAA,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC3B,IAAI,GAAG,CAAC,GAAG;AAAE,oBAAA,MAAM,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC;AAClC,gBAAA,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC;AAC3B,aAAA;SACF,EAAE,IAAI,CAAC,CAAC;KACV;IAMM,IAAI,GAAA;QACT,MAAM,QAAQ,GAAW,EAAE,CAAC;QAC5B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAI;AACxB,YAAA,IAAI,OAAO,GAAS;gBAClB,KAAK,EAAE,GAAG,CAAC,KAAK;gBAChB,MAAM,EAAE,GAAG,CAAC,MAAM;gBAClB,QAAQ,EAAE,GAAG,CAAC,QAAQ;gBACtB,SAAS,EAAE,GAAG,CAAC,SAAS;AACxB,gBAAA,SAAS,EAAE,EAAE;AACb,gBAAA,KAAK,EAAE,EAAE;gBACT,OAAO,EAAE,GAAG,CAAC,OAAO;aACrB,CAAC;YACF,IAAI,GAAG,CAAC,GAAG;gBAAE,OAAO,GAAG,EAAC,GAAG,OAAO,EAAE,GAAG,EAAE,GAAG,CAAC,GAAG,EAAC,CAAC;YAClD,GAAG,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,KAAI;AAC1B,gBAAA,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC;oBACrB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACN,CAAC,EAAE,CAAC,CAAC,CAAC;oBACN,KAAK,EAAE,CAAC,CAAC,KAAK;oBACd,MAAM,EAAE,CAAC,CAAC,MAAM;AACjB,iBAAA,CAAC,CAAC;AACL,aAAC,CAAC,CAAC;AACH,YAAA,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACzB,SAAC,CAAC,CAAC;AACH,QAAA,OAAO,QAAQ,CAAC;KACjB;AAaO,IAAA,IAAI,CAAC,KAAU,EAAE,KAA0B,GAAA,aAAa,CAAC,QAAQ,EAAA;AACvE,QAAA,OAAO,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAI;AACjC,YAAA,MAAM,MAAM,GACV,KAAK,KAAK,aAAa,CAAC,QAAQ;kBAC5B,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,MAAM,CAAC;AAC3D,kBAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC;YAC9C,IAAI,MAAM,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,EAAE;AACpC,gBAAA,OAAO,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;AACjC,aAAA;;AAAM,gBAAA,OAAO,MAAM,CAAC;AACvB,SAAC,CAAC,CAAC;KACJ;IAEO,gBAAgB,GAAG,CAAC,CAAC;AAQ7B,IAAA,IAAI,eAAe,GAAA;QACjB,OAAO,IAAI,CAAC,gBAAgB,CAAC;KAC9B;AASD,IAAA,IAAI,KAAK,GAAA;AACP,QAAA,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC;KAC3C;AASD,IAAA,IAAI,KAAK,GAAA;QACP,MAAM,QAAQ,GAAQ,EAAE,CAAC;AACzB,QAAA,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,IAAI,EAAE;YAC3B,QAAQ,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;AAC7B,SAAA;AACD,QAAA,OAAO,QAAQ,CAAC;KACjB;AACF;;;;"}