{"version":3,"file":"basetexture_webgpu.js","sources":["../../../../../libs/device/src/device/webgpu/basetexture_webgpu.ts"],"sourcesContent":["import { WebGPUObject } from './gpuobject_webgpu';\nimport { TextureCaps } from '../device';\nimport { TextureTarget, TextureFilter, TextureWrapping, TextureFormat, isCompressedTextureFormat, isDepthTextureFormat, isFloatTextureFormat, isIntegerTextureFormat, isSignedTextureFormat, CompareFunc, getTextureFormatBlockWidth, getTextureFormatBlockHeight, getTextureFormatBlockSize } from '../base_types';\nimport { GPUResourceUsageFlags, SamplerOptions, BaseTexture, TextureSampler, GPUDataBuffer } from '../gpuobject';\nimport { UploadRingBuffer, UploadTexture, UploadImage } from './uploadringbuffer';\nimport { textureFormatMap } from './constants_webgpu';\nimport type { WebGPUDevice } from './device';\nimport type { WebGPUBuffer } from './buffer_webgpu';\nimport type { WebGPUTextureCap, ITextureFormatInfoWebGPU } from './capabilities_webgpu';\nimport type { TypedArray } from '../../misc';\n\nexport abstract class WebGPUBaseTexture<T extends GPUTexture|GPUExternalTexture = GPUTexture> extends WebGPUObject<T> {\n  protected _target: TextureTarget;\n  protected _hash: string;\n  protected _memCost: number;\n  protected _views: GPUTextureView[][][];\n  protected _defaultView: GPUTextureView;\n  protected _mipmapDirty: boolean;\n  protected _flags: number;\n  protected _width: number;\n  protected _height: number;\n  protected _depth: number;\n  protected _format: TextureFormat;\n  protected _renderable: boolean;\n  protected _fb: boolean;\n  protected _gpuFormat: GPUTextureFormat;\n  protected _mipLevelCount: number;\n  protected _ringBuffer: UploadRingBuffer;\n  protected _pendingUploads: (UploadTexture | UploadImage)[];\n  constructor(device: WebGPUDevice, target?: TextureTarget) {\n    super(device);\n    this._target = target || TextureTarget.Texture2D;\n    this._flags = 0;\n    this._width = 0;\n    this._height = 0;\n    this._depth = 0;\n    this._renderable = false;\n    this._fb = false;\n    this._format = TextureFormat.Unknown;\n    this._gpuFormat = null;\n    this._mipLevelCount = 0;\n    this._memCost = 0;\n    this._mipmapDirty = false;\n    this._views = [];\n    this._defaultView = null;\n    this._ringBuffer = new UploadRingBuffer(device);\n    this._pendingUploads = [];\n  }\n  get hash(): number {\n    return this._object ? this._device.gpuGetObjectHash(this._object) : 0;\n  }\n  get target(): TextureTarget {\n    return this._target;\n  }\n  get linearColorSpace(): boolean {\n    return !!(this._flags & GPUResourceUsageFlags.TF_LINEAR_COLOR_SPACE);\n  }\n  get width(): number {\n    return this._width;\n  }\n  get height(): number {\n    return this._height;\n  }\n  get depth(): number {\n    return this._depth;\n  }\n  get format(): TextureFormat {\n    return this._format;\n  }\n  get mipLevelCount(): number {\n    return this._mipLevelCount;\n  }\n  get gpuFormat(): GPUTextureFormat {\n    return this._gpuFormat;\n  }\n  abstract init(): void;\n  isTexture(): this is BaseTexture {\n    return true;\n  }\n  isFilterable(): boolean {\n    if (!this.getTextureCaps().getTextureFormatInfo(this._format)?.filterable) {\n      return false;\n    }\n    return true;\n  }\n  /** @internal */\n  getPendingUploads(): (UploadTexture | UploadImage)[] {\n    return this._pendingUploads;\n  }\n  /** @internal */\n  clearPendingUploads() {\n    if (this._pendingUploads.length > 0) {\n      this._pendingUploads = [];\n      this.beginSyncChanges(null);\n      this.endSyncChanges();\n    }\n  }\n  isMipmapDirty(): boolean {\n    return this._mipmapDirty;\n  }\n  setMipmapDirty(b: boolean) {\n    this._mipmapDirty = b;\n  }\n  destroy(): void {\n    if (this._object) {\n      if (!this.isTextureVideo()) {\n        (this._object as GPUTexture).destroy();\n      }\n      this._object = null;\n      this._device.updateVideoMemoryCost(-this._memCost);\n      this._memCost = 0;\n    }\n  }\n  async restore() {\n    if (!this._object && !this._device.isContextLost()) {\n      this.init();\n    }\n  }\n  getTextureCaps(): TextureCaps {\n    return this._device.getTextureCaps();\n  }\n  isFloatFormat(): boolean {\n    return isFloatTextureFormat(this._format);\n  }\n  isIntegerFormat(): boolean {\n    return isIntegerTextureFormat(this._format);\n  }\n  isSignedFormat(): boolean {\n    return isSignedTextureFormat(this._format);\n  }\n  isCompressedFormat(): boolean {\n    return isCompressedTextureFormat(this._format);\n  }\n  isDepth(): boolean {\n    return isDepthTextureFormat(this._format);\n  }\n  isRenderable(): boolean {\n    return this._renderable;\n  }\n  getView(level?: number, face?: number, mipCount?: number): GPUTextureView {\n    level = Number(level) || 0;\n    face = Number(face) || 0;\n    mipCount = Number(mipCount) || 0;\n    if (!this._views[face]) {\n      this._views[face] = [];\n    }\n    if (!this._views[face][level]) {\n      this._views[face][level] = [];\n    }\n    if (!this._views[face][level][mipCount]) {\n      this._views[face][level][mipCount] = this.createView(level, face, mipCount);\n    }\n    return this._views[face][level][mipCount];\n  }\n  getDefaultView(): GPUTextureView {\n    if (!this._defaultView && this._object && !this.isTextureVideo()) {\n      this._defaultView = this._device.gpuCreateTextureView(this._object as GPUTexture, {\n        dimension: this.isTextureCube() ? 'cube' : this.isTexture3D() ? '3d' : this.isTexture2DArray() ? '2d-array' : '2d',\n        arrayLayerCount: this.isTextureCube() ? 6 : this.isTexture2DArray() ? this._depth : 1,\n        aspect: isDepthTextureFormat(this.format) ? 'depth-only' : 'all',\n      });\n    }\n    return this._defaultView;\n  }\n  copyPixelDataToBuffer(x: number, y: number, w: number, h: number, layer: number, level: number, buffer: GPUDataBuffer): void {\n    if (this.isTextureVideo()) {\n      throw new Error('copyPixelDataToBuffer() failed: can not copy pixel data of video texture');\n    }\n    WebGPUBaseTexture.copyTexturePixelsToBuffer(this._device.device, this.object as GPUTexture, this.width, this.height, this.format, x, y, w, h, layer, level, buffer);\n  }\n  generateMipmaps() {\n    this._mipmapDirty = true;\n  }\n  beginSyncChanges(encoder: GPUCommandEncoder) {\n    if (!this.isTextureVideo() && this._pendingUploads.length > 0 && this._object) {\n      const cmdEncoder = encoder || this._device.device.createCommandEncoder();\n      for (const u of this._pendingUploads) {\n        if ((u as UploadTexture).mappedBuffer) {\n          const upload = u as UploadTexture;\n          cmdEncoder.copyBufferToTexture({\n            buffer: upload.mappedBuffer.buffer,\n            offset: upload.mappedBuffer.offset,\n            bytesPerRow: upload.bufferStride,\n            rowsPerImage: upload.uploadHeight,\n          }, {\n            texture: this._object as GPUTexture,\n            origin: {\n              x: upload.uploadOffsetX,\n              y: upload.uploadOffsetY,\n              z: upload.uploadOffsetZ,\n            },\n            mipLevel: upload.mipLevel,\n          }, {\n            width: upload.uploadWidth,\n            height: upload.uploadHeight,\n            depthOrArrayLayers: upload.uploadDepth\n          });\n        } else if ((u as UploadImage).image) {\n          const upload = u as UploadImage;\n          // FIXME: copy image cannot be queued into the command buffer\n          const copyView: GPUImageCopyTextureTagged = {\n            texture: this._object as GPUTexture,\n            origin: {\n              x: upload.offsetX,\n              y: upload.offsetY,\n              z: upload.offsetZ\n            },\n            mipLevel: upload.mipLevel\n          };\n          this._device.device.queue.copyExternalImageToTexture({ source: upload.image }, copyView, {\n            width: upload.width,\n            height: upload.height,\n            depthOrArrayLayers: upload.depth\n          });\n        }\n      }\n      this._pendingUploads.length = 0;\n      if (!encoder) {\n        this._device.device.queue.submit([cmdEncoder.finish()]);\n      }\n      this._ringBuffer.beginUploads();\n    }\n  }\n  endSyncChanges() {\n    if (this._flags & GPUResourceUsageFlags.DYNAMIC) {\n      this._ringBuffer.endUploads();\n    } else {\n      this._ringBuffer.purge();\n    }\n  }\n  getDefaultSampler(shadow: boolean): TextureSampler {\n    const params = (this.getTextureCaps() as WebGPUTextureCap).getTextureFormatInfo(this._format);\n    return this._device.createSampler(this._getSamplerOptions(params, shadow));\n  }\n  abstract createView(level?: number, face?: number, mipCount?: number): GPUTextureView;\n  /** @internal */\n  protected _calcMipLevelCount(format: TextureFormat, width: number, height: number, depth: number): number {\n    if (isDepthTextureFormat(format) || this.isTexture3D() || this.isTextureVideo()) {\n      return 1;\n    }\n    if (this._flags & GPUResourceUsageFlags.TF_NO_MIPMAP) {\n      return 1;\n    }\n    const params = (this.getTextureCaps() as WebGPUTextureCap).getTextureFormatInfo(format);\n    if (!params || !params.renderable) {\n      return 1;\n    }\n    return Math.floor(Math.log2(Math.max(width, height))) + 1;\n  }\n  /** @internal */\n  protected allocInternal(format: TextureFormat, width: number, height: number, depth: number, numMipLevels: number) {\n    if (this.isTextureVideo()) {\n      return;\n    }\n    if (numMipLevels === 0) {\n      numMipLevels = this._calcMipLevelCount(format, width, height, depth);\n    } else if (numMipLevels !== 1) {\n      const autoMipLevelCount = this._calcMipLevelCount(format, width, height, depth);\n      if (!Number.isInteger(numMipLevels) || numMipLevels < 0 || numMipLevels > autoMipLevelCount) {\n        numMipLevels = autoMipLevelCount;\n      }\n    }\n    if (this._object && (this._format !== format || this._width !== width || this._height !== height || this._depth !== depth, this._mipLevelCount !== numMipLevels)) {\n      const obj = this._object;\n      this._device.runNextFrame(() => {\n        (obj as GPUTexture).destroy();\n      });\n      this._object = null;\n    }\n    if (!this._object) {\n      this._format = format;\n      this._width = width;\n      this._height = height;\n      this._depth = depth;\n      this._mipLevelCount = numMipLevels;\n      if (!this._device.isContextLost()) {\n        this._gpuFormat = textureFormatMap[this._format];\n        const params = (this.getTextureCaps() as WebGPUTextureCap).getTextureFormatInfo(this._format);\n        this._renderable = params.renderable && !(this._flags & GPUResourceUsageFlags.TF_WRITABLE);\n        this._object = this._device.gpuCreateTexture({\n          size: {\n            width: this._width,\n            height: this._height,\n            depthOrArrayLayers: this.isTextureCube() ? 6 : this._depth\n          },\n          format: this._gpuFormat,\n          mipLevelCount: this._mipLevelCount,\n          sampleCount: 1,\n          dimension: this.isTexture3D() ? '3d' : '2d',\n          usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.COPY_SRC\n            | (this._renderable && !this.isTexture3D() ? GPUTextureUsage.RENDER_ATTACHMENT : 0)\n            | ((this._flags & GPUResourceUsageFlags.TF_WRITABLE) ? GPUTextureUsage.STORAGE_BINDING : 0)\n        }) as any;\n        const memCost = (this.getTextureCaps() as WebGPUTextureCap).calcMemoryUsage(this._format, this._width * this._height * (this.isTextureCube() ? 6 : this._depth));\n        this._device.updateVideoMemoryCost(memCost - this._memCost);\n        this._memCost = memCost;\n      }\n    }\n  }\n  /** @internal */\n  static copyTexturePixelsToBuffer(device: GPUDevice, texture: GPUTexture, texWidth: number, texHeight: number, format: TextureFormat, x: number, y: number, w: number, h: number, layer: number, level: number, buffer: GPUDataBuffer): void {\n    if (!((buffer as WebGPUBuffer).gpuUsage & GPUBufferUsage.COPY_DST)) {\n      throw new Error('copyTexturePixelsToBuffer() failed: destination buffer does not have COPY_DST usage set');\n    }\n    const blockWidth = getTextureFormatBlockWidth(format);\n    const blockHeight = getTextureFormatBlockHeight(format);\n    const blockSize = getTextureFormatBlockSize(format);\n    const blocksPerRow = texWidth / blockWidth;\n    const blocksPerCol = texHeight / blockHeight;\n    const rowStride = blocksPerRow * blockSize;\n    const bufferStride = (rowStride + 255) & ~255;\n    const bufferSize = blocksPerRow * rowStride;\n    const bufferSizeAligned = blocksPerCol * bufferStride;\n    if (buffer.byteLength < bufferSize) {\n      throw new Error(`copyTexturePixelsToBuffer() failed: destination buffer size is ${buffer.byteLength}, should be at least ${bufferSize}`);\n    }\n    const tmpBuffer = device.createBuffer({ size: bufferSizeAligned, usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.COPY_SRC });\n    const encoder = device.createCommandEncoder();\n    encoder.copyTextureToBuffer({\n      texture: texture,\n      mipLevel: level ?? 0,\n      origin: {\n        x: x,\n        y: y,\n        z: layer ?? 0\n      }\n    }, {\n      buffer: tmpBuffer as GPUBuffer,\n      offset: 0,\n      bytesPerRow: bufferStride\n    }, {\n      width: w,\n      height: h,\n      depthOrArrayLayers: 1\n    });\n    if (bufferSize !== bufferSizeAligned) {\n      for (let i = 0; i < blocksPerCol; i++) {\n        encoder.copyBufferToBuffer(tmpBuffer, i * bufferStride, buffer.object as GPUBuffer, i * rowStride, rowStride);\n      }\n    } else {\n      encoder.copyBufferToBuffer(tmpBuffer, 0, buffer.object as GPUBuffer, 0, bufferSize);\n    }\n    device.queue.submit([encoder.finish()]);\n    tmpBuffer.destroy();\n  }\n  /** @internal */\n  protected uploadRaw(pixels: TypedArray, width: number, height: number, depth: number, offsetX: number, offsetY: number, offsetZ: number, miplevel: number) {\n    const data = new Uint8Array(pixels.buffer, pixels.byteOffset, pixels.byteLength);\n    const info = (this._device.getTextureCaps() as WebGPUTextureCap).getTextureFormatInfo(this._format);\n    const blockWidth = info.blockWidth || 1;\n    const blockHeight = info.blockHeight || 1;\n    const blocksPerRow = Math.ceil(width / blockWidth);\n    const blocksPerCol = Math.ceil(height / blockHeight);\n    const rowStride = blocksPerRow * info.size;\n    if (rowStride * blocksPerCol * depth !== data.byteLength) {\n      throw new Error(`WebGPUTexture.update() invalid data size: ${data.byteLength}`);\n    }\n    if (!this._device.isTextureUploading(this as any)) {\n      this.clearPendingUploads();\n      const destination: GPUImageCopyTexture = {\n        texture: this._object as GPUTexture,\n        mipLevel: miplevel,\n        origin: {\n          x: offsetX,\n          y: offsetY,\n          z: offsetZ,\n        },\n      };\n      const dataLayout: GPUImageDataLayout = {\n        bytesPerRow: rowStride,\n        rowsPerImage: blockHeight * blocksPerCol,\n      };\n      const size: GPUExtent3D = {\n        width: blockWidth * blocksPerRow,\n        height: blockHeight * blocksPerCol,\n        depthOrArrayLayers: depth\n      };\n      this._device.device.queue.writeTexture(destination, data, dataLayout, size);\n    } else {\n      const bufferStride = (rowStride + 255) & ~255; // align to 256 bytes\n      const uploadSize = bufferStride * blocksPerCol * depth;\n      const upload = this._ringBuffer.uploadBuffer(null, null, 0, 0, uploadSize);\n      const mappedRange = upload.mappedBuffer.mappedRange;\n      const src = new Uint8Array(data);\n      const dst = new Uint8Array(mappedRange, upload.mappedBuffer.offset, uploadSize);\n      if (uploadSize === data.byteLength) {\n        dst.set(new Uint8Array(data));\n      } else {\n        for (let d = 0; d < depth; d++) {\n          const srcLayerOffset = d * rowStride * blocksPerRow;\n          const dstLayerOffset = d * bufferStride * blocksPerCol;\n          for (let i = 0; i < blocksPerCol; i++) {\n            dst.set(src.subarray(srcLayerOffset + i * rowStride, srcLayerOffset + (i + 1) * rowStride), dstLayerOffset + i * bufferStride);\n          }\n        }\n      }\n      this._pendingUploads.push({\n        mappedBuffer: upload.mappedBuffer,\n        uploadOffsetX: offsetX,\n        uploadOffsetY: offsetY,\n        uploadOffsetZ: offsetZ,\n        uploadWidth: blockWidth * blocksPerRow,\n        uploadHeight: blockHeight * blocksPerCol,\n        uploadDepth: depth,\n        bufferStride: bufferStride,\n        mipLevel: miplevel,\n      });\n    }\n  }\n  /** @internal */\n  protected uploadImageData(data: ImageBitmap | HTMLCanvasElement, width: number, height: number, offsetX: number, offsetY: number, miplevel: number, faceIndex: number) {\n    if (!this._device.isTextureUploading(this as any) && this._device.device.queue.copyExternalImageToTexture) {\n      this.clearPendingUploads();\n      const copyView: GPUImageCopyTextureTagged = {\n        texture: this._object as GPUTexture,\n        origin: {\n          x: offsetX,\n          y: offsetY,\n          z: faceIndex || 0\n        },\n        mipLevel: miplevel || 0\n      };\n      this._device.device.queue.copyExternalImageToTexture({ source: data }, copyView, {\n        width: width,\n        height: height,\n        depthOrArrayLayers: 1\n      });\n    } else {\n      const tmpCanvas = document.createElement('canvas');\n      tmpCanvas.width = width;\n      tmpCanvas.height = height;\n      const ctx = tmpCanvas.getContext('2d');\n      ctx.drawImage(data, 0, 0, width, height, 0, 0, width, height);\n      const imageData = ctx.getImageData(0, 0, width, height);\n      this.uploadRaw(imageData.data, width, height, 1, offsetX, offsetY, faceIndex, miplevel);\n      tmpCanvas.width = 0;\n      tmpCanvas.height = 0;\n    }\n  }\n  /** @internal */\n  protected _getSamplerOptions(params: Partial<ITextureFormatInfoWebGPU>, shadow: boolean): SamplerOptions {\n    const comparison = this.isDepth() && shadow;\n    const filterable = params.filterable || comparison;\n    const magFilter = filterable\n      ? TextureFilter.Linear\n      : TextureFilter.Nearest;\n    const minFilter = params.filterable\n      ? TextureFilter.Linear\n      : TextureFilter.Nearest;\n    const mipFilter = this._mipLevelCount > 1\n      ? filterable ? TextureFilter.Linear : TextureFilter.Nearest\n      : TextureFilter.None;\n    const addressU = TextureWrapping.ClampToEdge;\n    const addressV = TextureWrapping.ClampToEdge;\n    const addressW = TextureWrapping.ClampToEdge;\n    const compare = comparison ? CompareFunc.Less : null;\n    return {\n      addressU,\n      addressV,\n      addressW,\n      magFilter,\n      minFilter,\n      mipFilter,\n      compare,\n    };\n  }\n  /** @internal */\n  _markAsCurrentFB(b: boolean) {\n    this._fb = b;\n  }\n  /** @internal */\n  _isMarkedAsCurrentFB(): boolean {\n    return this._fb;\n  }\n}\n"],"names":[],"mappings":"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"}