{"version":3,"file":"texturevideo_webgpu.js","sources":["../../../../../libs/device/src/device/webgpu/texturevideo_webgpu.ts"],"sourcesContent":["import { WebGPUBaseTexture } from './basetexture_webgpu';\nimport { TextureVideo } from '../gpuobject';\nimport type { WebGPUDevice } from './device';\n\nexport class WebGPUTextureVideo extends WebGPUBaseTexture<GPUExternalTexture> implements TextureVideo<GPUExternalTexture> {\n  private _source: HTMLVideoElement;\n  constructor(device: WebGPUDevice, element: HTMLVideoElement) {\n    super(device);\n    this._source = element;\n    this._width = 0;\n    this._height = 0;\n    this.loadFromElement();\n  }\n  isTextureVideo(): this is TextureVideo {\n    return true;\n  }\n  get width(): number {\n    return this._width;\n  }\n  get height(): number {\n    return this._height;\n  }\n  get source(): HTMLVideoElement {\n    return this._source;\n  }\n  async restore() {\n    if (!this._object && !this._device.isContextLost()) {\n      this.loadElement(this._source);\n    }\n  }\n  updateVideoFrame(): boolean {\n    if ((!this._object || (this._object as any).expired || (this._object as any).expired === undefined) && this._source.readyState > 2) {\n      this._object = this._device.gpuImportExternalTexture(this._source);\n      return true;\n    }\n    return false;\n  }\n  createView(level?: number, face?: number, mipCount?: number): GPUTextureView {\n    return null;\n  }\n  init(): void {\n    this.loadFromElement();\n  }\n  /** @internal */\n  loadFromElement(): void {\n    this.loadElement(this._source);\n  }\n  /** @internal */\n  private loadElement(element: HTMLVideoElement): boolean {\n    this._width = element.videoWidth;\n    this._height = element.videoHeight;\n    if (!this._device.isContextLost()) {\n      if (element.readyState > 2) {\n        this._object = this._device.gpuImportExternalTexture(element);\n      }\n    }\n    return !!this._object;\n  }\n}\n"],"names":[],"mappings":";;;AAIM,MAAO,kBAAmB,SAAQ,iBAAqC,CAAA;AACnE,IAAA,OAAO,CAAmB;IAClC,WAAY,CAAA,MAAoB,EAAE,OAAyB,EAAA;QACzD,KAAK,CAAC,MAAM,CAAC,CAAC;AACd,QAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;AACvB,QAAA,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;AAChB,QAAA,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,IAAI,CAAC,eAAe,EAAE,CAAC;KACxB;IACD,cAAc,GAAA;AACZ,QAAA,OAAO,IAAI,CAAC;KACb;AACD,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM,CAAC;KACpB;AACD,IAAA,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,OAAO,CAAC;KACrB;AACD,IAAA,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,OAAO,CAAC;KACrB;AACD,IAAA,MAAM,OAAO,GAAA;AACX,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE;AAClD,YAAA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAChC,SAAA;KACF;IACD,gBAAgB,GAAA;AACd,QAAA,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,IAAK,IAAI,CAAC,OAAe,CAAC,OAAO,IAAK,IAAI,CAAC,OAAe,CAAC,OAAO,KAAK,SAAS,KAAK,IAAI,CAAC,OAAO,CAAC,UAAU,GAAG,CAAC,EAAE;AAClI,YAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACnE,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;AACD,QAAA,OAAO,KAAK,CAAC;KACd;AACD,IAAA,UAAU,CAAC,KAAc,EAAE,IAAa,EAAE,QAAiB,EAAA;AACzD,QAAA,OAAO,IAAI,CAAC;KACb;IACD,IAAI,GAAA;QACF,IAAI,CAAC,eAAe,EAAE,CAAC;KACxB;IAED,eAAe,GAAA;AACb,QAAA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAChC;AAEO,IAAA,WAAW,CAAC,OAAyB,EAAA;AAC3C,QAAA,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC;AACjC,QAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC;AACnC,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE;AACjC,YAAA,IAAI,OAAO,CAAC,UAAU,GAAG,CAAC,EAAE;gBAC1B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;AAC/D,aAAA;AACF,SAAA;AACD,QAAA,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;KACvB;AACF;;;;"}