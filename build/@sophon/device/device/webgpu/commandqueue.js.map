{"version":3,"file":"commandqueue.js","sources":["../../../../../libs/device/src/device/webgpu/commandqueue.ts"],"sourcesContent":["import { Vector4 } from '@sophon/base';\r\nimport { PrimitiveType } from '../base_types';\r\nimport { WebGPURenderPass } from './renderpass_webgpu';\r\nimport { WebGPUComputePass } from './computepass_webgpu';\r\nimport type { WebGPUDevice } from './device';\r\nimport type { WebGPUProgram } from './gpuprogram_webgpu';\r\nimport type { WebGPUVertexInputLayout } from './vertexinputlayout_webgpu';\r\nimport type { WebGPURenderStateSet } from './renderstates_webgpu';\r\nimport type { WebGPUBindGroup } from './bindgroup_webgpu';\r\nimport type { WebGPUFrameBuffer } from './framebuffer_webgpu';\r\nimport type { FrameBufferInfo } from './pipeline_cache';\r\nimport type { WebGPUBuffer } from './buffer_webgpu';\r\nimport type { WebGPUBaseTexture } from './basetexture_webgpu';\r\n\r\nexport class CommandQueueImmediate {\r\n  protected _renderPass: WebGPURenderPass;\r\n  protected _computePass: WebGPUComputePass;\r\n  constructor(device: WebGPUDevice) {\r\n    this._renderPass = new WebGPURenderPass(device);\r\n    this._computePass = new WebGPUComputePass(device);\r\n  }\r\n  get currentPass(): WebGPURenderPass|WebGPUComputePass {\r\n    return this._renderPass.active ? this._renderPass : this._computePass.active ? this._computePass : null;\r\n  }\r\n  beginFrame(): void {\r\n  }\r\n  endFrame(): void {\r\n    this._renderPass.end();\r\n    this._computePass.end();\r\n  }\r\n  flush() {\r\n    this._renderPass.end();\r\n    this._computePass.end();\r\n  }\r\n  setFramebuffer(fb: WebGPUFrameBuffer): void {\r\n    this._renderPass.setFramebuffer(fb);\r\n  }\r\n  getFramebuffer(): WebGPUFrameBuffer {\r\n    return this._renderPass.getFramebuffer();\r\n  }\r\n  getFramebufferInfo(): FrameBufferInfo {\r\n    return this._renderPass.getFrameBufferInfo();\r\n  }\r\n  compute(program: WebGPUProgram, bindGroups: WebGPUBindGroup[], bindGroupOffsets: Iterable<number>[], workgroupCountX: number, workgroupCountY: number, workgroupCountZ: number) {\r\n    this._renderPass.end();\r\n    this._computePass.compute(program, bindGroups, bindGroupOffsets, workgroupCountX, workgroupCountY, workgroupCountZ);\r\n  }\r\n  draw(program: WebGPUProgram, vertexData: WebGPUVertexInputLayout, stateSet: WebGPURenderStateSet, bindGroups: WebGPUBindGroup[], bindGroupOffsets: Iterable<number>[], primitiveType: PrimitiveType, first: number, count: number, numInstances: number): void {\r\n    this._computePass.end();\r\n    this._renderPass.draw(program, vertexData, stateSet, bindGroups, bindGroupOffsets, primitiveType, first, count, numInstances);\r\n  }\r\n  setViewport();\r\n  setViewport(x: number, y: number, w: number, h: number): void;\r\n  setViewport(x?: number, y?: number, w?: number, h?: number): void {\r\n    this._renderPass.setViewport(x, y, w, h);\r\n  }\r\n  getViewport(): number[] {\r\n    return this._renderPass.getViewport();\r\n  }\r\n  setScissor();\r\n  setScissor(x: number, y: number, w: number, h: number): void;\r\n  setScissor(x?: number, y?: number, w?: number, h?: number): void {\r\n    this._renderPass.setScissor(x, y, w, h);\r\n  }\r\n  getScissor(): number[] {\r\n    return this._renderPass.getScissor();\r\n  }\r\n  clear(color: Vector4, depth: number, stencil: number): void {\r\n    this._renderPass.clear(color, depth, stencil);\r\n  }\r\n  isBufferUploading(buffer: WebGPUBuffer): boolean {\r\n    return this._renderPass.isBufferUploading(buffer) || this._computePass.isBufferUploading(buffer);\r\n  }\r\n  isTextureUploading(tex: WebGPUBaseTexture): boolean {\r\n    return this._renderPass.isTextureUploading(tex) || this._computePass.isTextureUploading(tex);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}