{"version":3,"file":"reflection.js","sources":["../../../../../libs/device/src/device/builder/reflection.ts"],"sourcesContent":["import type { PBGlobalScope, ProgramBuilder } from './programbuilder';\nimport type { PBShaderExp } from './base';\n\nexport type PBReflectionTagGetter = (scope: PBGlobalScope)=>PBShaderExp;\n\nexport class PBReflection {\n  /** @internal */\n  private _builder: ProgramBuilder;\n  /** @internal */\n  private _tagList: Record<string, PBReflectionTagGetter>;\n  /** @internal */\n  private _attribList: Record<number, PBShaderExp>;\n  constructor(builder: ProgramBuilder) {\n    this._builder = builder;\n    this._tagList = {};\n    this._attribList = {};\n  }\n  get vertexAttributes(): number[] {\n    return this._builder.getVertexAttributes();\n  }\n  hasVertexAttribute(attrib: number): boolean {\n    return this.vertexAttributes.indexOf(attrib) >= 0;\n  }\n  clear(): void {\n    this._tagList = {};\n    this._attribList = {};\n  }\n  tag(name: string): PBShaderExp;\n  tag(name: string, getter: PBReflectionTagGetter): void;\n  tag(values: Record<string, PBReflectionTagGetter>): void;\n  tag(arg0: string|Record<string, PBReflectionTagGetter>, arg1?: PBReflectionTagGetter): PBShaderExp|void {\n    if (typeof arg0 === 'string') {\n      if (arg1 === undefined) {\n        return this.getTag(arg0);\n      } else {\n        this.addTag(arg0, arg1);\n      }\n    } else {\n      for (const k of Object.keys(arg0)) {\n        this.addTag(k, arg0[k]);\n      }\n    }\n  }\n  attribute(attrib: number): PBShaderExp {\n    return this._attribList[attrib] || null;\n  }\n  /** @internal */\n  setAttrib(attrib: number, exp: PBShaderExp) {\n    this._attribList[attrib] = exp;\n  }\n  /** @internal */\n  private addTag(name: string, exp: PBReflectionTagGetter): void {\n    this._tagList[name] = exp;\n  }\n  /** @internal */\n  private getTag(name: string): PBShaderExp {\n    const getter = this._tagList[name];\n    return getter ? getter(this._builder.globalScope) : null;\n  }\n}\n"],"names":[],"mappings":";MAKa,YAAY,CAAA;AAEf,IAAA,QAAQ,CAAiB;AAEzB,IAAA,QAAQ,CAAwC;AAEhD,IAAA,WAAW,CAA8B;AACjD,IAAA,WAAA,CAAY,OAAuB,EAAA;AACjC,QAAA,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AACxB,QAAA,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,QAAA,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;KACvB;AACD,IAAA,IAAI,gBAAgB,GAAA;AAClB,QAAA,OAAO,IAAI,CAAC,QAAQ,CAAC,mBAAmB,EAAE,CAAC;KAC5C;AACD,IAAA,kBAAkB,CAAC,MAAc,EAAA;QAC/B,OAAO,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KACnD;IACD,KAAK,GAAA;AACH,QAAA,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,QAAA,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;KACvB;IAID,GAAG,CAAC,IAAkD,EAAE,IAA4B,EAAA;AAClF,QAAA,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;YAC5B,IAAI,IAAI,KAAK,SAAS,EAAE;AACtB,gBAAA,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AAC1B,aAAA;AAAM,iBAAA;AACL,gBAAA,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACzB,aAAA;AACF,SAAA;AAAM,aAAA;YACL,KAAK,MAAM,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;gBACjC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACzB,aAAA;AACF,SAAA;KACF;AACD,IAAA,SAAS,CAAC,MAAc,EAAA;QACtB,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC;KACzC;IAED,SAAS,CAAC,MAAc,EAAE,GAAgB,EAAA;AACxC,QAAA,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;KAChC;IAEO,MAAM,CAAC,IAAY,EAAE,GAA0B,EAAA;AACrD,QAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC;KAC3B;AAEO,IAAA,MAAM,CAAC,IAAY,EAAA;QACzB,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACnC,QAAA,OAAO,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC;KAC1D;AACF;;;;"}