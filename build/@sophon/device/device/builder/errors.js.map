{"version":3,"file":"errors.js","sources":["../../../../../libs/device/src/device/builder/errors.ts"],"sourcesContent":["import { DeviceType } from '../device';\nimport type { ExpValueType } from './programbuilder';\nimport type { PBTypeInfo } from './types';\nimport type { ShaderAST } from './ast';\n\n/** @internal */\nexport function expValueToString(deviceType: DeviceType, value: ExpValueType): string {\n  if (typeof value === 'number' || typeof value === 'boolean' || Array.isArray(value)) {\n    return `${value}`;\n  } else {\n    return value.$ast?.toString(deviceType);\n  }\n}\n\n/** @internal */\nexport function expValueTypeToString(deviceType: DeviceType, type: PBTypeInfo): string {\n  return type?.toTypeName(deviceType);\n}\n\n/** @internal */\nexport abstract class PBError extends Error {\n  abstract getMessage(deviceType: DeviceType): string;\n}\n\n/** @internal */\nexport class PBValueOutOfRange extends PBError {\n  value: number;\n  constructor(value: number) {\n    super();\n    this.value = value;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `value out of range: ${this.value}`;\n  }\n}\n\n/** @internal */\nexport class PBTypeCastError extends PBError {\n  value: ExpValueType|string;\n  valueType: PBTypeInfo|string;\n  expectedType: PBTypeInfo|string;\n  constructor(value: ExpValueType|string, valueType: PBTypeInfo|string, expectedType: PBTypeInfo|string) {\n    super();\n    this.value = value;\n    this.valueType = valueType;\n    this.expectedType = expectedType;\n  }\n  getMessage(deviceType: DeviceType): string {\n    const valueStr = typeof this.value === 'string' ? this.value : expValueToString(deviceType, this.value);\n    const valueTypeStr = typeof this.valueType === 'string' ? this.valueType : expValueTypeToString(deviceType, this.valueType);\n    const expectedTypeStr = typeof this.expectedType === 'string' ? this.expectedType : expValueTypeToString(deviceType, this.expectedType);\n    return `cannot convert '${valueStr}' of type '${valueTypeStr}' to type ${expectedTypeStr}`;\n  }\n}\n\n/** @internal */\nexport class PBParamLengthError extends PBError {\n  func: string;\n  constructor(func: string) {\n    super();\n    this.func = func;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `wrong argument count for function '${this.func}'`;\n  }\n}\n\n/** @internal */\nexport class PBParamTypeError extends PBError {\n  func: string;\n  param: string;\n  constructor(func: string, param?: string) {\n    super();\n    this.func = func;\n    this.param = param || null;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `parameter type error for function '${this.func}': ${this.param}`;\n  }\n}\n\n/** @internal */\nexport class PBParamValueError extends PBError {\n  func: string;\n  param: string;\n  reason: string;\n  constructor(func: string, param?: string, reason?: string) {\n    super();\n    this.func = func;\n    this.param = param || null;\n    this.reason = reason || null;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `invalid parameter value for function '${this.func}'${this.param ? ': ' + this.param : ''}${this.reason ? ': ' + this.reason : ''}}`;\n  }\n}\n\n/** @internal */\nexport class PBOverloadingMatchError extends PBError {\n  func: string;\n  constructor(func: string) {\n    super();\n    this.func = func;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `No matched overloading found for function '${this.func}'`;\n  }\n}\n\n/** @internal */\nexport class PBReferenceValueRequired extends PBError {\n  value: ExpValueType;\n  constructor(value: ExpValueType) {\n    super();\n    this.value = value;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `'${expValueToString(deviceType, this.value)}' is not a reference type`;\n  }\n}\n\n/** @internal */\nexport class PBPointerValueRequired extends PBError {\n  value: ExpValueType;\n  constructor(value: ExpValueType) {\n    super();\n    this.value = value;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `'${expValueToString(deviceType, this.value)}' is not a pointer type`;\n  }\n}\n\n/** @internal */\nexport class PBUndeclaredIdentifier extends PBError {\n  constructor(identifier: string) {\n    super(`undeclared identifier: ${identifier}`);\n  }\n  getMessage(deviceType: DeviceType): string {\n    return this.message;\n  }\n}\n\n/** @internal */\nexport class PBDeviceNotSupport extends PBError {\n  feature: string;\n  constructor(feature: string) {\n    super();\n    this.feature = feature;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `feature not support for ${deviceType} device: ${this.feature}`;\n  }\n}\n\n/** @internal */\nexport class PBNonScopedFunctionCall extends PBError {\n  funcName: string;\n  constructor(funcName: string) {\n    super();\n    this.funcName = funcName;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `function call must be made inside a function scope: ${this.funcName}()`;\n  }\n}\n\n/** @internal */\nexport class PBASTError extends PBError {\n  ast: ShaderAST;\n  text: string;\n  constructor(ast: ShaderAST, text: string) {\n    super();\n    this.ast = ast;\n    this.text = text;\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `${this.text}: ${this.ast.toString(deviceType)}`;\n  }\n}\n\n/** @internal */\nexport class PBInternalError extends PBError {\n  constructor(desc: string) {\n    super(desc);\n  }\n  getMessage(deviceType: DeviceType): string {\n    return `Internal error: ${this.message}`;\n  }\n}\n"],"names":[],"mappings":"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"}