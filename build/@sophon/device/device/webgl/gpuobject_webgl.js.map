{"version":3,"file":"gpuobject_webgl.js","sources":["../../../../../libs/device/src/device/webgl/gpuobject_webgl.ts"],"sourcesContent":["import { Device, DeviceGPUObjectRenameEvent } from '../device';\r\nimport { genDefaultName, BindGroup, VertexInputLayout, TextureSampler, BaseTexture, Texture2D, Texture2DArray, Texture3D, TextureCube, TextureVideo, FrameBuffer, GPUDataBuffer, GPUProgram, GPUObject } from '../gpuobject';\r\nimport type { WebGLDevice } from './device_webgl';\r\n\r\nlet _uniqueId = 0;\r\n\r\nexport abstract class WebGLGPUObject<T> implements GPUObject<T> {\r\n  protected _device: WebGLDevice;\r\n  protected _object: T;\r\n  protected _uid: number;\r\n  protected _cid: number;\r\n  protected _name: string;\r\n  protected _restoreHandler: (obj: GPUObject) => Promise<void>;\r\n  constructor(device: WebGLDevice) {\r\n    this._device = device;\r\n    this._object = null;\r\n    this._uid = ++_uniqueId;\r\n    this._cid = 1;\r\n    this._name = `${genDefaultName(this)}#${this._uid}`;\r\n    this._restoreHandler = null;\r\n    this._device.addGPUObject(this);\r\n  }\r\n  get device(): Device {\r\n    return this._device;\r\n  }\r\n  get object(): T {\r\n    return this._object;\r\n  }\r\n  get disposed(): boolean {\r\n    return !this._object;\r\n  }\r\n  get restoreHandler(): (obj: GPUObject) => Promise<void> {\r\n    return this._restoreHandler;\r\n  }\r\n  set restoreHandler(handler: (obj: GPUObject) => Promise<void>) {\r\n    this._restoreHandler = handler;\r\n  }\r\n  get uid(): number {\r\n    return this._uid;\r\n  }\r\n  get cid(): number {\r\n    return this._cid;\r\n  }\r\n  get name(): string {\r\n    return this._name;\r\n  }\r\n  set name(val: string) {\r\n    if (val !== this._name) {\r\n      const evt = new DeviceGPUObjectRenameEvent(this, this._name);\r\n      this._name = val;\r\n      this._device.dispatchEvent(evt);\r\n    }\r\n  }\r\n  isVAO(): this is VertexInputLayout {\r\n    return false;\r\n  }\r\n  isFramebuffer(): this is FrameBuffer {\r\n    return false;\r\n  }\r\n  isSampler(): this is TextureSampler {\r\n    return false;\r\n  }\r\n  isTexture(): this is BaseTexture {\r\n    return false;\r\n  }\r\n  isTexture2D(): this is Texture2D {\r\n    return false;\r\n  }\r\n  isTexture2DArray(): this is Texture2DArray {\r\n    return false;\r\n  }\r\n  isTexture3D(): this is Texture3D {\r\n    return false;\r\n  }\r\n  isTextureCube(): this is TextureCube {\r\n    return false;\r\n  }\r\n  isTextureVideo(): this is TextureVideo {\r\n    return false;\r\n  }\r\n  isProgram(): this is GPUProgram {\r\n    return false;\r\n  }\r\n  isBuffer(): this is GPUDataBuffer {\r\n    return false;\r\n  }\r\n  isBindGroup(): this is BindGroup {\r\n    return false;\r\n  }\r\n  dispose(): void {\r\n    if (!this.disposed) {\r\n      this._device.disposeObject(this, true);\r\n    }\r\n  }\r\n  async reload(): Promise<void> {\r\n    if (this.disposed) {\r\n      const p = this._device.restoreObject(this);\r\n      this._cid++;\r\n      return p;\r\n    }\r\n  }\r\n  destroy(): void {\r\n    throw new Error('Abstract function call: destroy()');\r\n  }\r\n  async restore(): Promise<void> {\r\n    throw new Error('Abstract function call: restore()');\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}