{"version":3,"file":"gpuobject_webgl.js","sources":["../../../../../libs/device/src/device/webgl/gpuobject_webgl.ts"],"sourcesContent":["import { Device, DeviceGPUObjectRenameEvent } from '../device';\nimport { genDefaultName, BindGroup, VertexInputLayout, TextureSampler, BaseTexture, Texture2D, Texture2DArray, Texture3D, TextureCube, TextureVideo, FrameBuffer, GPUDataBuffer, GPUProgram, GPUObject } from '../gpuobject';\nimport type { WebGLDevice } from './device_webgl';\n\nlet _uniqueId = 0;\n\nexport abstract class WebGLGPUObject<T> implements GPUObject<T> {\n  protected _device: WebGLDevice;\n  protected _object: T;\n  protected _uid: number;\n  protected _cid: number;\n  protected _name: string;\n  protected _restoreHandler: (obj: GPUObject) => Promise<void>;\n  constructor(device: WebGLDevice) {\n    this._device = device;\n    this._object = null;\n    this._uid = ++_uniqueId;\n    this._cid = 1;\n    this._name = `${genDefaultName(this)}#${this._uid}`;\n    this._restoreHandler = null;\n    this._device.addGPUObject(this);\n  }\n  get device(): Device {\n    return this._device;\n  }\n  get object(): T {\n    return this._object;\n  }\n  get disposed(): boolean {\n    return !this._object;\n  }\n  get restoreHandler(): (obj: GPUObject) => Promise<void> {\n    return this._restoreHandler;\n  }\n  set restoreHandler(handler: (obj: GPUObject) => Promise<void>) {\n    this._restoreHandler = handler;\n  }\n  get uid(): number {\n    return this._uid;\n  }\n  get cid(): number {\n    return this._cid;\n  }\n  get name(): string {\n    return this._name;\n  }\n  set name(val: string) {\n    if (val !== this._name) {\n      const evt = new DeviceGPUObjectRenameEvent(this, this._name);\n      this._name = val;\n      this._device.dispatchEvent(evt);\n    }\n  }\n  isVAO(): this is VertexInputLayout {\n    return false;\n  }\n  isFramebuffer(): this is FrameBuffer {\n    return false;\n  }\n  isSampler(): this is TextureSampler {\n    return false;\n  }\n  isTexture(): this is BaseTexture {\n    return false;\n  }\n  isTexture2D(): this is Texture2D {\n    return false;\n  }\n  isTexture2DArray(): this is Texture2DArray {\n    return false;\n  }\n  isTexture3D(): this is Texture3D {\n    return false;\n  }\n  isTextureCube(): this is TextureCube {\n    return false;\n  }\n  isTextureVideo(): this is TextureVideo {\n    return false;\n  }\n  isProgram(): this is GPUProgram {\n    return false;\n  }\n  isBuffer(): this is GPUDataBuffer {\n    return false;\n  }\n  isBindGroup(): this is BindGroup {\n    return false;\n  }\n  dispose(): void {\n    if (!this.disposed) {\n      this._device.disposeObject(this, true);\n    }\n  }\n  async reload(): Promise<void> {\n    if (this.disposed) {\n      const p = this._device.restoreObject(this);\n      this._cid++;\n      return p;\n    }\n  }\n  destroy(): void {\n    throw new Error('Abstract function call: destroy()');\n  }\n  async restore(): Promise<void> {\n    throw new Error('Abstract function call: restore()');\n  }\n}\n"],"names":[],"mappings":"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"}