{"version":3,"file":"fps.js","sources":["../../../../../libs/device/src/scene/cameralib/fps.ts"],"sourcesContent":["import { Vector3, Quaternion, Matrix3x3, Matrix4x4 } from '@sophon/base';\r\nimport { BaseCameraModel } from './base';\r\nimport type { AbstractCameraModel, IMouseEvent, IKeyEvent } from '../camera';\r\nexport interface IFPSCameraModelOptions {\r\n  controlKeys?: {\r\n    up: string;\r\n    down: string;\r\n    forward: string;\r\n    backward: string;\r\n    left: string;\r\n    right: string;\r\n  };\r\n  moveSpeed?: number;\r\n  rotateSpeed?: number;\r\n}\r\n\r\nexport class FPSCameraModel extends BaseCameraModel implements AbstractCameraModel {\r\n  /** @internal */\r\n  private options: IFPSCameraModelOptions;\r\n  /** @internal */\r\n  private mouseDown: boolean;\r\n  /** @internal */\r\n  private lastMouseX: number;\r\n  /** @internal */\r\n  private lastMouseY: number;\r\n  /** @internal */\r\n  private keyUp: boolean;\r\n  /** @internal */\r\n  private keyDown: boolean;\r\n  /** @internal */\r\n  private keyLeft: boolean;\r\n  /** @internal */\r\n  private keyRight: boolean;\r\n  /** @internal */\r\n  private keyForward: boolean;\r\n  /** @internal */\r\n  private keyBackward: boolean;\r\n  constructor(options?: IFPSCameraModelOptions) {\r\n    super();\r\n    this.options = Object.assign(\r\n      {\r\n        controlKeys: {\r\n          up: 'KeyQ',\r\n          down: 'KeyE',\r\n          forward: 'KeyW',\r\n          backward: 'KeyS',\r\n          left: 'KeyA',\r\n          right: 'KeyD',\r\n        },\r\n        moveSpeed: 0.2,\r\n        rotateSpeed: 0.01,\r\n      },\r\n      options || {},\r\n    );\r\n  }\r\n  reset() {\r\n    this.mouseDown = false;\r\n    this.lastMouseX = 0;\r\n    this.lastMouseY = 0;\r\n    this.keyUp = false;\r\n    this.keyDown = false;\r\n    this.keyLeft = false;\r\n    this.keyRight = false;\r\n    this.keyForward = false;\r\n    this.keyBackward = false;\r\n  }\r\n  /** @internal */\r\n  protected _onMouseDown(evt: IMouseEvent) {\r\n    if (evt.button === 0) {\r\n      this.mouseDown = true;\r\n      this.lastMouseX = evt.offsetX;\r\n      this.lastMouseY = evt.offsetY;\r\n    }\r\n  }\r\n  /** @internal */\r\n  protected _onMouseUp(evt: IMouseEvent) {\r\n    if (evt.button === 0) {\r\n      this.mouseDown = false;\r\n    }\r\n  }\r\n  /** @internal */\r\n  protected _onMouseWheel() {\r\n    void 0;\r\n  }\r\n  /** @internal */\r\n  protected _onMouseMove(evt: IMouseEvent) {\r\n    if (this.mouseDown) {\r\n      const dx = evt.offsetX - this.lastMouseX;\r\n      const dy = evt.offsetY - this.lastMouseY;\r\n      this.lastMouseX = evt.offsetX;\r\n      this.lastMouseY = evt.offsetY;\r\n      const zAxis = this._getCamera().worldMatrix.getRow(2).xyz();\r\n      const alpha = Math.atan2(zAxis.z, zAxis.x) + dx * this.options.rotateSpeed;\r\n      const beta = Math.min(\r\n        Math.PI / 2.1,\r\n        Math.max(-Math.PI / 2.1, Math.asin(zAxis.y) + dy * this.options.rotateSpeed),\r\n      );\r\n      const newY = Math.sin(beta);\r\n      const r = Math.sqrt(Math.max(0, 1 - newY * newY));\r\n      const newZ = Math.sin(alpha) * r;\r\n      const newX = Math.cos(alpha) * r;\r\n      zAxis.set(newX, newY, newZ).inplaceNormalize();\r\n      const XAxis = Vector3.cross(Vector3.axisPY(), zAxis).inplaceNormalize();\r\n      const YAxis = Vector3.cross(zAxis, XAxis).inplaceNormalize();\r\n      const rotation = Quaternion.fromRotationMatrix(\r\n        new Matrix3x3([\r\n          XAxis.x,\r\n          XAxis.y,\r\n          XAxis.z,\r\n          YAxis.x,\r\n          YAxis.y,\r\n          YAxis.z,\r\n          zAxis.x,\r\n          zAxis.y,\r\n          zAxis.z,\r\n        ]),\r\n      );\r\n      if (!this._getCamera().parent) {\r\n        this._getCamera().rotation = rotation;\r\n      } else {\r\n        const pos = new Vector3();\r\n        const scale = new Vector3();\r\n        this._getCamera().worldMatrix.decompose(scale, null, pos);\r\n        const newWorldMatrix = Matrix4x4.scaling(scale).rotateLeft(rotation).translateLeft(pos);\r\n        const newLocalMatrix = this._getCamera().parent ? newWorldMatrix.multiplyLeftAffine(Matrix4x4.inverseAffine(this._getCamera().parent.worldMatrix)) : newWorldMatrix;\r\n        newLocalMatrix.decompose(scale, rotation, pos);\r\n        this._getCamera().position = pos;\r\n        this._getCamera().scaling = scale;\r\n        this._getCamera().rotation = rotation;\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  protected _onKeyDown(evt: IKeyEvent) {\r\n    switch (evt.code) {\r\n      case this.options.controlKeys.up:\r\n        this.keyUp = true;\r\n        break;\r\n      case this.options.controlKeys.down:\r\n        this.keyDown = true;\r\n        break;\r\n      case this.options.controlKeys.left:\r\n        this.keyLeft = true;\r\n        break;\r\n      case this.options.controlKeys.right:\r\n        this.keyRight = true;\r\n        break;\r\n      case this.options.controlKeys.forward:\r\n        this.keyForward = true;\r\n        break;\r\n      case this.options.controlKeys.backward:\r\n        this.keyBackward = true;\r\n        break;\r\n    }\r\n  }\r\n  /** @internal */\r\n  protected _onKeyUp(evt: IKeyEvent) {\r\n    switch (evt.code) {\r\n      case this.options.controlKeys.up:\r\n        this.keyUp = false;\r\n        break;\r\n      case this.options.controlKeys.down:\r\n        this.keyDown = false;\r\n        break;\r\n      case this.options.controlKeys.left:\r\n        this.keyLeft = false;\r\n        break;\r\n      case this.options.controlKeys.right:\r\n        this.keyRight = false;\r\n        break;\r\n      case this.options.controlKeys.forward:\r\n        this.keyForward = false;\r\n        break;\r\n      case this.options.controlKeys.backward:\r\n        this.keyBackward = false;\r\n        break;\r\n    }\r\n  }\r\n  setOptions(opt?: IFPSCameraModelOptions) {\r\n    opt && Object.assign(this.options, opt);\r\n    this.reset();\r\n  }\r\n  update() {\r\n    const x = this._getCamera().worldMatrix.getRow(0).xyz().setY(0).inplaceNormalize();\r\n    if (x.isNaN()) {\r\n      console.log(`Camera error 1: ${x.toString()}`);\r\n    }\r\n    const z = this._getCamera().worldMatrix.getRow(2).xyz().inplaceNormalize();\r\n    if (z.isNaN()) {\r\n      console.log(`Camera error 2: ${z.toString()}`);\r\n    }\r\n    const move = new Vector3(0, 0, 0);\r\n    let changed = false;\r\n    if (this.keyForward) {\r\n      changed = true;\r\n      move.subBy(Vector3.scale(z, this.options.moveSpeed));\r\n    }\r\n    if (this.keyBackward) {\r\n      changed = true;\r\n      move.addBy(Vector3.scale(z, this.options.moveSpeed));\r\n    }\r\n    if (this.keyUp) {\r\n      changed = true;\r\n      move.y += this.options.moveSpeed;\r\n    }\r\n    if (this.keyDown) {\r\n      changed = true;\r\n      move.y -= this.options.moveSpeed;\r\n    }\r\n    if (this.keyLeft) {\r\n      changed = true;\r\n      move.subBy(Vector3.scale(x, this.options.moveSpeed));\r\n    }\r\n    if (this.keyRight) {\r\n      changed = true;\r\n      move.addBy(Vector3.scale(x, this.options.moveSpeed));\r\n    }\r\n    if (changed) {\r\n      if (this._getCamera().parent) {\r\n        const pos = new Vector3();\r\n        const scale = new Vector3();\r\n        const rotation = new Quaternion();\r\n        this._getCamera().worldMatrix.decompose(scale, rotation, pos);\r\n        pos.addBy(move);\r\n        const newWorldMatrix = Matrix4x4.scaling(scale).rotateLeft(rotation).translateLeft(pos);\r\n        const newLocalMatrix = newWorldMatrix.multiplyLeftAffine(Matrix4x4.inverseAffine(this._getCamera().parent.worldMatrix));\r\n        newLocalMatrix.decompose(scale, rotation, pos);\r\n        if (scale.isNaN() || rotation.isNaN() || pos.isNaN()) {\r\n          console.log(`Camera error 3: ${scale.toString()} ${rotation.toString()} ${pos.toString()}`);\r\n        }\r\n        this._getCamera().position = pos;\r\n        this._getCamera().scaling = scale;\r\n        this._getCamera().rotation = rotation;\r\n      } else {\r\n        this._getCamera().position.addBy(move);\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}