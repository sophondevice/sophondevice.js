{"version":3,"file":"dds_loader.js","sources":["../../../../../../../libs/device/src/scene/asset/loaders/dds/dds_loader.ts"],"sourcesContent":["import { BaseTexture, GPUResourceUsageFlags, TextureCreationOptions } from '../../../../device/gpuobject';\nimport { getDDSMipLevelsInfo } from './dds';\nimport { AbstractTextureLoader } from '../loader';\nimport type { AssetManager } from '../../assetmanager';\n\nexport class DDSLoader extends AbstractTextureLoader {\n  supportExtension(ext: string): boolean {\n    return ext === '.dds';\n  }\n  supportMIMEType(mimeType: string): boolean {\n    return mimeType === 'image/dds';\n  }\n  async load(assetManager: AssetManager, url: string, mimeType: string, data: ArrayBuffer, srgb: boolean, noMipmap: boolean, texture?: BaseTexture): Promise<BaseTexture> {\n    const arrayBuffer = data;\n    const mipmapLevelData = getDDSMipLevelsInfo(arrayBuffer);\n    if (!mipmapLevelData) {\n      throw new Error(`read DDS file failed: ${url}`);\n    }\n    const options: TextureCreationOptions = {\n      colorSpace: srgb ? 'srgb' : 'linear',\n      noMipmap: !!noMipmap,\n      texture: texture\n    }\n    if (mipmapLevelData.isCubemap) {\n      return assetManager.device.createCubeTextureFromMipmapData(mipmapLevelData, options);\n    } else if (mipmapLevelData.isVolume) {\n      throw new Error(`load DDS volume texture is not supported`);\n    } else {\n      return assetManager.device.createTexture2DFromMipmapData(mipmapLevelData, options);\n    }\n  }\n}\n\n"],"names":[],"mappings":";;;;AAKM,MAAO,SAAU,SAAQ,qBAAqB,CAAA;AAClD,IAAA,gBAAgB,CAAC,GAAW,EAAA;QAC1B,OAAO,GAAG,KAAK,MAAM,CAAC;KACvB;AACD,IAAA,eAAe,CAAC,QAAgB,EAAA;QAC9B,OAAO,QAAQ,KAAK,WAAW,CAAC;KACjC;AACD,IAAA,MAAM,IAAI,CAAC,YAA0B,EAAE,GAAW,EAAE,QAAgB,EAAE,IAAiB,EAAE,IAAa,EAAE,QAAiB,EAAE,OAAqB,EAAA;QAC9I,MAAM,WAAW,GAAG,IAAI,CAAC;AACzB,QAAA,MAAM,eAAe,GAAG,mBAAmB,CAAC,WAAW,CAAC,CAAC;QACzD,IAAI,CAAC,eAAe,EAAE;AACpB,YAAA,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,CAAA,CAAE,CAAC,CAAC;AACjD,SAAA;AACD,QAAA,MAAM,OAAO,GAA2B;YACtC,UAAU,EAAE,IAAI,GAAG,MAAM,GAAG,QAAQ;YACpC,QAAQ,EAAE,CAAC,CAAC,QAAQ;AACpB,YAAA,OAAO,EAAE,OAAO;SACjB,CAAA;QACD,IAAI,eAAe,CAAC,SAAS,EAAE;YAC7B,OAAO,YAAY,CAAC,MAAM,CAAC,+BAA+B,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;AACtF,SAAA;aAAM,IAAI,eAAe,CAAC,QAAQ,EAAE;AACnC,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,wCAAA,CAA0C,CAAC,CAAC;AAC7D,SAAA;AAAM,aAAA;YACL,OAAO,YAAY,CAAC,MAAM,CAAC,6BAA6B,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;AACpF,SAAA;KACF;AACF;;;;"}