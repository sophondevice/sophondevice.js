{"version":3,"file":"dds_loader.js","sources":["../../../../../../../libs/device/src/scene/asset/loaders/dds/dds_loader.ts"],"sourcesContent":["import { BaseTexture, GPUResourceUsageFlags, TextureCreationOptions } from '../../../../device/gpuobject';\r\nimport { getDDSMipLevelsInfo } from './dds';\r\nimport { AbstractTextureLoader } from '../loader';\r\nimport type { AssetManager } from '../../assetmanager';\r\n\r\nexport class DDSLoader extends AbstractTextureLoader {\r\n  supportExtension(ext: string): boolean {\r\n    return ext === '.dds';\r\n  }\r\n  supportMIMEType(mimeType: string): boolean {\r\n    return mimeType === 'image/dds';\r\n  }\r\n  async load(assetManager: AssetManager, url: string, mimeType: string, data: ArrayBuffer, srgb: boolean, noMipmap: boolean, texture?: BaseTexture): Promise<BaseTexture> {\r\n    const arrayBuffer = data;\r\n    const mipmapLevelData = getDDSMipLevelsInfo(arrayBuffer);\r\n    if (!mipmapLevelData) {\r\n      throw new Error(`read DDS file failed: ${url}`);\r\n    }\r\n    const options: TextureCreationOptions = {\r\n      colorSpace: srgb ? 'srgb' : 'linear',\r\n      noMipmap: !!noMipmap,\r\n      texture: texture\r\n    }\r\n    if (mipmapLevelData.isCubemap) {\r\n      return assetManager.device.createCubeTextureFromMipmapData(mipmapLevelData, options);\r\n    } else if (mipmapLevelData.isVolume) {\r\n      throw new Error(`load DDS volume texture is not supported`);\r\n    } else {\r\n      return assetManager.device.createTexture2DFromMipmapData(mipmapLevelData, options);\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAKM,MAAO,SAAU,SAAQ,qBAAqB,CAAA;AAClD,IAAA,gBAAgB,CAAC,GAAW,EAAA;QAC1B,OAAO,GAAG,KAAK,MAAM,CAAC;KACvB;AACD,IAAA,eAAe,CAAC,QAAgB,EAAA;QAC9B,OAAO,QAAQ,KAAK,WAAW,CAAC;KACjC;AACD,IAAA,MAAM,IAAI,CAAC,YAA0B,EAAE,GAAW,EAAE,QAAgB,EAAE,IAAiB,EAAE,IAAa,EAAE,QAAiB,EAAE,OAAqB,EAAA;QAC9I,MAAM,WAAW,GAAG,IAAI,CAAC;AACzB,QAAA,MAAM,eAAe,GAAG,mBAAmB,CAAC,WAAW,CAAC,CAAC;QACzD,IAAI,CAAC,eAAe,EAAE;AACpB,YAAA,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,CAAA,CAAE,CAAC,CAAC;AACjD,SAAA;AACD,QAAA,MAAM,OAAO,GAA2B;YACtC,UAAU,EAAE,IAAI,GAAG,MAAM,GAAG,QAAQ;YACpC,QAAQ,EAAE,CAAC,CAAC,QAAQ;AACpB,YAAA,OAAO,EAAE,OAAO;SACjB,CAAA;QACD,IAAI,eAAe,CAAC,SAAS,EAAE;YAC7B,OAAO,YAAY,CAAC,MAAM,CAAC,+BAA+B,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;AACtF,SAAA;aAAM,IAAI,eAAe,CAAC,QAAQ,EAAE;AACnC,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,wCAAA,CAA0C,CAAC,CAAC;AAC7D,SAAA;AAAM,aAAA;YACL,OAAO,YAAY,CAAC,MAAM,CAAC,6BAA6B,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;AACpF,SAAA;KACF;AACF;;;;"}