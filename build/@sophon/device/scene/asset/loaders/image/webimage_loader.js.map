{"version":3,"file":"webimage_loader.js","sources":["../../../../../../../libs/device/src/scene/asset/loaders/image/webimage_loader.ts"],"sourcesContent":["import { BaseTexture, TextureCreationOptions } from '../../../../device/gpuobject';\r\nimport { AbstractTextureLoader } from '../loader';\r\nimport type { AssetManager } from '../../assetmanager';\r\n\r\nexport class WebImageLoader extends AbstractTextureLoader {\r\n  supportExtension(ext: string): boolean {\r\n    return ext === '.jpg' || ext === '.jpeg' || ext === '.png';\r\n  }\r\n  supportMIMEType(mimeType: string): boolean {\r\n    return mimeType === 'image/jpg' || mimeType === 'image/jpeg' || mimeType === 'image/png';\r\n  }\r\n  async load(assetManager: AssetManager, filename: string, mimeType: string, data: ArrayBuffer, srgb: boolean, noMipmap: boolean, texture?: BaseTexture): Promise<BaseTexture> {\r\n    return new Promise<BaseTexture>((resolve, reject) => {\r\n      if (!mimeType) {\r\n        reject('unknown image file type');\r\n      }\r\n      const src = URL.createObjectURL(new Blob([data], { type: mimeType }));\r\n      const img = document.createElement('img');\r\n      img.src = src;\r\n\r\n      img.onload = () => {\r\n        createImageBitmap(img, {\r\n          premultiplyAlpha: 'none',\r\n          colorSpaceConversion: 'none',\r\n        }).then(bm => {\r\n          const options: TextureCreationOptions = {\r\n            colorSpace: srgb ? 'srgb' : 'linear',\r\n            noMipmap: !!noMipmap,\r\n            texture: texture\r\n          };\r\n          const tex = assetManager.device.createTexture2DFromImage(bm, options);\r\n          if (tex) {\r\n            resolve(tex);\r\n          } else {\r\n            reject('create texture from image element failed');\r\n          }\r\n        });\r\n      };\r\n      img.onerror = err => {\r\n        reject(err);\r\n      };\r\n    });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;AAIM,MAAO,cAAe,SAAQ,qBAAqB,CAAA;AACvD,IAAA,gBAAgB,CAAC,GAAW,EAAA;QAC1B,OAAO,GAAG,KAAK,MAAM,IAAI,GAAG,KAAK,OAAO,IAAI,GAAG,KAAK,MAAM,CAAC;KAC5D;AACD,IAAA,eAAe,CAAC,QAAgB,EAAA;QAC9B,OAAO,QAAQ,KAAK,WAAW,IAAI,QAAQ,KAAK,YAAY,IAAI,QAAQ,KAAK,WAAW,CAAC;KAC1F;AACD,IAAA,MAAM,IAAI,CAAC,YAA0B,EAAE,QAAgB,EAAE,QAAgB,EAAE,IAAiB,EAAE,IAAa,EAAE,QAAiB,EAAE,OAAqB,EAAA;QACnJ,OAAO,IAAI,OAAO,CAAc,CAAC,OAAO,EAAE,MAAM,KAAI;YAClD,IAAI,CAAC,QAAQ,EAAE;gBACb,MAAM,CAAC,yBAAyB,CAAC,CAAC;AACnC,aAAA;YACD,MAAM,GAAG,GAAG,GAAG,CAAC,eAAe,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;YACtE,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AAC1C,YAAA,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC;AAEd,YAAA,GAAG,CAAC,MAAM,GAAG,MAAK;gBAChB,iBAAiB,CAAC,GAAG,EAAE;AACrB,oBAAA,gBAAgB,EAAE,MAAM;AACxB,oBAAA,oBAAoB,EAAE,MAAM;AAC7B,iBAAA,CAAC,CAAC,IAAI,CAAC,EAAE,IAAG;AACX,oBAAA,MAAM,OAAO,GAA2B;wBACtC,UAAU,EAAE,IAAI,GAAG,MAAM,GAAG,QAAQ;wBACpC,QAAQ,EAAE,CAAC,CAAC,QAAQ;AACpB,wBAAA,OAAO,EAAE,OAAO;qBACjB,CAAC;AACF,oBAAA,MAAM,GAAG,GAAG,YAAY,CAAC,MAAM,CAAC,wBAAwB,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC;AACtE,oBAAA,IAAI,GAAG,EAAE;wBACP,OAAO,CAAC,GAAG,CAAC,CAAC;AACd,qBAAA;AAAM,yBAAA;wBACL,MAAM,CAAC,0CAA0C,CAAC,CAAC;AACpD,qBAAA;AACH,iBAAC,CAAC,CAAC;AACL,aAAC,CAAC;AACF,YAAA,GAAG,CAAC,OAAO,GAAG,GAAG,IAAG;gBAClB,MAAM,CAAC,GAAG,CAAC,CAAC;AACd,aAAC,CAAC;AACJ,SAAC,CAAC,CAAC;KACJ;AACF;;;;"}