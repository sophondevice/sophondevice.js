{"version":3,"file":"gltf_loader.js","sources":["../../../../../../../libs/device/src/scene/asset/loaders/gltf/gltf_loader.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { Vector3, Vector4, Matrix4x4, Quaternion } from '@sophon/base';\r\nimport { TextureFilter, TextureWrapping, PrimitiveType } from '../../../../device/base_types';\r\nimport { FaceMode } from '../../../../device/render_states';\r\nimport {\r\n  VERTEX_ATTRIB_POSITION,\r\n  VERTEX_ATTRIB_NORMAL,\r\n  VERTEX_ATTRIB_TANGENT,\r\n  VERTEX_ATTRIB_TEXCOORD0,\r\n  VERTEX_ATTRIB_TEXCOORD1,\r\n  VERTEX_ATTRIB_TEXCOORD2,\r\n  VERTEX_ATTRIB_TEXCOORD3,\r\n  VERTEX_ATTRIB_TEXCOORD4,\r\n  VERTEX_ATTRIB_TEXCOORD5,\r\n  VERTEX_ATTRIB_TEXCOORD6,\r\n  VERTEX_ATTRIB_TEXCOORD7,\r\n  getVertexAttribName,\r\n  VERTEX_ATTRIB_DIFFUSE,\r\n  VERTEX_ATTRIB_BLEND_INDICES,\r\n  VERTEX_ATTRIB_BLEND_WEIGHT,\r\n  getVertexBufferAttribType\r\n} from '../../../../device/gpuobject';\r\nimport {\r\n  I8_BITMASK,\r\n  U8_BITMASK,\r\n  I16_BITMASK,\r\n  U16_BITMASK,\r\n  I32_BITMASK,\r\n  U32_BITMASK,\r\n  F32_BITMASK,\r\n  makePrimitiveType,\r\n} from '../../../../device/builder/types';\r\nimport { SharedModel, AssetHierarchyNode, AssetMeshData, AssetSkeleton, AssetScene, AssetAnimationData, AssetSubMeshData, AssetMaterial, AssetUnlitMaterial, AssetPBRMaterialMR, AssetPBRMaterialSG, AssetMaterialCommon, MaterialTextureInfo, AssetPBRMaterialCommon } from '../../model';\r\nimport { BoundingBox } from '../../../bounding_volume';\r\nimport { Primitive } from '../../../primitive';\r\nimport { StandardMaterial, UnlitMaterial, PBRMetallicRoughnessMaterial, PBRSpecularGlossinessMaterial } from '../../../materiallib';\r\nimport { ComponentType, GLTFAccessor } from './helpers';\r\nimport { Interpolator, InterpolationMode, InterpolationTarget } from '../../../interpolator';\r\nimport { AbstractModelLoader } from '../loader';\r\nimport { BUILTIN_ASSET_TEXTURE_SHEEN_LUT } from '../../../values';\r\nimport { PBStructTypeInfo, PBArrayTypeInfo, PBPrimitiveTypeInfo } from '../../../../device/builder/types';\r\nimport type { AssetManager } from '../../assetmanager';\r\nimport type { AnimationChannel, AnimationSampler, GlTf, Material, TextureInfo } from './gltf';\r\nimport type { TypedArray } from '../../../../misc';\r\nimport type { GPUDataBuffer, Texture2D, IndexBuffer, StructuredBuffer } from '../../../../device/gpuobject';\r\n\r\nexport interface GLTFContent extends GlTf {\r\n  _manager: AssetManager;\r\n  _loadedBuffers: ArrayBuffer[];\r\n  _accessors: GLTFAccessor[];\r\n  _bufferCache: { [name: string]: GPUDataBuffer };\r\n  _textureCache: { [name: string]: Texture2D };\r\n  _primitiveCache: { [hash: string]: Primitive };\r\n  _materialCache: { [hash: string]: StandardMaterial };\r\n  _accessorCache: { [index: number]: { array: TypedArray, typeMask: number, elementCount: number } };\r\n  _nodes: AssetHierarchyNode[];\r\n  _meshes: AssetMeshData[];\r\n}\r\n\r\nexport class GLTFLoader extends AbstractModelLoader {\r\n  supportExtension(ext: string): boolean {\r\n    return ext === '.gltf' || ext === '.glb';\r\n  }\r\n  supportMIMEType(mimeType: string): boolean {\r\n    return mimeType === 'model/gltf+json' || mimeType === 'model/gltf-binary';\r\n  }\r\n  async load(assetManager: AssetManager, url: string, mimeType: string, data: Blob) {\r\n    const buffer = await data.arrayBuffer();\r\n    if (this.isGLB(buffer)) {\r\n      return this.loadBinary(assetManager, url, buffer);\r\n    }\r\n    const gltf = await new Response(data).json() as GLTFContent;\r\n    gltf._manager = assetManager;\r\n    gltf._loadedBuffers = null;\r\n    return this.loadJson(url, gltf);\r\n  }\r\n  async loadBinary(assetManager: AssetManager, url: string, buffer: ArrayBuffer): Promise<SharedModel> {\r\n    const jsonChunkType = 0x4E4F534A;\r\n    const binaryChunkType = 0x004E4942;\r\n    let gltf: GLTFContent = null;\r\n    const buffers: ArrayBuffer[] = [];\r\n    const chunkInfos = this.getGLBChunkInfos(buffer);\r\n    for (const info of chunkInfos) {\r\n      if (info.type === jsonChunkType && !gltf) {\r\n        const jsonSlice = new Uint8Array(buffer, 20, info.length);\r\n        const stringBuffer = new TextDecoder('utf-8').decode(jsonSlice);\r\n        gltf = JSON.parse(stringBuffer);\r\n      } else if (info.type === binaryChunkType) {\r\n        buffers.push(buffer.slice(info.start, info.start + info.length));\r\n      }\r\n    }\r\n    if (gltf) {\r\n      gltf._manager = assetManager;\r\n      gltf._loadedBuffers = buffers;\r\n      return this.loadJson(url, gltf);\r\n    }\r\n    return null;\r\n  }\r\n  async loadJson(url: string, gltf: GLTFContent): Promise<SharedModel> {\r\n    console.log(`GLTF extensions used: ${gltf.extensionsUsed || []}`);\r\n    gltf._accessors = [];\r\n    gltf._bufferCache = {};\r\n    gltf._textureCache = {};\r\n    gltf._primitiveCache = {};\r\n    gltf._materialCache = {};\r\n    gltf._accessorCache = {};\r\n    gltf._nodes = [];\r\n    gltf._meshes = [];\r\n    // check asset property\r\n    const asset = gltf.asset;\r\n    if (asset) {\r\n      const gltfVersion = asset.version;\r\n      if (gltfVersion !== '2.0') {\r\n        console.error(`Invalid GLTF version: ${gltfVersion}`);\r\n        return null;\r\n      }\r\n    }\r\n    gltf._baseURI = url.substring(0, url.lastIndexOf('/') + 1);\r\n    if (!gltf._loadedBuffers) {\r\n      gltf._loadedBuffers = [];\r\n      const buffers = gltf.buffers;\r\n      if (buffers) {\r\n        for (const buffer of buffers) {\r\n          const uri = this._normalizeURI(gltf._baseURI, buffer.uri);\r\n          const buf = await gltf._manager.fetchBinaryData(uri);\r\n          // const buf = (await new FileLoader(null, 'arraybuffer').load(uri)) as ArrayBuffer;\r\n          if (buffer.byteLength !== buf.byteLength) {\r\n            console.error(`Invalid GLTF: buffer byte length error.`);\r\n            return null;\r\n          }\r\n          gltf._loadedBuffers.push(buf);\r\n        }\r\n      }\r\n    }\r\n    const accessors = gltf.accessors;\r\n    if (accessors) {\r\n      for (const accessor of gltf.accessors) {\r\n        gltf._accessors.push(new GLTFAccessor(accessor));\r\n      }\r\n    }\r\n    const scenes = gltf.scenes;\r\n    if (scenes) {\r\n      const sharedModel = new SharedModel();\r\n      await this._loadMeshes(gltf, sharedModel);\r\n      this._loadNodes(gltf, sharedModel);\r\n      this._loadSkins(gltf, sharedModel);\r\n      for (let i = 0; i < gltf.nodes?.length; i++) {\r\n        if (typeof gltf.nodes[i].skin === 'number' && gltf.nodes[i].skin >= 0) {\r\n          gltf._nodes[i].skeleton = sharedModel.skeletons[gltf.nodes[i].skin];\r\n        }\r\n      }\r\n      this._loadAnimations(gltf, sharedModel);\r\n      for (const scene of scenes) {\r\n        const assetScene = new AssetScene(scene.name);\r\n        for (const node of scene.nodes) {\r\n          assetScene.rootNodes.push(gltf._nodes[node]);\r\n        }\r\n        sharedModel.scenes.push(assetScene);\r\n      }\r\n      if (typeof gltf.scene === 'number') {\r\n        sharedModel.activeScene = gltf.scene;\r\n      }\r\n      return sharedModel;\r\n    }\r\n    return null;\r\n  }\r\n  /** @internal */\r\n  private _normalizeURI(baseURI: string, uri: string) {\r\n    const s = uri.toLowerCase();\r\n    if (s.startsWith('http://')\r\n      || s.startsWith('https://')\r\n      || s.startsWith('blob:')\r\n      || s.startsWith('data:')) {\r\n      // absolute path\r\n      return encodeURI(uri);\r\n    }\r\n    uri = uri.replace(/\\.\\//g, '');\r\n    uri = decodeURIComponent(uri);\r\n    if (uri[0] === '/') {\r\n      uri = uri.slice(1);\r\n    }\r\n    uri = uri.split('/').map(val => encodeURIComponent(val)).join('/');\r\n    return baseURI + uri;\r\n  }\r\n  /** @internal */\r\n  private _loadNodes(gltf: GLTFContent, model: SharedModel) {\r\n    if (gltf.nodes) {\r\n      for (let i = 0; i < gltf.nodes.length; i++) {\r\n        this._loadNode(gltf, i, null, model);\r\n      }\r\n      for (const node of gltf._nodes) {\r\n        if (!node.parent) {\r\n          node.computeTransforms(null);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  private _loadSkins(gltf: GLTFContent, model: SharedModel) {\r\n    if (gltf.skins) {\r\n      for (let i = 0; i < gltf.skins.length; i++) {\r\n        const skinInfo = gltf.skins[i];\r\n        const skeleton = new AssetSkeleton(skinInfo.name);\r\n        if (typeof skinInfo.skeleton === 'number') {\r\n          skeleton.pivot = gltf._nodes[skinInfo.skeleton];\r\n        }\r\n        const accessor = gltf._accessors[skinInfo.inverseBindMatrices];\r\n        if (!accessor || accessor.type !== 'MAT4' || accessor.componentType !== ComponentType.FLOAT) {\r\n          throw new Error('Invalid GLTF inverse bind matricies accessor');\r\n        }\r\n        const matrices = typeof skinInfo.inverseBindMatrices === 'number' ? accessor.getDeinterlacedView(gltf) as Float32Array : null;\r\n        skinInfo.joints.forEach((joint, index) => {\r\n          const m = index * 16;\r\n          skeleton.addJoint(gltf._nodes[joint], matrices ? new Matrix4x4(matrices.subarray(m, m + 16)) : Matrix4x4.identity());\r\n        });\r\n        model.addSkeleton(skeleton);\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  private _loadAnimations(gltf: GLTFContent, model: SharedModel) {\r\n    if (gltf.animations) {\r\n      for (let i = 0; i < gltf.animations.length; i++) {\r\n        const animation = this._loadAnimation(gltf, i, model);\r\n        model.addAnimation(animation);\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  private collectNodes(gltf: GLTFContent): Map<AssetHierarchyNode, {\r\n    translate: Vector3,\r\n    scale: Vector3,\r\n    rotation: Quaternion,\r\n    worldTransform: Matrix4x4\r\n  }> {\r\n    const collect: Map<AssetHierarchyNode, {\r\n      translate: Vector3,\r\n      scale: Vector3,\r\n      rotation: Quaternion,\r\n      worldTransform: Matrix4x4\r\n    }> = new Map();\r\n    for (const node of gltf._nodes) {\r\n      collect.set(node, {\r\n        translate: node.position || Vector3.zero(),\r\n        rotation: node.rotation || Quaternion.identity(),\r\n        scale: node.scaling || Vector3.one(),\r\n        worldTransform: null\r\n      });\r\n    }\r\n    return collect;\r\n  }\r\n  /** @internal */\r\n  private updateNodeTransform(nodeTransforms: Map<AssetHierarchyNode, {\r\n    translate: Vector3,\r\n    scale: Vector3,\r\n    rotation: Quaternion,\r\n    worldTransform: Matrix4x4\r\n  }>, node: AssetHierarchyNode) {\r\n    const transform = nodeTransforms.get(node);\r\n    if (!transform.worldTransform) {\r\n      transform.worldTransform = Matrix4x4.scaling(transform.scale).rotateLeft(transform.rotation).translateLeft(transform.translate);\r\n      if (node.parent) {\r\n        this.updateNodeTransform(nodeTransforms, node.parent);\r\n        transform.worldTransform.multiplyLeft(nodeTransforms.get(node.parent).worldTransform);\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  private getAnimationInfo(gltf: GLTFContent, index: number): {\r\n    name: string;\r\n    channels: AnimationChannel[],\r\n    samplers: AnimationSampler[],\r\n    interpolators: Interpolator[],\r\n    maxTime: number,\r\n    nodes: Map<AssetHierarchyNode, {\r\n      translate: Vector3,\r\n      scale: Vector3,\r\n      rotation: Quaternion,\r\n      worldTransform: Matrix4x4\r\n    }>\r\n  } {\r\n    const animationInfo = gltf.animations[index];\r\n    const name = animationInfo.name || null;\r\n    const channels = animationInfo.channels;\r\n    const samplers = animationInfo.samplers;\r\n    const interpolators = [] as Interpolator[];\r\n    const nodes = this.collectNodes(gltf);\r\n    let maxTime = 0;\r\n    for (let i = 0; i < channels.length; i++) {\r\n      const channel = channels[i];\r\n      const sampler = samplers[channel.sampler];\r\n      const input = gltf._accessors[sampler.input].getNormalizedDeinterlacedView(gltf);\r\n      const output = gltf._accessors[sampler.output].getNormalizedDeinterlacedView(gltf);\r\n      const mode = sampler.interpolation === 'STEP'\r\n        ? InterpolationMode.STEP\r\n        : sampler.interpolation === 'CUBICSPLINE'\r\n          ? InterpolationMode.CUBICSPLINE\r\n          : InterpolationMode.LINEAR;\r\n      const target = channel.target.path === 'rotation'\r\n        ? InterpolationTarget.ROTATION\r\n        : channel.target.path === 'translation'\r\n          ? InterpolationTarget.TRANSLATION\r\n          : channel.target.path === 'scale'\r\n            ? InterpolationTarget.SCALING\r\n            : InterpolationTarget.WEIGHTS;\r\n      // TODO: morph target animation\r\n      interpolators.push(new Interpolator(mode, target, input, output, 0));\r\n      const max = input[input.length - 1];\r\n      if (max > maxTime) {\r\n        maxTime = max;\r\n      }\r\n    }\r\n    return { name, channels, samplers, interpolators, maxTime, nodes };\r\n  }\r\n  /** @internal */\r\n  private _loadAnimation(gltf: GLTFContent, index: number, model: SharedModel): AssetAnimationData {\r\n    const animationInfo = this.getAnimationInfo(gltf, index);\r\n    const animationData: AssetAnimationData = { name: animationInfo.name, tracks: [], skeletons: [], nodes: [] };\r\n    for (let i = 0; i < animationInfo.channels.length; i++) {\r\n      const targetNode = gltf._nodes[animationInfo.channels[i].target.node];\r\n      animationData.tracks.push({\r\n        node: targetNode,\r\n        interpolator: animationInfo.interpolators[i]\r\n      });\r\n      if (animationData.nodes.indexOf(targetNode) < 0) {\r\n        animationData.nodes.push(targetNode);\r\n      }\r\n      if (targetNode.skeletonAttached && animationData.skeletons.indexOf(targetNode.skeletonAttached) < 0) {\r\n        animationData.skeletons.push(targetNode.skeletonAttached);\r\n      }\r\n    }\r\n    return animationData;\r\n  }\r\n  /** @internal */\r\n  private _loadNode(gltf: GLTFContent, nodeIndex: number, parent: AssetHierarchyNode, model: SharedModel): AssetHierarchyNode {\r\n    let node: AssetHierarchyNode = gltf._nodes[nodeIndex];\r\n    if (node) {\r\n      if (parent) {\r\n        if (node.parent) {\r\n          throw new Error('invalid node hierarchy');\r\n        }\r\n        parent.addChild(node);\r\n      }\r\n      return node;\r\n    }\r\n    const nodeInfo = gltf.nodes?.[nodeIndex];\r\n    if (nodeInfo) {\r\n      node = model.addNode(parent, nodeIndex, nodeInfo.name);\r\n      if (typeof nodeInfo.mesh === 'number') {\r\n        node.mesh = gltf._meshes[nodeInfo.mesh];\r\n      }\r\n      if (!(typeof nodeInfo.skin === 'number') || nodeInfo.skin < 0) {\r\n        // GLTF spec: Only the joint transforms are applied to the skinned mesh; the transform of the skinned mesh node MUST be ignored.\r\n        if (nodeInfo.matrix) {\r\n          const matrix = new Matrix4x4(nodeInfo.matrix);\r\n          matrix.decompose(node.scaling, node.rotation, node.position);\r\n        } else {\r\n          if (nodeInfo.rotation) {\r\n            node.rotation.assign(nodeInfo.rotation);\r\n          }\r\n          if (nodeInfo.scale) {\r\n            node.scaling.assign(nodeInfo.scale);\r\n          }\r\n          if (nodeInfo.translation) {\r\n            node.position.assign(nodeInfo.translation);\r\n          }\r\n        }\r\n      }\r\n      gltf._nodes[nodeIndex] = node;\r\n      if (nodeInfo.children) {\r\n        for (const childIndex of nodeInfo.children) {\r\n          this._loadNode(gltf, childIndex, node, model);\r\n        }\r\n      }\r\n    } else {\r\n      throw new Error(`invalid GLTF node: ${nodeIndex}`);\r\n    }\r\n    return node;\r\n  }\r\n  /** @internal */\r\n  private async _loadMeshes(gltf: GLTFContent, model: SharedModel) {\r\n    if (gltf.meshes) {\r\n      for (let i = 0; i < gltf.meshes.length; i++) {\r\n        gltf._meshes[i] = await this._loadMesh(gltf, i);\r\n      }\r\n    }\r\n  }\r\n  /** @internal */\r\n  private async _loadMesh(gltf: GLTFContent, meshIndex: number): Promise<AssetMeshData> {\r\n    const meshInfo = gltf.meshes && gltf.meshes[meshIndex];\r\n    let mesh: AssetMeshData = null;\r\n    if (meshInfo) {\r\n      mesh = { subMeshes: [] };\r\n      const primitives = meshInfo.primitives;\r\n      const meshName = meshInfo.name || null;\r\n      if (primitives) {\r\n        for (const p of primitives) {\r\n          const subMeshData: AssetSubMeshData = {\r\n            primitive: null,\r\n            material: null,\r\n            rawPositions: null,\r\n            rawBlendIndices: null,\r\n            rawJointWeights: null,\r\n          };\r\n          const hash = `(${Object.getOwnPropertyNames(p.attributes).sort().map(k => `${k}:${p.attributes[k]}`).join(',')})-(${p.indices})-(${p.mode})`;\r\n          let primitive: Primitive = p.targets ? null : gltf._primitiveCache[hash];\r\n          if (!primitive) {\r\n            primitive = new Primitive(gltf._manager.device);\r\n            const attributes = p.attributes;\r\n            for (const attrib in attributes) {\r\n              this._loadVertexBuffer(gltf, attrib, attributes[attrib], primitive, subMeshData);\r\n            }\r\n            const indices = p.indices;\r\n            if (typeof indices === 'number') {\r\n              this._loadIndexBuffer(gltf, indices, primitive, subMeshData);\r\n            }\r\n            let primitiveType = p.mode;\r\n            if (typeof primitiveType !== 'number') {\r\n              primitiveType = 4;\r\n            }\r\n            primitive.primitiveType = this._primitiveType(primitiveType);\r\n            gltf._primitiveCache[hash] = primitive;\r\n          }\r\n          const hasVertexNormal = !!primitive.getVertexBuffer('normal');\r\n          const hasVertexColor = !!primitive.getVertexBuffer('diffuse');\r\n          const hasVertexTangent = !!primitive.getVertexBuffer('tangent');\r\n          const materialHash = `${p.material}.${Number(hasVertexNormal)}.${Number(hasVertexColor)}.${Number(hasVertexTangent)}`;\r\n          let material = gltf._materialCache[materialHash];\r\n          if (!material) {\r\n            const materialInfo = p.material !== undefined ? gltf.materials[p.material] : null;\r\n            material = await this._loadMaterial(gltf, materialInfo, hasVertexColor, hasVertexNormal, hasVertexTangent);\r\n            gltf._materialCache[materialHash] = material;\r\n          }\r\n          subMeshData.primitive = primitive;\r\n          subMeshData.material = material;\r\n          mesh.subMeshes.push(subMeshData);\r\n        }\r\n      }\r\n    }\r\n    return mesh;\r\n  }\r\n  private async _createMaterial(assetManager: AssetManager, assetMaterial: AssetMaterial): Promise<StandardMaterial> {\r\n    if (assetMaterial.type === 'unlit') {\r\n      const unlitAssetMaterial = assetMaterial as AssetUnlitMaterial;\r\n      const unlitMaterial = new UnlitMaterial(assetManager.device);\r\n      unlitMaterial.lightModel.albedo = unlitAssetMaterial.diffuse ?? Vector4.one();\r\n      if (unlitAssetMaterial.diffuseMap) {\r\n        unlitMaterial.lightModel.setAlbedoMap(unlitAssetMaterial.diffuseMap.texture, unlitAssetMaterial.diffuseMap.sampler, unlitAssetMaterial.diffuseMap.texCoord, unlitAssetMaterial.diffuseMap.transform);\r\n      }\r\n      unlitMaterial.vertexColor = unlitAssetMaterial.common.vertexColor;\r\n      if (assetMaterial.common.alphaMode === 'blend') {\r\n        unlitMaterial.alphaBlend = true;\r\n      } else if (assetMaterial.common.alphaMode === 'mask') {\r\n        unlitMaterial.alphaCutoff = assetMaterial.common.alphaCutoff;\r\n      }\r\n      if (assetMaterial.common.doubleSided) {\r\n        const rasterizerState = unlitMaterial.stateSet.useRasterizerState();\r\n        rasterizerState.setCullMode(FaceMode.NONE);\r\n      }\r\n      unlitMaterial.vertexNormal = !!assetMaterial.common.vertexNormal;\r\n      return unlitMaterial;\r\n    } else if (assetMaterial.type === 'pbrSpecularGlossiness') {\r\n      const assetPBRMaterial = assetMaterial as AssetPBRMaterialSG;\r\n      const pbrMaterial = new PBRSpecularGlossinessMaterial(assetManager.device);\r\n      pbrMaterial.lightModel.ior = assetPBRMaterial.ior;\r\n      pbrMaterial.lightModel.albedo = assetPBRMaterial.diffuse;\r\n      pbrMaterial.lightModel.specularFactor = new Vector4(assetPBRMaterial.specular.x, assetPBRMaterial.specular.y, assetPBRMaterial.specular.z, 1);\r\n      pbrMaterial.lightModel.glossinessFactor = assetPBRMaterial.glossness;\r\n      if (assetPBRMaterial.diffuseMap) {\r\n        pbrMaterial.lightModel.setAlbedoMap(assetPBRMaterial.diffuseMap.texture, assetPBRMaterial.diffuseMap.sampler, assetPBRMaterial.diffuseMap.texCoord, assetPBRMaterial.diffuseMap.transform);\r\n      }\r\n      if (assetPBRMaterial.common.normalMap) {\r\n        pbrMaterial.lightModel.setNormalMap(assetPBRMaterial.common.normalMap.texture, assetPBRMaterial.common.normalMap.sampler, assetPBRMaterial.common.normalMap.texCoord, assetPBRMaterial.common.normalMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.normalScale = assetPBRMaterial.common.bumpScale;\r\n      if (assetPBRMaterial.common.emissiveMap) {\r\n        pbrMaterial.lightModel.setEmissiveMap(assetPBRMaterial.common.emissiveMap.texture, assetPBRMaterial.common.emissiveMap.sampler, assetPBRMaterial.common.emissiveMap.texCoord, assetPBRMaterial.common.emissiveMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.emissiveColor = assetPBRMaterial.common.emissiveColor;\r\n      pbrMaterial.lightModel.emissiveStrength = assetPBRMaterial.common.emissiveStrength;\r\n      if (assetPBRMaterial.common.occlusionMap) {\r\n        pbrMaterial.lightModel.setOcclusionMap(assetPBRMaterial.common.occlusionMap.texture, assetPBRMaterial.common.occlusionMap.sampler, assetPBRMaterial.common.occlusionMap.texCoord, assetPBRMaterial.common.occlusionMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.occlusionStrength = assetPBRMaterial.common.occlusionStrength;\r\n      if (assetPBRMaterial.specularGlossnessMap) {\r\n        pbrMaterial.lightModel.setSpecularMap(assetPBRMaterial.specularGlossnessMap.texture, assetPBRMaterial.specularGlossnessMap.sampler, assetPBRMaterial.specularGlossnessMap.texCoord, assetPBRMaterial.specularGlossnessMap.transform);\r\n      }\r\n      pbrMaterial.vertexTangent = assetPBRMaterial.common.useTangent;\r\n      pbrMaterial.vertexColor = assetPBRMaterial.common.vertexColor;\r\n      if (assetPBRMaterial.common.alphaMode === 'blend') {\r\n        pbrMaterial.alphaBlend = true;\r\n      } else if (assetPBRMaterial.common.alphaMode === 'mask') {\r\n        pbrMaterial.alphaCutoff = assetPBRMaterial.common.alphaCutoff;\r\n      }\r\n      if (assetPBRMaterial.common.doubleSided) {\r\n        const rasterizerState = pbrMaterial.stateSet.useRasterizerState();\r\n        rasterizerState.setCullMode(FaceMode.NONE);\r\n      }\r\n      pbrMaterial.vertexNormal = !!assetMaterial.common.vertexNormal;\r\n      return pbrMaterial;\r\n    } else if (assetMaterial.type === 'pbrMetallicRoughness') {\r\n      const assetPBRMaterial = assetMaterial as AssetPBRMaterialMR;\r\n      const pbrMaterial = new PBRMetallicRoughnessMaterial(assetManager.device);\r\n      pbrMaterial.lightModel.ior = assetPBRMaterial.ior;\r\n      pbrMaterial.lightModel.albedo = assetPBRMaterial.diffuse;\r\n      pbrMaterial.lightModel.metallic = assetPBRMaterial.metallic;\r\n      pbrMaterial.lightModel.roughness = assetPBRMaterial.roughness;\r\n      if (assetPBRMaterial.diffuseMap) {\r\n        pbrMaterial.lightModel.setAlbedoMap(assetPBRMaterial.diffuseMap.texture, assetPBRMaterial.diffuseMap.sampler, assetPBRMaterial.diffuseMap.texCoord, assetPBRMaterial.diffuseMap.transform);\r\n      }\r\n      if (assetPBRMaterial.common.normalMap) {\r\n        pbrMaterial.lightModel.setNormalMap(assetPBRMaterial.common.normalMap.texture, assetPBRMaterial.common.normalMap.sampler, assetPBRMaterial.common.normalMap.texCoord, assetPBRMaterial.common.normalMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.normalScale = assetPBRMaterial.common.bumpScale;\r\n      if (assetPBRMaterial.common.emissiveMap) {\r\n        pbrMaterial.lightModel.setEmissiveMap(assetPBRMaterial.common.emissiveMap.texture, assetPBRMaterial.common.emissiveMap.sampler, assetPBRMaterial.common.emissiveMap.texCoord, assetPBRMaterial.common.emissiveMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.emissiveColor = assetPBRMaterial.common.emissiveColor;\r\n      pbrMaterial.lightModel.emissiveStrength = assetPBRMaterial.common.emissiveStrength;\r\n      if (assetPBRMaterial.common.occlusionMap) {\r\n        pbrMaterial.lightModel.setOcclusionMap(assetPBRMaterial.common.occlusionMap.texture, assetPBRMaterial.common.occlusionMap.sampler, assetPBRMaterial.common.occlusionMap.texCoord, assetPBRMaterial.common.occlusionMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.occlusionStrength = assetPBRMaterial.common.occlusionStrength;\r\n      if (assetPBRMaterial.metallicMap) {\r\n        pbrMaterial.lightModel.setMetallicMap(assetPBRMaterial.metallicMap.texture, assetPBRMaterial.metallicMap.sampler, assetPBRMaterial.metallicMap.texCoord, assetPBRMaterial.metallicMap.transform);\r\n      }\r\n      pbrMaterial.lightModel.metallicIndex = assetPBRMaterial.metallicIndex;\r\n      pbrMaterial.lightModel.roughnessIndex = assetPBRMaterial.roughnessIndex;\r\n      pbrMaterial.lightModel.specularFactor = assetPBRMaterial.specularFactor;\r\n      if (assetPBRMaterial.specularMap) {\r\n        pbrMaterial.lightModel.setSpecularMap(assetPBRMaterial.specularMap.texture, assetPBRMaterial.specularMap.sampler, assetPBRMaterial.specularMap.texCoord, assetPBRMaterial.specularMap.transform);\r\n      }\r\n      if (assetPBRMaterial.specularColorMap) {\r\n        pbrMaterial.lightModel.setSpecularColorMap(assetPBRMaterial.specularColorMap.texture, assetPBRMaterial.specularColorMap.sampler, assetPBRMaterial.specularColorMap.texCoord, assetPBRMaterial.specularColorMap.transform);\r\n      }\r\n      if (assetPBRMaterial.sheen) {\r\n        const sheen = assetPBRMaterial.sheen;\r\n        pbrMaterial.lightModel.useSheen = true;\r\n        pbrMaterial.lightModel.sheenColorFactor = sheen.sheenColorFactor;\r\n        pbrMaterial.lightModel.sheenRoughnessFactor = sheen.sheenRoughnessFactor;\r\n        pbrMaterial.lightModel.setSheenLut(await assetManager.fetchBuiltinTexture(BUILTIN_ASSET_TEXTURE_SHEEN_LUT));\r\n        if (sheen.sheenColorMap) {\r\n          pbrMaterial.lightModel.setSheenColorMap(sheen.sheenColorMap.texture, sheen.sheenColorMap.sampler, sheen.sheenColorMap.texCoord, sheen.sheenColorMap.transform);\r\n        }\r\n        if (sheen.sheenRoughnessMap) {\r\n          pbrMaterial.lightModel.setSheenRoughnessMap(sheen.sheenRoughnessMap.texture, sheen.sheenRoughnessMap.sampler, sheen.sheenRoughnessMap.texCoord, sheen.sheenRoughnessMap.transform)\r\n        }\r\n      }\r\n      if (assetPBRMaterial.clearcoat) {\r\n        const cc = assetPBRMaterial.clearcoat;\r\n        pbrMaterial.lightModel.useClearcoat = true;\r\n        pbrMaterial.lightModel.clearcoatIntensity = cc.clearCoatFactor;\r\n        pbrMaterial.lightModel.clearcoatRoughnessFactor = cc.clearCoatRoughnessFactor;\r\n        if (cc.clearCoatIntensityMap) {\r\n          pbrMaterial.lightModel.setClearcoatIntensityMap(cc.clearCoatIntensityMap.texture, cc.clearCoatIntensityMap.sampler, cc.clearCoatIntensityMap.texCoord, cc.clearCoatIntensityMap.transform);\r\n        }\r\n        if (cc.clearCoatRoughnessMap) {\r\n          pbrMaterial.lightModel.setClearcoatRoughnessMap(cc.clearCoatRoughnessMap.texture, cc.clearCoatRoughnessMap.sampler, cc.clearCoatRoughnessMap.texCoord, cc.clearCoatRoughnessMap.transform);\r\n        }\r\n        if (cc.clearCoatNormalMap) {\r\n          pbrMaterial.lightModel.setClearcoatNormalMap(cc.clearCoatNormalMap.texture, cc.clearCoatNormalMap.sampler, cc.clearCoatNormalMap.texCoord, cc.clearCoatNormalMap.transform);\r\n        }\r\n      }\r\n      pbrMaterial.vertexTangent = assetPBRMaterial.common.useTangent;\r\n      pbrMaterial.vertexColor = assetPBRMaterial.common.vertexColor;\r\n      if (assetPBRMaterial.common.alphaMode === 'blend') {\r\n        pbrMaterial.alphaBlend = true;\r\n      } else if (assetPBRMaterial.common.alphaMode === 'mask') {\r\n        pbrMaterial.alphaCutoff = assetPBRMaterial.common.alphaCutoff;\r\n      }\r\n      if (assetPBRMaterial.common.doubleSided) {\r\n        const rasterizerState = pbrMaterial.stateSet.useRasterizerState();\r\n        rasterizerState.setCullMode(FaceMode.NONE);\r\n      }\r\n      pbrMaterial.vertexNormal = !!assetMaterial.common.vertexNormal;\r\n      return pbrMaterial;\r\n    }\r\n  }\r\n  /** @internal */\r\n  private async _loadMaterial(gltf: GLTFContent, materialInfo: Material, vertexColor: boolean, vertexNormal: boolean, useTangent: boolean): Promise<StandardMaterial> {\r\n    let assetMaterial: AssetMaterial = null;\r\n    let pbrMetallicRoughness: AssetPBRMaterialMR = null;\r\n    let pbrSpecularGlossness: AssetPBRMaterialSG = null;\r\n    const pbrCommon: AssetMaterialCommon = {\r\n      useTangent,\r\n      vertexColor,\r\n      vertexNormal,\r\n      bumpScale: 1,\r\n      emissiveColor: Vector3.zero(),\r\n      emissiveStrength: 1,\r\n      occlusionStrength: 1,\r\n    };\r\n    switch (materialInfo?.alphaMode) {\r\n      case 'BLEND': {\r\n        pbrCommon.alphaMode = 'blend';\r\n        break;\r\n      }\r\n      case 'MASK': {\r\n        pbrCommon.alphaMode = 'mask';\r\n        pbrCommon.alphaCutoff = materialInfo.alphaCutoff ?? 0.5;\r\n        break;\r\n      }\r\n    }\r\n    if (materialInfo?.doubleSided) {\r\n      pbrCommon.doubleSided = true;\r\n    }\r\n    if (materialInfo?.pbrMetallicRoughness || materialInfo?.extensions?.KHR_materials_pbrSpecularGlossiness) {\r\n      pbrCommon.normalMap = materialInfo.normalTexture ? await this._loadTexture(gltf, materialInfo.normalTexture, false) : null;\r\n      pbrCommon.bumpScale = materialInfo.normalTexture?.scale ?? 1;\r\n      pbrCommon.occlusionMap = materialInfo.occlusionTexture ? await this._loadTexture(gltf, materialInfo.occlusionTexture, false) : null;\r\n      pbrCommon.occlusionStrength = materialInfo.occlusionTexture?.strength ?? 1;\r\n      pbrCommon.emissiveMap = materialInfo.emissiveTexture ? await this._loadTexture(gltf, materialInfo.emissiveTexture, false) : null;\r\n      pbrCommon.emissiveStrength = materialInfo?.extensions?.KHR_materials_emissive_strength?.emissiveStrength ?? 1;\r\n      pbrCommon.emissiveColor = materialInfo.emissiveFactor ? new Vector3(materialInfo.emissiveFactor) : Vector3.zero();\r\n    }\r\n    if (materialInfo?.pbrMetallicRoughness) {\r\n      pbrMetallicRoughness = {\r\n        type: 'pbrMetallicRoughness',\r\n        ior: 1.5,\r\n        common: pbrCommon,\r\n      };\r\n      pbrMetallicRoughness.diffuse = new Vector4(materialInfo.pbrMetallicRoughness.baseColorFactor ?? [1, 1, 1, 1]);\r\n      pbrMetallicRoughness.metallic = materialInfo.pbrMetallicRoughness.metallicFactor ?? 1;\r\n      pbrMetallicRoughness.roughness = materialInfo.pbrMetallicRoughness.roughnessFactor ?? 1;\r\n      pbrMetallicRoughness.diffuseMap = materialInfo.pbrMetallicRoughness.baseColorTexture ? await this._loadTexture(gltf, materialInfo.pbrMetallicRoughness.baseColorTexture, true) : null;\r\n      pbrMetallicRoughness.metallicMap = materialInfo.pbrMetallicRoughness.metallicRoughnessTexture ? await this._loadTexture(gltf, materialInfo.pbrMetallicRoughness.metallicRoughnessTexture, false) : null;\r\n      pbrMetallicRoughness.metallicIndex = 2;\r\n      pbrMetallicRoughness.roughnessIndex = 1;\r\n    }\r\n    if (materialInfo?.extensions?.KHR_materials_pbrSpecularGlossiness) {\r\n      const sg = materialInfo.extensions?.KHR_materials_pbrSpecularGlossiness;\r\n      pbrSpecularGlossness = {\r\n        type: 'pbrSpecularGlossiness',\r\n        ior: 1.5,\r\n        common: pbrCommon,\r\n      };\r\n      pbrSpecularGlossness.diffuse = new Vector4(sg.diffuseFactor ?? [1, 1, 1, 1]);\r\n      pbrSpecularGlossness.specular = new Vector3(sg.specularFactor ?? [1, 1, 1]);\r\n      pbrSpecularGlossness.glossness = sg.glossnessFactor ?? 1;\r\n      pbrSpecularGlossness.diffuseMap = sg.diffuseTexture ? await this._loadTexture(gltf, sg.diffuseTexture, true) : null;\r\n      pbrSpecularGlossness.specularGlossnessMap = sg.specularGlossinessTexture ? await this._loadTexture(gltf, sg.specularGlossinessTexture, true) : null;\r\n    }\r\n    assetMaterial = pbrSpecularGlossness || pbrMetallicRoughness;\r\n    if (!assetMaterial || materialInfo?.extensions?.KHR_materials_unlit) {\r\n      if (materialInfo?.extensions?.KHR_materials_unlit) {\r\n        assetMaterial = {\r\n          type: 'unlit',\r\n          common: pbrCommon,\r\n          diffuse: pbrMetallicRoughness?.diffuse ?? Vector4.one(),\r\n          diffuseMap: pbrMetallicRoughness?.diffuseMap ?? null,\r\n        } as AssetUnlitMaterial;\r\n      } else {\r\n        assetMaterial = {\r\n          type: 'pbrMetallicRoughness',\r\n          common: pbrCommon,\r\n          diffuse: Vector4.one(),\r\n          metallic: 1,\r\n          roughness: 1,\r\n          diffuseMap: null,\r\n          metallicMap: null,\r\n          metallicIndex: 2,\r\n          roughnessIndex: 1,\r\n        } as AssetPBRMaterialMR;\r\n      }\r\n    }\r\n    if (assetMaterial.type !== 'unlit' && materialInfo?.extensions?.KHR_materials_ior) {\r\n      (assetMaterial as AssetPBRMaterialCommon).ior = materialInfo.extensions.KHR_materials_ior.ior ?? 1.5;\r\n    }\r\n    if (assetMaterial.type === 'pbrMetallicRoughness') {\r\n      pbrMetallicRoughness = assetMaterial;\r\n      // KHR_materials_specular extension\r\n      pbrMetallicRoughness.specularFactor = new Vector4(new Vector3(materialInfo?.extensions?.KHR_materials_specular?.specularColorFactor ?? [1, 1, 1]), materialInfo?.extensions?.KHR_materials_specular?.specularFactor ?? 1);\r\n      pbrMetallicRoughness.specularMap = materialInfo?.extensions?.KHR_materials_specular?.specularTexture ? await this._loadTexture(gltf, materialInfo.extensions.KHR_materials_specular.specularTexture, false) : null;\r\n      pbrMetallicRoughness.specularColorMap = materialInfo?.extensions?.KHR_materials_specular?.specularColorTexture ? await this._loadTexture(gltf, materialInfo.extensions.KHR_materials_specular.specularColorTexture, true) : null;\r\n      // KHR_materials_sheen\r\n      const sheen = materialInfo?.extensions?.KHR_materials_sheen;\r\n      if (sheen) {\r\n        pbrMetallicRoughness.sheen = {\r\n          sheenColorFactor: new Vector3(sheen.sheenColorFactor ?? [0, 0, 0]),\r\n          sheenColorMap: sheen.sheenColorTexture ? await this._loadTexture(gltf, sheen.sheenColorTexture, true) : null,\r\n          sheenRoughnessFactor: sheen.sheenRoughnessFactor ?? 0,\r\n          sheenRoughnessMap: sheen.sheenRoughnessTexture ? await this._loadTexture(gltf, sheen.sheenRoughnessTexture, true) : null,\r\n        };\r\n      }\r\n      // KHR_materials_clearcoat\r\n      const cc = materialInfo?.extensions?.KHR_materials_clearcoat;\r\n      if (cc) {\r\n        pbrMetallicRoughness.clearcoat = {\r\n          clearCoatFactor: cc.clearcoatFactor ?? 0,\r\n          clearCoatIntensityMap: cc.clearcoatTexture ? await this._loadTexture(gltf, cc.clearcoatTexture, false) : null,\r\n          clearCoatRoughnessFactor: cc.clearcoatRoughnessFactor ?? 0,\r\n          clearCoatRoughnessMap: cc.clearcoatRoughnessTexture ? await this._loadTexture(gltf, cc.clearcoatRoughnessTexture, false) : null,\r\n          clearCoatNormalMap: cc.clearcoatNormalTexture ? await this._loadTexture(gltf, cc.clearcoatNormalTexture, false) : null\r\n        };\r\n      }\r\n    }\r\n    return await this._createMaterial(gltf._manager, assetMaterial);\r\n  }\r\n  /** @internal */\r\n  private async _loadTexture(gltf: GLTFContent, info: Partial<TextureInfo>, sRGB: boolean): Promise<MaterialTextureInfo> {\r\n    const mt: MaterialTextureInfo = {\r\n      texture: null,\r\n      sampler: null,\r\n      texCoord: info.texCoord ?? 0,\r\n      transform: null\r\n    };\r\n    const textureInfo = gltf.textures[info.index];\r\n    if (textureInfo) {\r\n      if (info.extensions?.KHR_texture_transform) {\r\n        const uvTransform = info.extensions.KHR_texture_transform;\r\n        if (uvTransform.texCoord !== undefined) {\r\n          mt.texCoord = uvTransform.texCoord;\r\n        }\r\n        const rotation = uvTransform.rotation !== undefined\r\n          ? Matrix4x4.rotationZ(-uvTransform.rotation)\r\n          : Matrix4x4.identity();\r\n        const scale = uvTransform.scale !== undefined\r\n          ? new Vector3(uvTransform.scale[0], uvTransform.scale[1], 1)\r\n          : Vector3.one();\r\n        const translation = uvTransform.offset !== undefined\r\n          ? new Vector3(uvTransform.offset[0], uvTransform.offset[1], 0)\r\n          : Vector3.zero();\r\n        mt.transform = Matrix4x4.scaling(scale).multiplyLeft(rotation).translateLeft(translation);\r\n      }\r\n      let wrapS: TextureWrapping = TextureWrapping.Repeat;\r\n      let wrapT: TextureWrapping = TextureWrapping.Repeat;\r\n      let magFilter: TextureFilter = TextureFilter.Linear;\r\n      let minFilter: TextureFilter = TextureFilter.Linear;\r\n      let mipFilter: TextureFilter = TextureFilter.Linear;\r\n      const samplerIndex: number = textureInfo.sampler;\r\n      const sampler = gltf.samplers && gltf.samplers[samplerIndex];\r\n      if (sampler) {\r\n        switch (sampler.wrapS) {\r\n          case 0x2901: // gl.REPEAT\r\n            wrapS = TextureWrapping.Repeat;\r\n            break;\r\n          case 0x8370: // gl.MIRRORED_REPEAT\r\n            wrapS = TextureWrapping.MirroredRepeat;\r\n            break;\r\n          case 0x812f: // gl.CLAMP_TO_EDGE\r\n            wrapS = TextureWrapping.ClampToEdge;\r\n            break;\r\n        }\r\n        switch (sampler.wrapT) {\r\n          case 0x2901: // gl.REPEAT\r\n            wrapT = TextureWrapping.Repeat;\r\n            break;\r\n          case 0x8370: // gl.MIRRORED_REPEAT\r\n            wrapT = TextureWrapping.MirroredRepeat;\r\n            break;\r\n          case 0x812f: // gl.CLAMP_TO_EDGE\r\n            wrapT = TextureWrapping.ClampToEdge;\r\n            break;\r\n        }\r\n        switch (sampler.magFilter) {\r\n          case 0x2600: // gl.NEAREST\r\n            magFilter = TextureFilter.Nearest;\r\n            break;\r\n          case 0x2601: // gl.LINEAR\r\n            magFilter = TextureFilter.Linear;\r\n            break;\r\n        }\r\n        switch (sampler.minFilter) {\r\n          case 0x2600: // gl.NEAREST\r\n            minFilter = TextureFilter.Nearest;\r\n            mipFilter = TextureFilter.None;\r\n            break;\r\n          case 0x2601: // gl.LINEAR\r\n            minFilter = TextureFilter.Linear;\r\n            mipFilter = TextureFilter.None;\r\n            break;\r\n          case 0x2700: // gl.NEAREST_MIPMAP_NEAREST\r\n            minFilter = TextureFilter.Nearest;\r\n            mipFilter = TextureFilter.Nearest;\r\n            break;\r\n          case 0x2701: // gl.LINEAR_MIPMAP_NEAREST\r\n            minFilter = TextureFilter.Linear;\r\n            mipFilter = TextureFilter.Nearest;\r\n            break;\r\n          case 0x2702: // gl.NEAREST_MIPMAP_LINEAR\r\n            minFilter = TextureFilter.Nearest;\r\n            mipFilter = TextureFilter.Linear;\r\n            break;\r\n          case 0x2703: // gl.LINEAR_MIPMAP_LINEAR\r\n            minFilter = TextureFilter.Linear;\r\n            mipFilter = TextureFilter.Linear;\r\n            break;\r\n        }\r\n      }\r\n      const imageIndex: number = textureInfo.source;\r\n      const hash = `${imageIndex}:${!!sRGB}:${wrapS}:${wrapT}:${minFilter}:${magFilter}:${mipFilter}`;\r\n      mt.texture = gltf._textureCache[hash];\r\n      if (!mt.texture) {\r\n        const image = gltf.images[imageIndex];\r\n        if (image) {\r\n          if (image.uri) {\r\n            const imageUrl = this._normalizeURI(gltf._baseURI, image.uri);\r\n            mt.texture = await gltf._manager.fetchTexture(imageUrl, null, sRGB);\r\n            mt.texture.name = imageUrl;\r\n          } else if (typeof image.bufferView === 'number' && image.mimeType) {\r\n            const bufferView = gltf.bufferViews && gltf.bufferViews[image.bufferView];\r\n            if (bufferView) {\r\n              const arrayBuffer = gltf._loadedBuffers && gltf._loadedBuffers[bufferView.buffer];\r\n              if (arrayBuffer) {\r\n                const view = new Uint8Array(\r\n                  arrayBuffer,\r\n                  bufferView.byteOffset || 0,\r\n                  bufferView.byteLength,\r\n                );\r\n                const mimeType = image.mimeType;\r\n                const blob = new Blob([view], { type: mimeType });\r\n                const sourceURI = URL.createObjectURL(blob);\r\n                mt.texture = await gltf._manager.fetchTexture(sourceURI, mimeType, sRGB);\r\n                URL.revokeObjectURL(sourceURI);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (mt.texture) {\r\n          gltf._textureCache[hash] = mt.texture;\r\n        }\r\n      }\r\n      if (mt.texture) {\r\n        mt.sampler = gltf._manager.device.createSampler({\r\n          addressU: wrapS,\r\n          addressV: wrapT,\r\n          magFilter: magFilter,\r\n          minFilter: minFilter,\r\n          mipFilter: mipFilter,\r\n        });\r\n      }\r\n    }\r\n    return mt;\r\n  }\r\n  /** @internal */\r\n  private _primitiveType(type: number): PrimitiveType {\r\n    switch (type) {\r\n      case 0: // GL_POINTS\r\n        return PrimitiveType.PointList;\r\n      case 1: // GL_LINES\r\n        return PrimitiveType.LineList;\r\n      /* FIXME:\r\n      case 2: // GL_LINE_LOOP\r\n        return PrimitiveType.LineLoop;\r\n      */\r\n      case 3: // GL_LINE_STRIP\r\n        return PrimitiveType.LineStrip;\r\n      case 4: // GL_TRIANGLES\r\n        return PrimitiveType.TriangleList;\r\n      case 5: // GL_TRIANGLE_STRIP\r\n        return PrimitiveType.TriangleStrip;\r\n      case 6: // GL_TRIANGLE_FAN\r\n        return PrimitiveType.TriangleFan;\r\n      default:\r\n        return PrimitiveType.Unknown;\r\n    }\r\n  }\r\n  /** @internal */\r\n  private _loadIndexBuffer(gltf: GLTFContent, accessorIndex: number, primitive: Primitive, meshData: AssetSubMeshData) {\r\n    this._setBuffer(gltf, accessorIndex, primitive, -1, meshData);\r\n  }\r\n  /** @internal */\r\n  private _loadVertexBuffer(\r\n    gltf: GLTFContent,\r\n    attribName: string,\r\n    accessorIndex: number,\r\n    primitive: Primitive,\r\n    subMeshData: AssetSubMeshData\r\n  ) {\r\n    let semantic: number;\r\n    switch (attribName) {\r\n      case 'POSITION':\r\n        semantic = VERTEX_ATTRIB_POSITION;\r\n        break;\r\n      case 'NORMAL':\r\n        semantic = VERTEX_ATTRIB_NORMAL;\r\n        break;\r\n      case 'TANGENT':\r\n        semantic = VERTEX_ATTRIB_TANGENT;\r\n        break;\r\n      case 'TEXCOORD_0':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD0;\r\n        break;\r\n      case 'TEXCOORD_1':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD1;\r\n        break;\r\n      case 'TEXCOORD_2':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD2;\r\n        break;\r\n      case 'TEXCOORD_3':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD3;\r\n        break;\r\n      case 'TEXCOORD_4':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD4;\r\n        break;\r\n      case 'TEXCOORD_5':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD5;\r\n        break;\r\n      case 'TEXCOORD_6':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD6;\r\n        break;\r\n      case 'TEXCOORD_7':\r\n        semantic = VERTEX_ATTRIB_TEXCOORD7;\r\n        break;\r\n      case 'COLOR_0':\r\n        semantic = VERTEX_ATTRIB_DIFFUSE;\r\n        break;\r\n      case 'JOINTS_0':\r\n        semantic = VERTEX_ATTRIB_BLEND_INDICES;\r\n        break;\r\n      case 'WEIGHTS_0':\r\n        semantic = VERTEX_ATTRIB_BLEND_WEIGHT;\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n    this._setBuffer(gltf, accessorIndex, primitive, semantic, subMeshData);\r\n  }\r\n  /** @internal */\r\n  private _setBuffer(gltf: GLTFContent, accessorIndex: number, primitive: Primitive, semantic: number, subMeshData: AssetSubMeshData) {\r\n    const accessor = gltf._accessors[accessorIndex];\r\n    const normalized = !!accessor.normalized;\r\n    const hash = `${accessorIndex}:${semantic >= 0}:${Number(normalized)}`;\r\n    let buffer = gltf._bufferCache[hash];\r\n    if (!buffer) {\r\n      let data = accessor.getTypedView(gltf);\r\n      let ctype: number;\r\n      let typeMask: number;\r\n      if (data instanceof Int8Array) {\r\n        ctype = ComponentType.BYTE;\r\n        typeMask = I8_BITMASK;\r\n      } else if (data instanceof Uint8Array) {\r\n        ctype = ComponentType.UBYTE;\r\n        typeMask = U8_BITMASK;\r\n      } else if (data instanceof Int16Array) {\r\n        ctype = ComponentType.SHORT;\r\n        typeMask = I16_BITMASK;\r\n      } else if (data instanceof Uint16Array) {\r\n        ctype = ComponentType.USHORT;\r\n        typeMask = U16_BITMASK;\r\n      } else if (data instanceof Int32Array) {\r\n        ctype = ComponentType.INT;\r\n        typeMask = I32_BITMASK;\r\n      } else if (data instanceof Uint32Array) {\r\n        ctype = ComponentType.UINT;\r\n        typeMask = U32_BITMASK;\r\n      } else if (data instanceof Float32Array) {\r\n        ctype = ComponentType.FLOAT;\r\n        typeMask = F32_BITMASK;\r\n      } else {\r\n        throw new Error('invalid buffer data type');\r\n      }\r\n      const componentCount = accessor.getComponentCount(accessor.type);\r\n      if (semantic >= 0 && ctype !== ComponentType.FLOAT) {\r\n        const floatData = new Float32Array(data.length);\r\n        floatData.set(data);\r\n        ctype = ComponentType.FLOAT;\r\n        typeMask = F32_BITMASK;\r\n        data = floatData;\r\n      }\r\n      if (semantic < 0) {\r\n        if (ctype !== ComponentType.UBYTE && ctype !== ComponentType.USHORT && ctype !== ComponentType.UINT) {\r\n          throw new Error(`Invalid index buffer component type: ${ctype}`);\r\n        }\r\n        if (ctype === ComponentType.UINT && !gltf._manager.device.getMiscCaps().support32BitIndex) {\r\n          throw new Error('Device does not support 32bit vertex index');\r\n        }\r\n        if (ctype === ComponentType.UBYTE) {\r\n          const uint16Data = new Uint16Array(data.length);\r\n          uint16Data.set(data);\r\n          ctype = ComponentType.USHORT;\r\n          typeMask = U16_BITMASK;\r\n          data = uint16Data;\r\n        }\r\n      }\r\n      if (semantic < 0) {\r\n        buffer = gltf._manager.device.createIndexBuffer(data as Uint16Array | Uint32Array, { managed: true });\r\n      } else {\r\n        const name = getVertexAttribName(semantic);\r\n        const bufferType = new PBStructTypeInfo(null, 'packed', [{\r\n          name: name,\r\n          type: new PBArrayTypeInfo(PBPrimitiveTypeInfo.getCachedTypeInfo(makePrimitiveType(typeMask, 1, componentCount, 0)), data.length / componentCount),\r\n        }]);\r\n        buffer = gltf._manager.device.createStructuredBuffer(bufferType, { usage: 'vertex', managed: true }, data);\r\n      }\r\n      gltf._bufferCache[hash] = buffer;\r\n    }\r\n    if (buffer) {\r\n      if (semantic < 0) {\r\n        primitive.setIndexBuffer(buffer as IndexBuffer);\r\n        primitive.indexCount = (buffer as IndexBuffer).length;\r\n      } else {\r\n        primitive.setVertexBuffer(buffer as StructuredBuffer);\r\n        if (semantic === VERTEX_ATTRIB_POSITION) {\r\n          if (!primitive.getIndexBuffer()) {\r\n            primitive.indexCount = Math.floor(buffer.byteLength / 12);\r\n          }\r\n          const data = accessor.getNormalizedDeinterlacedView(gltf);\r\n          subMeshData.rawPositions = data as Float32Array;\r\n          const min = accessor.min;\r\n          const max = accessor.max;\r\n          if (min && max) {\r\n            primitive.setBoundingVolume(new BoundingBox(new Vector3(min), new Vector3(max)));\r\n          } else {\r\n            const numComponents = getVertexBufferAttribType((buffer as StructuredBuffer).structure, semantic).cols;\r\n            const bbox = new BoundingBox();\r\n            bbox.beginExtend();\r\n            for (let i = 0; i < data.length; i++) {\r\n              const v = new Vector3(\r\n                data[i * numComponents],\r\n                data[i * numComponents + 1],\r\n                data[i * numComponents + 2],\r\n              );\r\n              bbox.extend(v);\r\n            }\r\n            if (bbox.isValid()) {\r\n              primitive.setBoundingVolume(bbox);\r\n            }\r\n          }\r\n        } else if (semantic === VERTEX_ATTRIB_BLEND_INDICES) {\r\n          subMeshData.rawBlendIndices = accessor.getNormalizedDeinterlacedView(gltf);\r\n        } else if (semantic === VERTEX_ATTRIB_BLEND_WEIGHT) {\r\n          subMeshData.rawJointWeights = accessor.getNormalizedDeinterlacedView(gltf);\r\n        }\r\n      }\r\n    }\r\n    return buffer;\r\n  }\r\n  /** @internal */\r\n  private isGLB(data: ArrayBuffer): boolean {\r\n    if (data.byteLength > 12) {\r\n      const p = new Uint32Array(data, 0, 3);\r\n      if (p[0] === 0x46546C67 && p[1] === 2 && p[2] === data.byteLength) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  /** @internal */\r\n  private getGLBChunkInfo(data: ArrayBuffer, offset: number): { start: number, length: number, type: number } {\r\n    const header = new Uint32Array(data, offset, 2);\r\n    const start = offset + 8;\r\n    const length = header[0];\r\n    const type = header[1];\r\n    return { start, length, type };\r\n  }\r\n  /** @internal */\r\n  private getGLBChunkInfos(data: ArrayBuffer): { start: number, length: number, type: number }[] {\r\n    const infos: { start: number, length: number, type: number }[] = [];\r\n    let offset = 12;\r\n    while (offset < data.byteLength) {\r\n      const info = this.getGLBChunkInfo(data, offset);\r\n      infos.push(info);\r\n      offset += info.length + 8;\r\n    }\r\n    return infos;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}