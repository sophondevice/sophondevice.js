{"version":3,"file":"bounding_volume.js","sources":["../../../../libs/device/src/scene/bounding_volume.ts"],"sourcesContent":["import { Vector3, Matrix4x4, Frustum, AABB, Plane, ClipState } from '@sophon/base';\r\nimport { AABBTree } from './aabbtree';\r\n\r\nexport interface BoundingVolume {\r\n  clone(): BoundingVolume;\r\n  transform(matrix: Matrix4x4): BoundingVolume;\r\n  behindPlane(plane: Plane): boolean;\r\n  outsideFrustum(frustum: Frustum | Matrix4x4): boolean;\r\n  toAABB(): AABB;\r\n}\r\n\r\nexport interface BoundingBox extends BoundingVolume {}\r\n\r\nexport class BoundingBox extends AABB {\r\n  constructor();\r\n  constructor(box: AABB);\r\n  constructor(minPoint: Vector3, maxPoint: Vector3);\r\n  constructor(arg0?: Vector3 | AABB, arg1?: Vector3) {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    super(arg0 as any, arg1);\r\n  }\r\n  clone(): BoundingVolume {\r\n    return new BoundingBox(this);\r\n  }\r\n  transform(matrix: Matrix4x4): BoundingVolume {\r\n    return new BoundingBox(AABB.transform(this, matrix));\r\n  }\r\n  outsideFrustum(frustum: Frustum | Matrix4x4): boolean {\r\n    return (\r\n      (frustum instanceof Frustum\r\n        ? this.getClipStateWithFrustum(frustum)\r\n        : this.getClipState(frustum)) === ClipState.NOT_CLIPPED\r\n    );\r\n  }\r\n  toAABB(): AABB {\r\n    return this;\r\n  }\r\n}\r\n\r\nexport interface BoundingBoxTree extends BoundingVolume {}\r\n\r\nexport class BoundingBoxTree extends AABBTree {\r\n  constructor();\r\n  constructor(aabbtree: AABBTree);\r\n  constructor(arg?: AABBTree) {\r\n    super(arg);\r\n  }\r\n  clone(): BoundingVolume {\r\n    return new BoundingBoxTree(this);\r\n  }\r\n  transform(matrix: Matrix4x4): BoundingVolume {\r\n    const newBV = new BoundingBoxTree(this);\r\n    newBV.transform(matrix);\r\n    return newBV;\r\n  }\r\n  outsideFrustum(frustum: Frustum | Matrix4x4): boolean {\r\n    const aabb = this.getTopLevelAABB();\r\n    if (aabb) {\r\n      return (\r\n        (frustum instanceof Frustum\r\n          ? aabb.getClipStateWithFrustum(frustum)\r\n          : aabb.getClipState(frustum)) === ClipState.NOT_CLIPPED\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n  toAABB(): AABB {\r\n    return this.getTopLevelAABB();\r\n  }\r\n}\r\n/*\r\nexport class BoundingFrustum implements BoundingVolume {\r\n    protected _frustum: Frustum;\r\n    constructor ();\r\n    constructor (other: BoundingFrustum|Frustum|Matrix4x4);\r\n    constructor (arg0?: BoundingFrustum|Frustum|Matrix4x4) {\r\n        if (arg0 instanceof BoundingFrustum) {\r\n            this._frustum = arg0._frustum ? new Frustum (arg0._frustum) : null;\r\n        } else if (arg0 instanceof Frustum) {\r\n            this._frustum = new Frustum (arg0);\r\n        } else if (arg0 instanceof Matrix4x4) {\r\n            this._frustum = new Frustum (arg0);\r\n        } else {\r\n            this._frustum = null;\r\n        }\r\n    }\r\n    clone (): BoundingVolume {\r\n        return new BoundingFrustum (this);\r\n    }\r\n    transform (matrix: Matrix4x4)\r\n}\r\n*/\r\n"],"names":[],"mappings":";;;;AAaM,MAAO,WAAY,SAAQ,IAAI,CAAA;IAInC,WAAY,CAAA,IAAqB,EAAE,IAAc,EAAA;AAE/C,QAAA,KAAK,CAAC,IAAW,EAAE,IAAI,CAAC,CAAC;KAC1B;IACD,KAAK,GAAA;AACH,QAAA,OAAO,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC;KAC9B;AACD,IAAA,SAAS,CAAC,MAAiB,EAAA;AACzB,QAAA,OAAO,IAAI,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC;KACtD;AACD,IAAA,cAAc,CAAC,OAA4B,EAAA;AACzC,QAAA,QACE,CAAC,OAAO,YAAY,OAAO;AACzB,cAAE,IAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC;AACvC,cAAE,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,SAAS,CAAC,WAAW,EACzD;KACH;IACD,MAAM,GAAA;AACJ,QAAA,OAAO,IAAI,CAAC;KACb;AACF,CAAA;AAIK,MAAO,eAAgB,SAAQ,QAAQ,CAAA;AAG3C,IAAA,WAAA,CAAY,GAAc,EAAA;QACxB,KAAK,CAAC,GAAG,CAAC,CAAC;KACZ;IACD,KAAK,GAAA;AACH,QAAA,OAAO,IAAI,eAAe,CAAC,IAAI,CAAC,CAAC;KAClC;AACD,IAAA,SAAS,CAAC,MAAiB,EAAA;AACzB,QAAA,MAAM,KAAK,GAAG,IAAI,eAAe,CAAC,IAAI,CAAC,CAAC;AACxC,QAAA,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AACxB,QAAA,OAAO,KAAK,CAAC;KACd;AACD,IAAA,cAAc,CAAC,OAA4B,EAAA;AACzC,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;AACpC,QAAA,IAAI,IAAI,EAAE;AACR,YAAA,QACE,CAAC,OAAO,YAAY,OAAO;AACzB,kBAAE,IAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC;AACvC,kBAAE,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,SAAS,CAAC,WAAW,EACzD;AACH,SAAA;AAAM,aAAA;AACL,YAAA,OAAO,KAAK,CAAC;AACd,SAAA;KACF;IACD,MAAM,GAAA;AACJ,QAAA,OAAO,IAAI,CAAC,eAAe,EAAE,CAAC;KAC/B;AACF;;;;"}