{"version":3,"file":"terrain.js","sources":["../../../../../libs/device/src/scene/terrain/terrain.ts"],"sourcesContent":["import { REvent, Vector3 } from \"@sophon/base\";\nimport { Quadtree } from \"./quadtree\";\nimport { FaceMode, GPUObject, PBStructTypeInfo, RenderStateSet, StructuredBuffer, Texture2D, TextureFormat } from \"../../device\";\nimport { MAX_DETAIL_TEXTURE_LEVELS, TerrainMaterial } from \"./terrainmaterial\";\nimport { Drawable, DrawContext } from \"../drawable\";\nimport { GraphNode } from \"../graph_node\";\nimport { MATERIAL_FUNC_DEPTH_SHADOW } from \"../values\";\nimport type { Camera } from \"../camera\";\nimport type { TerrainPatch } from \"./patch\";\nimport type { BoundingVolume } from \"../bounding_volume\";\nimport type { Scene } from \"../scene\";\nimport type { SceneNode } from \"../scene_node\";\nimport type { CullVisitor } from \"../visitors\";\n\nexport class Terrain extends GraphNode implements Drawable {\n  private _quadtree: Quadtree;\n  private _maxPixelError: number;\n  private _maxPixelErrorDirty: boolean;\n  private _detailPatches: TerrainPatch[];\n  private _nondetailPatches: TerrainPatch[];\n  private _lodCamera: Camera;\n  private _scale: Vector3;\n  private _patchSize: number;\n  private _detailLodLevel: number;\n  private _lastViewportH: number;\n  private _lastTanHalfFOVY: number;\n  private _width: number;\n  private _height: number;\n  private _material: TerrainMaterial;\n  private _terrainInfoBuffer: StructuredBuffer;\n  private _maxDetailTextureLevels: number;\n  private _overridenStateSet: RenderStateSet;\n  private _wireframe: boolean;\n  private _viewPoint: Vector3;\n  private _castShadow: boolean;\n  private _updateFunc: (evt: REvent) => void;\n  constructor(scene: Scene, parent?: SceneNode) {\n    super(scene, null);\n    this._quadtree = null;\n    this._maxPixelError = 10;\n    this._maxPixelErrorDirty = true;\n    this._lodCamera = null;\n    this._detailPatches = [];\n    this._nondetailPatches = [];\n    this._scale = Vector3.one();\n    this._patchSize = 33;\n    this._detailLodLevel = 0;\n    this._lastViewportH = 0;\n    this._lastTanHalfFOVY = 0;\n    this._width = 0;\n    this._height = 0;\n    this._material = null;\n    this._maxDetailTextureLevels = MAX_DETAIL_TEXTURE_LEVELS;\n    this._wireframe = false;\n    this._viewPoint = null;\n    this._castShadow = false;\n    this._overridenStateSet = scene.device.createRenderStateSet();\n    this._overridenStateSet.useRasterizerState().setCullMode(FaceMode.NONE);\n    this._updateFunc = (evt: REvent) => this.frameUpdate((evt as Scene.TickEvent).camera);\n    this.addEventListener('attached', () => {\n      scene.addEventListener('tick', this._updateFunc);\n    });\n    this.addEventListener('detached', () => {\n      scene.removeEventListener('tick', this._updateFunc);\n    });\n    this.parent = parent || scene.rootNode;\n  }\n  get castShadow(): boolean {\n    return this._castShadow;\n  }\n  set castShadow(val: boolean) {\n    this._castShadow = !!val;\n  }\n  get maxDetailTextureLevels(): number {\n    return this._maxDetailTextureLevels;\n  }\n  get maxPixelError(): number {\n    return this._maxPixelError;\n  }\n  set maxPixelError(val: number) {\n    if (val !== this._maxPixelError) {\n      this._maxPixelError = val;\n      this._maxPixelErrorDirty = true;\n    }\n  }\n  get LODCamera(): Camera {\n    return this._lodCamera;\n  }\n  set LODCamera(camera: Camera) {\n    this._lodCamera = camera;\n  }\n  get scale(): Vector3 {\n    return this._scale;\n  }\n  get patchSize(): number {\n    return this._patchSize;\n  }\n  get width(): number {\n    return this._width;\n  }\n  get height(): number {\n    return this._height;\n  }\n  get detailLODLevel(): number {\n    return this._detailLodLevel;\n  }\n  get material(): TerrainMaterial {\n    return this._material;\n  }\n  get wireframe(): boolean {\n    return this._wireframe;\n  }\n  set wireframe(b: boolean) {\n    this._wireframe = !!b;\n  }\n  get normalMap(): Texture2D {\n    return this._quadtree.normalMap;\n  }\n  create(sizeX: number, sizeZ: number, elevations: Float32Array, scale: Vector3, patchSize: number): boolean {\n    this._quadtree = new Quadtree(this);\n    this._material = new TerrainMaterial(this._scene.device);\n    if (!this._quadtree.build(this._scene, patchSize, sizeX, sizeZ, elevations, scale.x, scale.z, 24)) {\n      this._quadtree = null;\n      return false;\n    }\n    this._patchSize = patchSize;\n    this._width = sizeX;\n    this._height = sizeZ;\n    this._material.normalMap = this._quadtree.normalMap;\n    this._terrainInfoBuffer = null;\n    this.invalidateBoundingVolume();\n    return true;\n  }\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\n    return this._quadtree ? this._quadtree.getHeightField().getBBoxTree().getRootNode().bbox : null;\n  }\n  frameUpdate(camera: Camera) {\n    const viewportH = this.scene.device.getViewport()[3];\n    const tanHalfFovy = camera.getTanHalfFovy();\n    if (viewportH !== this._lastViewportH || tanHalfFovy !== this._lastTanHalfFOVY || this._maxPixelErrorDirty) {\n      this._maxPixelErrorDirty = false;\n      this._lastViewportH = viewportH;\n      this._lastTanHalfFOVY = tanHalfFovy;\n      this._quadtree.setupCamera(viewportH, tanHalfFovy, this._maxPixelError);\n    }\n    const worldEyePos = camera.worldMatrix.getRow(3).xyz();\n    this._viewPoint = this.invWorldMatrix.transformPointAffine(worldEyePos);\n  }\n  cull(cullVisitor: CullVisitor): boolean {\n    this.clearPatches();\n    this._quadtree.cull(cullVisitor.camera, this._viewPoint, this.worldMatrix);\n    return this._detailPatches.length > 0;\n  }\n  // Drawable interfaces\n  isTransparency(): boolean {\n    return false;\n  }\n  isUnlit(): boolean {\n    return !this.material?.supportLighting();\n  }\n  isTerrain(): this is Terrain {\n    return true;\n  }\n  draw(ctx: DrawContext) {\n    if (!this._terrainInfoBuffer) {\n      const program = this._material.getOrCreateProgram(ctx).programs[ctx.materialFunc];\n      this._terrainInfoBuffer = this.scene.device.createStructuredBuffer(program.getBindingInfo('terrainInfo').type as PBStructTypeInfo, { usage: 'uniform' });\n      const bbox = this.getBoundingVolume().toAABB();\n      const terrainSizeX = bbox.extents.x * 2;\n      const terrainSizeZ = bbox.extents.z * 2;\n      this._terrainInfoBuffer.bufferSubData(0, new Int32Array([terrainSizeX, terrainSizeZ, 0, 0]))\n      this._terrainInfoBuffer.restoreHandler = async (obj: GPUObject) => {\n        this._terrainInfoBuffer.bufferSubData(0, new Int32Array([terrainSizeX, terrainSizeZ, 0, 0]))\n      };\n    }\n    if (ctx.materialFunc === MATERIAL_FUNC_DEPTH_SHADOW) {\n      this.scene.device.setRenderStatesOverridden(this._overridenStateSet);\n    }\n    if (this._material.beginDraw(ctx)) {\n      const bindGroup = this._material.getMaterialBindGroup();\n      bindGroup.setBuffer('terrainInfo', this._terrainInfoBuffer);\n      for (const patch of this._detailPatches) {\n        bindGroup.setBuffer('scaleOffset', patch.getOffsetScale(this, ctx));\n        (this._wireframe ? patch.getGeometryWireframe() : patch.getGeometry()).draw();\n      }\n      this._material.endDraw();\n    }\n    if (ctx.materialFunc === MATERIAL_FUNC_DEPTH_SHADOW) {\n      this.scene.device.setRenderStatesOverridden(null);\n    }\n  }\n  getPatches(): TerrainPatch[] {\n    return this._quadtree?.getPatches() || [];\n  }\n  /** @internal */\n  addPatch(patch: TerrainPatch, detail: boolean) {\n    if (detail) {\n      this._detailPatches.push(patch);\n    } else {\n      this._nondetailPatches.push(patch);\n    }\n  }\n  /** @internal */\n  clearPatches() {\n    this._detailPatches.length = 0;\n    this._nondetailPatches.length = 0;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAcM,MAAO,OAAQ,SAAQ,SAAS,CAAA;AAC5B,IAAA,SAAS,CAAW;AACpB,IAAA,cAAc,CAAS;AACvB,IAAA,mBAAmB,CAAU;AAC7B,IAAA,cAAc,CAAiB;AAC/B,IAAA,iBAAiB,CAAiB;AAClC,IAAA,UAAU,CAAS;AACnB,IAAA,MAAM,CAAU;AAChB,IAAA,UAAU,CAAS;AACnB,IAAA,eAAe,CAAS;AACxB,IAAA,cAAc,CAAS;AACvB,IAAA,gBAAgB,CAAS;AACzB,IAAA,MAAM,CAAS;AACf,IAAA,OAAO,CAAS;AAChB,IAAA,SAAS,CAAkB;AAC3B,IAAA,kBAAkB,CAAmB;AACrC,IAAA,uBAAuB,CAAS;AAChC,IAAA,kBAAkB,CAAiB;AACnC,IAAA,UAAU,CAAU;AACpB,IAAA,UAAU,CAAU;AACpB,IAAA,WAAW,CAAU;AACrB,IAAA,WAAW,CAAwB;IAC3C,WAAY,CAAA,KAAY,EAAE,MAAkB,EAAA;AAC1C,QAAA,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;AACnB,QAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,QAAA,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;AACzB,QAAA,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;AAChC,QAAA,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AACvB,QAAA,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;AACzB,QAAA,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;AAC5B,QAAA,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;AAC5B,QAAA,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;AACrB,QAAA,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;AACzB,QAAA,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC;AACxB,QAAA,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC;AAC1B,QAAA,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;AAChB,QAAA,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;AACjB,QAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,QAAA,IAAI,CAAC,uBAAuB,GAAG,yBAAyB,CAAC;AACzD,QAAA,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;AACxB,QAAA,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AACvB,QAAA,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QACzB,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC;AAC9D,QAAA,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,EAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACxE,QAAA,IAAI,CAAC,WAAW,GAAG,CAAC,GAAW,KAAK,IAAI,CAAC,WAAW,CAAE,GAAuB,CAAC,MAAM,CAAC,CAAC;AACtF,QAAA,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,MAAK;YACrC,KAAK,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;AACnD,SAAC,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,MAAK;YACrC,KAAK,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;AACtD,SAAC,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,GAAG,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC;KACxC;AACD,IAAA,IAAI,UAAU,GAAA;QACZ,OAAO,IAAI,CAAC,WAAW,CAAC;KACzB;IACD,IAAI,UAAU,CAAC,GAAY,EAAA;AACzB,QAAA,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,GAAG,CAAC;KAC1B;AACD,IAAA,IAAI,sBAAsB,GAAA;QACxB,OAAO,IAAI,CAAC,uBAAuB,CAAC;KACrC;AACD,IAAA,IAAI,aAAa,GAAA;QACf,OAAO,IAAI,CAAC,cAAc,CAAC;KAC5B;IACD,IAAI,aAAa,CAAC,GAAW,EAAA;AAC3B,QAAA,IAAI,GAAG,KAAK,IAAI,CAAC,cAAc,EAAE;AAC/B,YAAA,IAAI,CAAC,cAAc,GAAG,GAAG,CAAC;AAC1B,YAAA,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;AACjC,SAAA;KACF;AACD,IAAA,IAAI,SAAS,GAAA;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;KACxB;IACD,IAAI,SAAS,CAAC,MAAc,EAAA;AAC1B,QAAA,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;KAC1B;AACD,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM,CAAC;KACpB;AACD,IAAA,IAAI,SAAS,GAAA;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;KACxB;AACD,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM,CAAC;KACpB;AACD,IAAA,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,OAAO,CAAC;KACrB;AACD,IAAA,IAAI,cAAc,GAAA;QAChB,OAAO,IAAI,CAAC,eAAe,CAAC;KAC7B;AACD,IAAA,IAAI,QAAQ,GAAA;QACV,OAAO,IAAI,CAAC,SAAS,CAAC;KACvB;AACD,IAAA,IAAI,SAAS,GAAA;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;KACxB;IACD,IAAI,SAAS,CAAC,CAAU,EAAA;AACtB,QAAA,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC;KACvB;AACD,IAAA,IAAI,SAAS,GAAA;AACX,QAAA,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;KACjC;IACD,MAAM,CAAC,KAAa,EAAE,KAAa,EAAE,UAAwB,EAAE,KAAc,EAAE,SAAiB,EAAA;QAC9F,IAAI,CAAC,SAAS,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC;AACpC,QAAA,IAAI,CAAC,SAAS,GAAG,IAAI,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AACzD,QAAA,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE;AACjG,YAAA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,YAAA,OAAO,KAAK,CAAC;AACd,SAAA;AACD,QAAA,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;AAC5B,QAAA,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;AACpB,QAAA,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,SAAS,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;AACpD,QAAA,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;QAC/B,IAAI,CAAC,wBAAwB,EAAE,CAAC;AAChC,QAAA,OAAO,IAAI,CAAC;KACb;AACD,IAAA,qBAAqB,CAAC,EAAkB,EAAA;QACtC,OAAO,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC;KACjG;AACD,IAAA,WAAW,CAAC,MAAc,EAAA;AACxB,QAAA,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;AACrD,QAAA,MAAM,WAAW,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;AAC5C,QAAA,IAAI,SAAS,KAAK,IAAI,CAAC,cAAc,IAAI,WAAW,KAAK,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,mBAAmB,EAAE;AAC1G,YAAA,IAAI,CAAC,mBAAmB,GAAG,KAAK,CAAC;AACjC,YAAA,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;AAChC,YAAA,IAAI,CAAC,gBAAgB,GAAG,WAAW,CAAC;AACpC,YAAA,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;AACzE,SAAA;AACD,QAAA,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;QACvD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,oBAAoB,CAAC,WAAW,CAAC,CAAC;KACzE;AACD,IAAA,IAAI,CAAC,WAAwB,EAAA;QAC3B,IAAI,CAAC,YAAY,EAAE,CAAC;AACpB,QAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;AAC3E,QAAA,OAAO,IAAI,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC;KACvC;IAED,cAAc,GAAA;AACZ,QAAA,OAAO,KAAK,CAAC;KACd;IACD,OAAO,GAAA;AACL,QAAA,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,eAAe,EAAE,CAAC;KAC1C;IACD,SAAS,GAAA;AACP,QAAA,OAAO,IAAI,CAAC;KACb;AACD,IAAA,IAAI,CAAC,GAAgB,EAAA;AACnB,QAAA,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE;AAC5B,YAAA,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClF,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,sBAAsB,CAAC,OAAO,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,IAAwB,EAAE,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;YACzJ,MAAM,IAAI,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC,MAAM,EAAE,CAAC;YAC/C,MAAM,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;YACxC,MAAM,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;YACxC,IAAI,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC,EAAE,IAAI,UAAU,CAAC,CAAC,YAAY,EAAE,YAAY,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;YAC5F,IAAI,CAAC,kBAAkB,CAAC,cAAc,GAAG,OAAO,GAAc,KAAI;gBAChE,IAAI,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC,EAAE,IAAI,UAAU,CAAC,CAAC,YAAY,EAAE,YAAY,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;AAC9F,aAAC,CAAC;AACH,SAAA;AACD,QAAA,IAAI,GAAG,CAAC,YAAY,KAAK,0BAA0B,EAAE;YACnD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,yBAAyB,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AACtE,SAAA;QACD,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE;YACjC,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,oBAAoB,EAAE,CAAC;YACxD,SAAS,CAAC,SAAS,CAAC,aAAa,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;AAC5D,YAAA,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,cAAc,EAAE;AACvC,gBAAA,SAAS,CAAC,SAAS,CAAC,aAAa,EAAE,KAAK,CAAC,cAAc,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;gBACpE,CAAC,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC,oBAAoB,EAAE,GAAG,KAAK,CAAC,WAAW,EAAE,EAAE,IAAI,EAAE,CAAC;AAC/E,aAAA;AACD,YAAA,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;AAC1B,SAAA;AACD,QAAA,IAAI,GAAG,CAAC,YAAY,KAAK,0BAA0B,EAAE;YACnD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC;AACnD,SAAA;KACF;IACD,UAAU,GAAA;QACR,OAAO,IAAI,CAAC,SAAS,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC;KAC3C;IAED,QAAQ,CAAC,KAAmB,EAAE,MAAe,EAAA;AAC3C,QAAA,IAAI,MAAM,EAAE;AACV,YAAA,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACjC,SAAA;AAAM,aAAA;AACL,YAAA,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACpC,SAAA;KACF;IAED,YAAY,GAAA;AACV,QAAA,IAAI,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC;AAC/B,QAAA,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC;KACnC;AACF;;;;"}