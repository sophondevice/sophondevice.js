{"version":3,"file":"shadow_impl.js","sources":["../../../../../libs/device/src/scene/shadow/shadow_impl.ts"],"sourcesContent":["import { PBInsideFunctionScope, PBShaderExp, TextureFormat, TextureSampler } from \"../../device\";\r\nimport type { ShadowMapper, ShadowMapType, ShadowMode } from \"./shadowmapper\";\r\n\r\nexport abstract class ShadowImpl {\r\n  protected _resourceDirty: boolean;\r\n  constructor() {\r\n    this._resourceDirty = true;\r\n  }\r\n  invalidateResource() {\r\n    this._resourceDirty = true;\r\n  }\r\n  updateResources(shadowMapper: ShadowMapper) {\r\n    if (this._resourceDirty) {\r\n      this.doUpdateResources(shadowMapper);\r\n      this._resourceDirty = false;\r\n    }\r\n  }\r\n  abstract dispose(): void;\r\n  abstract getType(): ShadowMode;\r\n  abstract getShadowMap(shadowMapper: ShadowMapper): ShadowMapType;\r\n  abstract getShadowMapSampler(shadowMapper: ShadowMapper): TextureSampler;\r\n  abstract postRenderShadowMap(shadowMapper: ShadowMapper);\r\n  abstract getDepthScale(): number;\r\n  abstract setDepthScale(val: number);\r\n  abstract resourceDirty(): boolean;\r\n  abstract isSupported(shadowMapper: ShadowMapper): boolean;\r\n  abstract doUpdateResources(shadowMapper: ShadowMapper);\r\n  abstract getShaderHash(): string;\r\n  abstract computeShadowMapDepth(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope): PBShaderExp;\r\n  abstract computeShadow(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope, shadowVertex: PBShaderExp, NdotL: PBShaderExp): PBShaderExp;\r\n  abstract computeShadowCSM(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope, shadowVertex: PBShaderExp, NdotL: PBShaderExp, split: PBShaderExp): PBShaderExp;\r\n  abstract getShadowMapColorFormat(shadowMapper: ShadowMapper): TextureFormat;\r\n  abstract getShadowMapDepthFormat(shadowMapper: ShadowMapper): TextureFormat;\r\n  abstract useNativeShadowMap(shadowMapper: ShadowMapper): boolean;\r\n}\r\n\r\n"],"names":[],"mappings":";MAGsB,UAAU,CAAA;AACpB,IAAA,cAAc,CAAU;AAClC,IAAA,WAAA,GAAA;AACE,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;KAC5B;IACD,kBAAkB,GAAA;AAChB,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;KAC5B;AACD,IAAA,eAAe,CAAC,YAA0B,EAAA;QACxC,IAAI,IAAI,CAAC,cAAc,EAAE;AACvB,YAAA,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;AACrC,YAAA,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;AAC7B,SAAA;KACF;AAkBF;;;;"}