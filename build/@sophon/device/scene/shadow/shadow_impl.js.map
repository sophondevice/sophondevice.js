{"version":3,"file":"shadow_impl.js","sources":["../../../../../libs/device/src/scene/shadow/shadow_impl.ts"],"sourcesContent":["import { PBInsideFunctionScope, PBShaderExp, TextureFormat, TextureSampler } from \"../../device\";\nimport type { ShadowMapper, ShadowMapType, ShadowMode } from \"./shadowmapper\";\n\nexport abstract class ShadowImpl {\n  protected _resourceDirty: boolean;\n  constructor() {\n    this._resourceDirty = true;\n  }\n  invalidateResource() {\n    this._resourceDirty = true;\n  }\n  updateResources(shadowMapper: ShadowMapper) {\n    if (this._resourceDirty) {\n      this.doUpdateResources(shadowMapper);\n      this._resourceDirty = false;\n    }\n  }\n  abstract dispose(): void;\n  abstract getType(): ShadowMode;\n  abstract getShadowMap(shadowMapper: ShadowMapper): ShadowMapType;\n  abstract getShadowMapSampler(shadowMapper: ShadowMapper): TextureSampler;\n  abstract postRenderShadowMap(shadowMapper: ShadowMapper);\n  abstract getDepthScale(): number;\n  abstract setDepthScale(val: number);\n  abstract resourceDirty(): boolean;\n  abstract isSupported(shadowMapper: ShadowMapper): boolean;\n  abstract doUpdateResources(shadowMapper: ShadowMapper);\n  abstract getShaderHash(): string;\n  abstract computeShadowMapDepth(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope): PBShaderExp;\n  abstract computeShadow(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope, shadowVertex: PBShaderExp, NdotL: PBShaderExp): PBShaderExp;\n  abstract computeShadowCSM(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope, shadowVertex: PBShaderExp, NdotL: PBShaderExp, split: PBShaderExp): PBShaderExp;\n  abstract getShadowMapColorFormat(shadowMapper: ShadowMapper): TextureFormat;\n  abstract getShadowMapDepthFormat(shadowMapper: ShadowMapper): TextureFormat;\n  abstract useNativeShadowMap(shadowMapper: ShadowMapper): boolean;\n}\n\n"],"names":[],"mappings":";MAGsB,UAAU,CAAA;AACpB,IAAA,cAAc,CAAU;AAClC,IAAA,WAAA,GAAA;AACE,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;KAC5B;IACD,kBAAkB,GAAA;AAChB,QAAA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;KAC5B;AACD,IAAA,eAAe,CAAC,YAA0B,EAAA;QACxC,IAAI,IAAI,CAAC,cAAc,EAAE;AACvB,YAAA,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;AACrC,YAAA,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;AAC7B,SAAA;KACF;AAkBF;;;;"}