{"version":3,"file":"vsm.js","sources":["../../../../../libs/device/src/scene/shadow/vsm.ts"],"sourcesContent":["import { ShadowImpl } from \"./shadow_impl\";\r\nimport { Blitter, BlitType } from \"../blitter\";\r\nimport { ShaderLib } from \"../materiallib\";\r\nimport { Device, BindGroup, ShaderType, FrameBuffer, TextureTarget, TextureFormat, GPUResourceUsageFlags, ProgramBuilder, PBShaderExp, TextureFilter, PBInsideFunctionScope, TextureSampler, PBGlobalScope, TextureCreationOptions } from \"../../device\";\r\nimport { computeShadowMapDepth, filterShadowVSM } from \"../renderers/shadowmap.shaderlib\";\r\nimport type { ShadowMapper, ShadowMapType, ShadowMode } from \"./shadowmapper\";\r\n\r\nexport class VSMBlitter extends Blitter {\r\n  protected _phase: 'horizonal' | 'vertical';\r\n  protected _packFloat: boolean;\r\n  protected _blurSize: number;\r\n  protected _kernelSize: number;\r\n  constructor(phase: 'horizonal' | 'vertical', kernelSize: number, blurSize: number, packFloat: boolean) {\r\n    super();\r\n    this._phase = phase;\r\n    this._blurSize = blurSize;\r\n    this._kernelSize = kernelSize;\r\n    this._packFloat = packFloat;\r\n  }\r\n  get blurSize(): number {\r\n    return this._blurSize;\r\n  }\r\n  set blurSize(val: number) {\r\n    this._blurSize = val;\r\n  }\r\n  get kernelSize(): number {\r\n    return this._kernelSize;\r\n  }\r\n  set kernelSize(val: number) {\r\n    if (val !== this._kernelSize) {\r\n      this._kernelSize = val;\r\n      this.invalidateHash();\r\n    }\r\n  }\r\n  get packFloat(): boolean {\r\n    return this._packFloat;\r\n  }\r\n  set packFloat(b: boolean) {\r\n    if (this._packFloat !== !!b) {\r\n      this._packFloat = !!b;\r\n      this.invalidateHash();\r\n    }\r\n  }\r\n  setup(scope: PBGlobalScope, type: BlitType) {\r\n    const pb = scope.$builder;\r\n    if (pb.shaderType === ShaderType.Fragment) {\r\n      scope.blurSize = pb.float().uniform(0);\r\n      scope.blurMultiplyVec = type === 'cube'\r\n        ? this._phase === 'horizonal' ? pb.vec3(1, 0, 0) : pb.vec3(0, 1, 0)\r\n        : this._phase === 'horizonal' ? pb.vec2(1, 0) : pb.vec2(0, 1);\r\n      scope.numBlurPixelsPerSide = pb.float((this._kernelSize + 1) / 2);\r\n      scope.weight = pb.float(1 / (this._kernelSize * this._kernelSize));\r\n    }\r\n  }\r\n  setUniforms(bindGroup: BindGroup) {\r\n    bindGroup.setValue('blurSize', this._blurSize);\r\n  }\r\n  readTexel(scope: PBInsideFunctionScope, type: BlitType, srcTex: PBShaderExp, srcUV: PBShaderExp, srcLayer: PBShaderExp): PBShaderExp {\r\n    const pb = scope.$builder;\r\n    const texel = super.readTexel(scope, type, srcTex, srcUV, srcLayer);\r\n    if (this._packFloat) {\r\n      const lib = new ShaderLib(pb);\r\n      if (this._phase === 'horizonal') {\r\n        return pb.vec4(lib.decodeNormalizedFloatFromRGBA(texel));\r\n      } else {\r\n        return pb.vec4(lib.decode2HalfFromRGBA(texel), 0, 0);\r\n      }\r\n    } else {\r\n      return texel;\r\n    }\r\n  }\r\n  writeTexel(scope: PBInsideFunctionScope, type: BlitType, srcUV: PBShaderExp, texel: PBShaderExp): PBShaderExp {\r\n    const pb = scope.$builder;\r\n    const outTexel = super.writeTexel(scope, type, srcUV, texel);\r\n    if (this._packFloat) {\r\n      const lib = new ShaderLib(pb);\r\n      return lib.encode2HalfToRGBA(outTexel.x, outTexel.y);\r\n    } else {\r\n      return outTexel;\r\n    }\r\n  }\r\n  filter(scope: PBInsideFunctionScope, type: BlitType, srcTex: PBShaderExp, srcUV: PBShaderExp, srcLayer: PBShaderExp): PBShaderExp {\r\n    const that = this;\r\n    const pb = scope.$builder;\r\n    scope.d0 = that.readTexel(scope, type, srcTex, srcUV, srcLayer);\r\n    scope.mean = pb.float(0);\r\n    scope.squaredMean = pb.float(0);\r\n    scope.$for(pb.float('i'), 1, scope.numBlurPixelsPerSide, function () {\r\n      this.d1 = that.readTexel(this, type, srcTex, pb.sub(srcUV, pb.mul(this.blurMultiplyVec, this.blurSize, this.i)), srcLayer);\r\n      this.d2 = that.readTexel(this, type, srcTex, pb.add(srcUV, pb.mul(this.blurMultiplyVec, this.blurSize, this.i)), srcLayer);\r\n      this.mean = pb.add(this.mean, this.d1.x);\r\n      this.mean = pb.add(this.mean, this.d2.x);\r\n      if (that._phase === 'horizonal') {\r\n        this.squaredMean = pb.add(this.squaredMean, pb.mul(this.d1.x, this.d1.x));\r\n        this.squaredMean = pb.add(this.squaredMean, pb.mul(this.d2.x, this.d2.x));\r\n      } else {\r\n        this.squaredMean = pb.add(this.squaredMean, pb.dot(this.d1.xy, this.d1.xy));\r\n        this.squaredMean = pb.add(this.squaredMean, pb.dot(this.d2.xy, this.d2.xy));\r\n      }\r\n    });\r\n    scope.mean = pb.div(scope.mean, that._kernelSize);\r\n    scope.squaredMean = pb.div(scope.squaredMean, that._kernelSize);\r\n    scope.stdDev = pb.sqrt(pb.max(0, pb.sub(scope.squaredMean, pb.mul(scope.mean, scope.mean))));\r\n    return pb.vec4(scope.mean, scope.stdDev, 0, 1);\r\n  }\r\n  protected calcHash(): string {\r\n    return `${this._phase}-${this._kernelSize}-${Number(this._packFloat)}`;\r\n  }\r\n}\r\n\r\nexport class VSM extends ShadowImpl {\r\n  /** @internal */\r\n  protected _blur: boolean;\r\n  /** @internal */\r\n  protected _kernelSize: number;\r\n  /** @internal */\r\n  protected _blurSize: number;\r\n  /** @internal */\r\n  protected _blurMap: ShadowMapType;\r\n  /** @internal */\r\n  protected _blurFramebuffer: FrameBuffer;\r\n  /** @internal */\r\n  protected _blurMap2: ShadowMapType;\r\n  /** @internal */\r\n  protected _blurFramebuffer2: FrameBuffer;\r\n  /** @internal */\r\n  protected _blitterH: VSMBlitter;\r\n  /** @internal */\r\n  protected _blitterV: VSMBlitter;\r\n  /** @internal */\r\n  protected _mipmap: boolean;\r\n  /** @internal */\r\n  protected _darkness: number;\r\n  /** @internal */\r\n  protected _shadowSampler: TextureSampler;\r\n  constructor(kernelSize?: number, blurSize?: number, darkness?: number) {\r\n    super();\r\n    this._blur = true;\r\n    this._kernelSize = kernelSize ?? 5;\r\n    this._blurSize = blurSize ?? 1;\r\n    this._darkness = darkness ?? 0;\r\n    this._mipmap = true;\r\n    this._shadowSampler = null;\r\n    this._blitterH = new VSMBlitter('horizonal', this._kernelSize, 1 / 1024, false);\r\n    this._blitterV = new VSMBlitter('vertical', this._kernelSize, 1 / 1024, false);\r\n  }\r\n  resourceDirty(): boolean {\r\n    return this._resourceDirty;\r\n  }\r\n  get blur(): boolean {\r\n    return this._blur;\r\n  }\r\n  set blur(val: boolean) {\r\n    if (this._blur !== !!val) {\r\n      this._blur = !!val;\r\n      this._resourceDirty = true;\r\n    }\r\n  }\r\n  get mipmap(): boolean {\r\n    return this._mipmap;\r\n  }\r\n  set mipmap(b: boolean) {\r\n    if (this._mipmap !== !!b) {\r\n      this._mipmap = !!b;\r\n      if (this._blur) {\r\n        this._resourceDirty = true;\r\n      }\r\n    }\r\n  }\r\n  get kernelSize(): number {\r\n    return this._kernelSize;\r\n  }\r\n  set kernelSize(val: number) {\r\n    this._kernelSize = val;\r\n  }\r\n  get blurSize(): number {\r\n    return this._blurSize;\r\n  }\r\n  set blurSize(val: number) {\r\n    this._blurSize = val;\r\n  }\r\n  getDepthScale(): number {\r\n    return this._darkness;\r\n  }\r\n  setDepthScale(val: number) {\r\n    this._darkness = val;\r\n  }\r\n  getType(): ShadowMode {\r\n    return 'vsm';\r\n  }\r\n  dispose(): void {\r\n    this._blurFramebuffer?.dispose();\r\n    this._blurFramebuffer = null;\r\n    this._blurFramebuffer2?.dispose();\r\n    this._blurFramebuffer2 = null;\r\n    this._blurMap?.dispose();\r\n    this._blurMap = null;\r\n    this._blurMap2?.dispose();\r\n    this._blurMap2 = null;\r\n    this._shadowSampler = null;\r\n  }\r\n  getShadowMap(shadowMapper: ShadowMapper): ShadowMapType {\r\n    return this._blur ? this._blurMap2 : shadowMapper.getColorAttachment();\r\n  }\r\n  getShadowMapSampler(shadowMapper: ShadowMapper): TextureSampler {\r\n    if (!this._shadowSampler) {\r\n      this._shadowSampler = this.getShadowMap(shadowMapper)?.getDefaultSampler(false) || null;\r\n    }\r\n    return this._shadowSampler;\r\n  }\r\n  /** @internal */\r\n  protected isTextureInvalid(shadowMapper: ShadowMapper, texture: ShadowMapType, target: TextureTarget, format: TextureFormat, width: number, height: number): boolean {\r\n    return texture && (texture.target !== target\r\n      || texture.format !== format\r\n      || texture.width !== width\r\n      || texture.height !== height\r\n      || texture.depth !== shadowMapper.numShadowCascades);\r\n  }\r\n  /** @internal */\r\n  protected createTexture(device: Device, target: TextureTarget, format: TextureFormat, width: number, height: number, depth: number, mipmap: boolean): ShadowMapType {\r\n    const options: TextureCreationOptions = {\r\n      colorSpace: 'linear',\r\n      noMipmap: !mipmap\r\n    };\r\n    switch (target) {\r\n      case TextureTarget.Texture2D:\r\n        return device.createTexture2D(format, width, height, options);\r\n      case TextureTarget.TextureCubemap:\r\n        return device.createCubeTexture(format, width, options);\r\n      case TextureTarget.Texture2DArray:\r\n        return device.createTexture2DArray(format, width, height, depth, options);\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n  doUpdateResources(shadowMapper: ShadowMapper) {\r\n    const device = shadowMapper.light.scene.device;\r\n    const colorFormat = this.getShadowMapColorFormat(shadowMapper);\r\n    const target = shadowMapper.getColorAttachment().target;\r\n    const shadowMapWidth = shadowMapper.getColorAttachment().width;\r\n    const shadowMapHeight = shadowMapper.getColorAttachment().height;\r\n    const blur = this._blur;\r\n    const blurMapWidth = shadowMapWidth;\r\n    const blurMapHeight = shadowMapHeight;\r\n    if (!blur) {\r\n      this._blurFramebuffer?.dispose();\r\n      this._blurFramebuffer = null;\r\n      this._blurMap?.dispose();\r\n      this._blurMap = null;\r\n      this._blurFramebuffer2?.dispose();\r\n      this._blurFramebuffer2 = null;\r\n      this._blurMap2?.dispose();\r\n      this._blurMap2 = null;\r\n    }\r\n    if (this.isTextureInvalid(shadowMapper, this._blurMap, target, colorFormat, blurMapWidth, blurMapHeight)) {\r\n      this._blurFramebuffer?.dispose();\r\n      this._blurFramebuffer = null;\r\n      this._blurMap?.dispose();\r\n      this._blurMap = null;\r\n    }\r\n    if (this.isTextureInvalid(shadowMapper, this._blurMap2, target, colorFormat, blurMapWidth, blurMapHeight)) {\r\n      this._blurFramebuffer2?.dispose();\r\n      this._blurFramebuffer2 = null;\r\n      this._blurMap2?.dispose();\r\n      this._blurMap2 = null;\r\n    }\r\n    if (blur) {\r\n      if (!this._blurMap || this._blurMap.disposed) {\r\n        this._blurMap = this.createTexture(device, target, colorFormat, blurMapWidth, blurMapHeight, shadowMapper.numShadowCascades, false);\r\n      }\r\n      if (!this._blurMap2 || (this._mipmap !== this._blurMap2.mipLevelCount > 1) || this._blurMap2.disposed) {\r\n        this._blurMap2 = this.createTexture(device, target, colorFormat, blurMapWidth, blurMapHeight, shadowMapper.numShadowCascades, this._mipmap);\r\n      }\r\n      if (!this._blurFramebuffer || this._blurFramebuffer.disposed) {\r\n        this._blurFramebuffer = device.createFrameBuffer({ colorAttachments: [{ texture: this._blurMap }] });\r\n      }\r\n      if (!this._blurFramebuffer2 || this._blurFramebuffer2.disposed) {\r\n        this._blurFramebuffer2 = device.createFrameBuffer({ colorAttachments: [{ texture: this._blurMap2 }] });\r\n      }\r\n    }\r\n    this._shadowSampler = null;\r\n  }\r\n  postRenderShadowMap(shadowMapper: ShadowMapper) {\r\n    if (this._blur) {\r\n      this._blitterH.blurSize = this._blurSize / shadowMapper.shadowMap.width;\r\n      this._blitterH.kernelSize = this._kernelSize;\r\n      this._blitterH.packFloat = shadowMapper.shadowMap.format === TextureFormat.RGBA8UNORM;\r\n      this._blitterV.blurSize = this._blurSize / shadowMapper.shadowMap.height;\r\n      this._blitterV.kernelSize = this._kernelSize;\r\n      this._blitterV.packFloat = shadowMapper.shadowMap.format === TextureFormat.RGBA8UNORM;\r\n      this._blitterH.blit(shadowMapper.getColorAttachment() as any, this._blurFramebuffer as any);\r\n      this._blitterV.blit(this._blurMap as any, this._blurFramebuffer2 as any);\r\n    }\r\n  }\r\n  isSupported(shadowMapper: ShadowMapper): boolean {\r\n    return this.getShadowMapColorFormat(shadowMapper) !== TextureFormat.Unknown && this.getShadowMapDepthFormat(shadowMapper) !== TextureFormat.Unknown;\r\n  }\r\n  getShaderHash(): string {\r\n    return '';\r\n  }\r\n  getShadowMapColorFormat(shadowMapper: ShadowMapper): TextureFormat {\r\n    const device = shadowMapper.light.scene.device;\r\n    return device.getTextureCaps().supportFloatColorBuffer && device.getTextureCaps().supportLinearFloatTexture\r\n      ? device.getDeviceType() === 'webgl' ? TextureFormat.RGBA32F : TextureFormat.RG32F\r\n      : device.getTextureCaps().supportHalfFloatColorBuffer && device.getTextureCaps().supportLinearHalfFloatTexture\r\n        ? device.getDeviceType() === 'webgl' ? TextureFormat.RGBA16F : TextureFormat.RG16F\r\n        : TextureFormat.RGBA8UNORM;\r\n  }\r\n  getShadowMapDepthFormat(shadowMapper: ShadowMapper): TextureFormat {\r\n    return TextureFormat.D24S8;\r\n  }\r\n  computeShadowMapDepth(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope): PBShaderExp {\r\n    return computeShadowMapDepth(scope, shadowMapper.shadowMap.format);\r\n  }\r\n  computeShadowCSM(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope, shadowVertex: PBShaderExp, NdotL: PBShaderExp, split: PBShaderExp): PBShaderExp {\r\n    const funcNameComputeShadowCSM = 'lib_computeShadowCSM';\r\n    const pb = scope.$builder;\r\n    if (!pb.getFunction(funcNameComputeShadowCSM)) {\r\n      pb.globalScope.$function(funcNameComputeShadowCSM, [pb.vec4('shadowVertex'), pb.float('NdotL'), pb.int('split')], function () {\r\n        this.$l.shadowCoord = pb.div(this.shadowVertex, this.shadowVertex.w);\r\n        this.$l.shadowCoord = pb.add(pb.mul(this.shadowCoord, 0.5), 0.5);\r\n        this.$l.inShadow = pb.all(pb.bvec2(pb.all(pb.bvec4(pb.greaterThanEqual(this.shadowCoord.x, 0), pb.lessThanEqual(this.shadowCoord.x, 1), pb.greaterThanEqual(this.shadowCoord.y, 0), pb.lessThanEqual(this.shadowCoord.y, 1))), pb.lessThanEqual(this.shadowCoord.z, 1)));\r\n        this.$l.shadow = pb.float(1);\r\n        this.$if(this.inShadow, function () {\r\n          this.$l.shadowBias = shadowMapper.computeShadowBiasCSM(this, this.NdotL, this.split);\r\n          this.shadowCoord.z = pb.sub(this.shadowCoord.z, this.shadowBias);\r\n          this.shadow = filterShadowVSM(this, shadowMapper.light.lightType, shadowMapper.shadowMap.format, this.shadowCoord, this.split);\r\n        });\r\n        this.$return(this.shadow);\r\n      });\r\n    }\r\n    return pb.globalScope[funcNameComputeShadowCSM](shadowVertex, NdotL, split);\r\n  }\r\n  computeShadow(shadowMapper: ShadowMapper, scope: PBInsideFunctionScope, shadowVertex: PBShaderExp, NdotL: PBShaderExp): PBShaderExp {\r\n    const funcNameComputeShadow = 'lib_computeShadow';\r\n    const pb = scope.$builder;\r\n    const lib = new ShaderLib(pb);\r\n    const that = this;\r\n    if (!pb.getFunction(funcNameComputeShadow)) {\r\n      pb.globalScope.$function(funcNameComputeShadow, [pb.vec4('shadowVertex'), pb.float('NdotL')], function () {\r\n        if (shadowMapper.light.isPointLight()) {\r\n          this.$l.shadowBias = shadowMapper.computeShadowBias(this, this.distance, this.NdotL);\r\n          this.$l.coord = pb.vec4(this.shadowVertex.xyz, pb.sub(pb.div(pb.length(this.shadowVertex.xyz), this.global.light.lightParams[0].w), this.shadowBias));\r\n          this.$return(filterShadowVSM(this, shadowMapper.light.lightType, shadowMapper.shadowMap.format, this.coord));\r\n        } else {\r\n          this.$l.shadowCoord = pb.div(this.shadowVertex, this.shadowVertex.w);\r\n          this.$l.shadowCoord = pb.add(pb.mul(this.shadowCoord, 0.5), 0.5);\r\n          this.$l.inShadow = pb.all(pb.bvec2(pb.all(pb.bvec4(pb.greaterThanEqual(this.shadowCoord.x, 0), pb.lessThanEqual(this.shadowCoord.x, 1), pb.greaterThanEqual(this.shadowCoord.y, 0), pb.lessThanEqual(this.shadowCoord.y, 1))), pb.lessThanEqual(this.shadowCoord.z, 1)));\r\n          this.$l.shadow = pb.float(1);\r\n          this.$if(this.inShadow, function () {\r\n            if (shadowMapper.light.isSpotLight()) {\r\n              this.$l.nearFar = pb.getDeviceType() === 'webgl' ? this.global.light.shadowCameraParams.xy : this.global.light.lightParams[5].xy;\r\n              this.shadowCoord.z = lib.nonLinearDepthToLinearNormalized(this.shadowCoord.z, this.nearFar);\r\n            }\r\n            this.$l.shadowBias = shadowMapper.computeShadowBias(this, this.shadowCoord.z, this.NdotL);\r\n            this.shadowCoord.z = pb.sub(this.shadowCoord.z, this.shadowBias);\r\n            this.shadow = filterShadowVSM(this, shadowMapper.light.lightType, shadowMapper.shadowMap.format, this.shadowCoord);\r\n          });\r\n          this.$return(this.shadow);\r\n        }\r\n      });\r\n    }\r\n    return pb.globalScope[funcNameComputeShadow](shadowVertex, NdotL);\r\n  }\r\n  useNativeShadowMap(shadowMapper: ShadowMapper): boolean {\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}