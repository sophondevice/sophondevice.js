{"version":3,"file":"light.js","sources":["../../../../libs/device/src/scene/light.ts"],"sourcesContent":["import { Vector3, Vector4, Matrix4x4 } from '@sophon/base';\r\nimport { GraphNode } from './graph_node';\r\nimport { BoundingVolume, BoundingBox } from './bounding_volume';\r\nimport { ShadowMapper } from './shadow/shadowmapper';\r\nimport { LIGHT_TYPE_DIRECTIONAL, LIGHT_TYPE_ENVIRONMENT, LIGHT_TYPE_HEMISPHERIC, LIGHT_TYPE_POINT, LIGHT_TYPE_SPOT } from './values';\r\nimport type { Scene } from './scene';\r\nimport type { TextureCube } from '../device/gpuobject';\r\n\r\nexport enum LightingFalloffMode {\r\n  UNKNOWN = 0,\r\n  CONSTANT = 1,\r\n  LINEAR = 2,\r\n  QUADRATIC = 3,\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport abstract class BaseLight extends GraphNode {\r\n  /** @internal */\r\n  protected _type: number;\r\n  /** @internal */\r\n  protected _intensity: number;\r\n  /** @internal */\r\n  protected _positionRange: Vector4;\r\n  /** @internal */\r\n  protected _directionCutoff: Vector4;\r\n  /** @internal */\r\n  protected _diffuseIntensity: Vector4;\r\n  constructor(scene: Scene, type: number) {\r\n    super(scene);\r\n    this._intensity = 1;\r\n    this._type = type;\r\n    this._positionRange = null;\r\n    this._directionCutoff = null;\r\n    this._diffuseIntensity = null;\r\n    this.addDefaultEventListener('xform_change', () => {\r\n      this.invalidateUniforms();\r\n    });\r\n  }\r\n  get lightType(): number {\r\n    return this._type;\r\n  }\r\n  get intensity() {\r\n    return this._intensity;\r\n  }\r\n  set intensity(val: number) {\r\n    this.setIntensity(val);\r\n  }\r\n  get positionAndRange() {\r\n    if (!this._positionRange) {\r\n      this.computeUniforms();\r\n    }\r\n    return this._positionRange;\r\n  }\r\n  get directionAndCutoff() {\r\n    if (!this._directionCutoff) {\r\n      this.computeUniforms();\r\n    }\r\n    return this._directionCutoff;\r\n  }\r\n  get diffuseAndIntensity() {\r\n    if (!this._diffuseIntensity) {\r\n      this.computeUniforms();\r\n    }\r\n    return this._diffuseIntensity;\r\n  }\r\n  get viewMatrix(): Matrix4x4 {\r\n    return this.invWorldMatrix;\r\n  }\r\n  get viewProjMatrix(): Matrix4x4 {\r\n    return null;\r\n  }\r\n  setIntensity(val: number) {\r\n    if (this._intensity !== val) {\r\n      this._intensity = val;\r\n      this.invalidateUniforms();\r\n    }\r\n    return this;\r\n  }\r\n  invalidateUniforms() {\r\n    this._positionRange = null;\r\n    this._directionCutoff = null;\r\n    this._diffuseIntensity = null;\r\n  }\r\n  isLight(): this is BaseLight {\r\n    return true;\r\n  }\r\n  isPunctualLight(): this is PunctualLight {\r\n    return false;\r\n  }\r\n  isAmbientLight(): this is AmbientLight {\r\n    return false;\r\n  }\r\n  isHemiSphericLight(): this is HemiSphericLight {\r\n    return false;\r\n  }\r\n  isDirectionLight(): this is DirectionalLight {\r\n    return false;\r\n  }\r\n  isPointLight(): this is PointLight {\r\n    return false;\r\n  }\r\n  isSpotLight(): this is SpotLight {\r\n    return false;\r\n  }\r\n  /** @internal */\r\n  abstract computeUniforms(): void;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport abstract class AmbientLight extends BaseLight {\r\n  constructor(scene: Scene, type: number) {\r\n    super(scene, type);\r\n  }\r\n  isAmbientLight(): this is AmbientLight {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport class EnvironmentLight extends AmbientLight {\r\n  /** @internal */\r\n  protected _radianceMap: TextureCube;\r\n  /** @internal */\r\n  protected _irradianceMap: TextureCube;\r\n  constructor(scene: Scene, radianceMap?: TextureCube, irradianceMap?: TextureCube) {\r\n    super(scene, LIGHT_TYPE_ENVIRONMENT);\r\n    this._radianceMap = radianceMap || null;\r\n    this._irradianceMap = irradianceMap || null;\r\n  }\r\n  get radianceMap(): TextureCube {\r\n    return this._radianceMap;\r\n  }\r\n  set radianceMap(map: TextureCube) {\r\n    this._radianceMap = map || null;\r\n  }\r\n  get irradianceMap(): TextureCube {\r\n    return this._irradianceMap;\r\n  }\r\n  set irradianceMap(map: TextureCube) {\r\n    this._irradianceMap = map || null;\r\n  }\r\n  computeUniforms() {\r\n  }\r\n}\r\nexport class HemiSphericLight extends AmbientLight {\r\n  /** @internal */\r\n  protected _colorUp: Vector4;\r\n  /** @internal */\r\n  protected _colorDown: Vector4;\r\n  constructor(scene: Scene) {\r\n    super(scene, LIGHT_TYPE_HEMISPHERIC);\r\n    this._colorUp = Vector4.zero();\r\n    this._colorDown = Vector4.zero();\r\n  }\r\n  get colorUp() {\r\n    return this._colorUp;\r\n  }\r\n  set colorUp(val: Vector4) {\r\n    this.setColorUp(val);\r\n  }\r\n  setColorUp(val: Vector4) {\r\n    this._colorUp.assign(val.getArray());\r\n    this.invalidateUniforms();\r\n    return this;\r\n  }\r\n  get colorDown() {\r\n    return this._colorDown;\r\n  }\r\n  set colorDown(val: Vector4) {\r\n    this.setColorDown(val);\r\n  }\r\n  setColorDown(val: Vector4) {\r\n    this._colorDown.assign(val.getArray());\r\n    this.invalidateUniforms();\r\n    return this;\r\n  }\r\n  isHemiSphericLight(): this is HemiSphericLight {\r\n    return true;\r\n  }\r\n  /** @internal */\r\n  computeUniforms() {\r\n    this._positionRange = this.colorUp;\r\n    this._directionCutoff = this.colorDown;\r\n    this._diffuseIntensity = new Vector4(1, 1, 1, this.intensity);\r\n  }\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport abstract class PunctualLight extends BaseLight {\r\n  /** @internal */\r\n  protected _color: Vector4;\r\n  /** @internal */\r\n  protected _castShadow: boolean;\r\n  /** @internal */\r\n  protected _lightViewProjectionMatrix: Matrix4x4;\r\n  /** @internal */\r\n  protected _shadowMapper: ShadowMapper;\r\n  constructor(scene: Scene, type: number) {\r\n    super(scene, type);\r\n    this._color = Vector4.one();\r\n    this._castShadow = false;\r\n    this._lightViewProjectionMatrix = Matrix4x4.identity();\r\n    this._shadowMapper = new ShadowMapper(this);\r\n  }\r\n  get color(): Vector4 {\r\n    return this._color;\r\n  }\r\n  set color(clr: Vector4) {\r\n    this.setColor(clr);\r\n  }\r\n  setColor(clr: Vector4) {\r\n    this._color.assign(clr.getArray());\r\n    this.invalidateUniforms();\r\n    return this;\r\n  }\r\n  get castShadow(): boolean {\r\n    return this._castShadow;\r\n  }\r\n  set castShadow(b: boolean) {\r\n    this.setCastShadow(b);\r\n  }\r\n  setCastShadow(b: boolean): this {\r\n    this._castShadow = b;\r\n    return this;\r\n  }\r\n  get viewProjMatrix(): Matrix4x4 {\r\n    return this._lightViewProjectionMatrix;\r\n  }\r\n  set viewProjMatrix(mat: Matrix4x4) {\r\n    this.setLightViewProjectionMatrix(mat);\r\n  }\r\n  get shadow(): ShadowMapper {\r\n    return this._shadowMapper;\r\n  }\r\n  setLightViewProjectionMatrix(mat: Matrix4x4): this {\r\n    this._lightViewProjectionMatrix.assign(mat.getArray());\r\n    return this;\r\n  }\r\n  isPunctualLight(): this is PunctualLight {\r\n    return true;\r\n  }\r\n  dispose() {\r\n    this._shadowMapper.dispose();\r\n    super.dispose();\r\n  }\r\n}\r\n\r\nexport class DirectionalLight extends PunctualLight {\r\n  constructor(scene: Scene) {\r\n    super(scene, LIGHT_TYPE_DIRECTIONAL);\r\n  }\r\n  isDirectionLight(): this is DirectionalLight {\r\n    return true;\r\n  }\r\n  /** @internal */\r\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\r\n    return null;\r\n  }\r\n  /** @internal */\r\n  computeUniforms() {\r\n    const a = this.worldMatrix.getRow(3);\r\n    const b = this.worldMatrix.getRow(2).scaleBy(-1);\r\n    this._positionRange = new Vector4(a.x, a.y, a.z, 0);\r\n    this._directionCutoff = new Vector4(b.x, b.y, b.z, 0);\r\n    this._diffuseIntensity = new Vector4(this.color.x, this.color.y, this.color.z, this.intensity);\r\n  }\r\n  // adapt from DXSDK\r\n  /** @internal */\r\n  private _computeNearAndFar(frustumMin: Vector3, frustumMax: Vector3, aabbLightSpace: Vector3[]): [number, number] {\r\n    type Triangle = { pt: [Vector3, Vector3, Vector3], culled: boolean };\r\n    function dupTriangle(src: Triangle): Triangle {\r\n      return {\r\n        pt: [\r\n          src.pt[0] ? new Vector3(src.pt[0]) : null,\r\n          src.pt[1] ? new Vector3(src.pt[1]) : null,\r\n          src.pt[2] ? new Vector3(src.pt[2]) : null\r\n        ],\r\n        culled: src.culled\r\n      };\r\n    }\r\n    let nearPlane = Number.MAX_VALUE;\r\n    let farPlane = -Number.MAX_VALUE;\r\n    const triangleList: Triangle[] = Array.from({ length: 16 }).map(val => ({ pt: [null, null, null], culled: false }));\r\n    let triangleCount = 1;\r\n    triangleList[0].pt[0] = aabbLightSpace[0];\r\n    triangleList[0].pt[1] = aabbLightSpace[1];\r\n    triangleList[0].pt[2] = aabbLightSpace[2];\r\n    const triIndices = [0, 1, 2, 1, 2, 3, 4, 5, 6, 5, 6, 7, 0, 2, 4, 2, 4, 6, 1, 3, 5, 3, 5, 7, 0, 1, 4, 1, 4, 5, 2, 3, 6, 3, 6, 7];\r\n    const pointPassesCollision: number[] = [0, 0, 0];\r\n    const minx = frustumMin.x;\r\n    const maxx = frustumMax.x;\r\n    const miny = frustumMin.y;\r\n    const maxy = frustumMax.y;\r\n    for (let i = 0; i < 12; i++) {\r\n      triangleList[0].pt[0] = aabbLightSpace[triIndices[i * 3 + 0]];\r\n      triangleList[0].pt[1] = aabbLightSpace[triIndices[i * 3 + 1]];\r\n      triangleList[0].pt[2] = aabbLightSpace[triIndices[i * 3 + 2]];\r\n      triangleList[0].culled = false;\r\n      triangleCount = 1;\r\n      for (let j = 0; j < 4; j++) {\r\n        let edge: number, comp: number;\r\n        if (j === 0) {\r\n          edge = minx;\r\n          comp = 0;\r\n        } else if (j === 1) {\r\n          edge = maxx;\r\n          comp = 0;\r\n        } else if (j === 2) {\r\n          edge = miny;\r\n          comp = 1;\r\n        } else {\r\n          edge = maxy;\r\n          comp = 1;\r\n        }\r\n        let k = 0;\r\n        while (k < triangleCount) {\r\n          if (!triangleList[k].culled) {\r\n            let insideVertCount = 0;\r\n            let tempOrder: Vector3 = null;\r\n            if (j === 0) {\r\n              for (let t = 0; t < 3; t++) {\r\n                if (triangleList[k].pt[t].x > minx) {\r\n                  pointPassesCollision[t] = 1;\r\n                } else {\r\n                  pointPassesCollision[t] = 0;\r\n                }\r\n                insideVertCount += pointPassesCollision[t];\r\n              }\r\n            } else if (j === 1) {\r\n              for (let t = 0; t < 3; t++) {\r\n                if (triangleList[k].pt[t].x < maxx) {\r\n                  pointPassesCollision[t] = 1;\r\n                } else {\r\n                  pointPassesCollision[t] = 0;\r\n                }\r\n                insideVertCount += pointPassesCollision[t];\r\n              }\r\n            } else if (j === 2) {\r\n              for (let t = 0; t < 3; t++) {\r\n                if (triangleList[k].pt[t].y > miny) {\r\n                  pointPassesCollision[t] = 1;\r\n                } else {\r\n                  pointPassesCollision[t] = 0;\r\n                }\r\n                insideVertCount += pointPassesCollision[t];\r\n              }\r\n            } else {\r\n              for (let t = 0; t < 3; t++) {\r\n                if (triangleList[k].pt[t].y < maxy) {\r\n                  pointPassesCollision[t] = 1;\r\n                } else {\r\n                  pointPassesCollision[t] = 0;\r\n                }\r\n                insideVertCount += pointPassesCollision[t];\r\n              }\r\n            }\r\n            if (pointPassesCollision[1] && !pointPassesCollision[0]) {\r\n              tempOrder = triangleList[k].pt[0];\r\n              triangleList[k].pt[0] = triangleList[k].pt[1];\r\n              triangleList[k].pt[1] = tempOrder;\r\n              pointPassesCollision[0] = 1;\r\n              pointPassesCollision[1] = 0;\r\n            }\r\n            if (pointPassesCollision[2] && !pointPassesCollision[1]) {\r\n              tempOrder = triangleList[k].pt[1];\r\n              triangleList[k].pt[1] = triangleList[k].pt[2];\r\n              triangleList[k].pt[2] = tempOrder;\r\n              pointPassesCollision[1] = 1;\r\n              pointPassesCollision[2] = 0;\r\n            }\r\n            if (pointPassesCollision[1] && !pointPassesCollision[0]) {\r\n              tempOrder = triangleList[k].pt[0];\r\n              triangleList[k].pt[0] = triangleList[k].pt[1];\r\n              triangleList[k].pt[1] = tempOrder;\r\n              pointPassesCollision[0] = 1;\r\n              pointPassesCollision[1] = 0;\r\n            }\r\n            if (insideVertCount === 0) {\r\n              triangleList[k].culled = true;\r\n            } else if (insideVertCount === 1) {\r\n              triangleList[k].culled = false;\r\n              const v0Tov1 = Vector3.sub(triangleList[k].pt[1], triangleList[k].pt[0]);\r\n              const v0Tov2 = Vector3.sub(triangleList[k].pt[2], triangleList[k].pt[0]);\r\n              const hitPointTimeRatio = edge - triangleList[k].pt[0].getArray()[comp];\r\n              const distanceAlongV1 = hitPointTimeRatio / v0Tov1.getArray()[comp];\r\n              const distanceAloneV2 = hitPointTimeRatio / v0Tov2.getArray()[comp];\r\n              v0Tov1.scaleBy(distanceAlongV1);\r\n              v0Tov1.addBy(triangleList[k].pt[0]);\r\n              v0Tov2.scaleBy(distanceAloneV2);\r\n              v0Tov2.addBy(triangleList[k].pt[0]);\r\n              triangleList[k].pt[1] = v0Tov2;\r\n              triangleList[k].pt[2] = v0Tov1;\r\n            } else if (insideVertCount === 2) {\r\n              triangleList[triangleCount] = dupTriangle(triangleList[k + 1]);\r\n              triangleList[k].culled = false;\r\n              triangleList[k + 1].culled = false;\r\n              const v2Tov0 = Vector3.sub(triangleList[k].pt[0], triangleList[k].pt[2]);\r\n              const v2Tov1 = Vector3.sub(triangleList[k].pt[1], triangleList[k].pt[2]);\r\n              const hitPointTime_2_0 = edge - triangleList[k].pt[2].getArray()[comp];\r\n              const distanceAloneVec_2_0 = hitPointTime_2_0 / v2Tov0.getArray()[comp];\r\n              v2Tov0.scaleBy(distanceAloneVec_2_0);\r\n              v2Tov0.addBy(triangleList[k].pt[2]);\r\n              triangleList[k + 1].pt[0] = new Vector3(triangleList[k].pt[0]);\r\n              triangleList[k + 1].pt[1] = new Vector3(triangleList[k].pt[1]);\r\n              triangleList[k + 1].pt[2] = v2Tov0;\r\n              const hitPointTime_2_1 = edge - triangleList[k].pt[2].getArray()[comp];\r\n              const distanceAloneVec_2_1 = hitPointTime_2_1 / v2Tov1.getArray()[comp];\r\n              v2Tov1.scaleBy(distanceAloneVec_2_1);\r\n              v2Tov1.addBy(triangleList[k].pt[2]);\r\n              triangleList[k].pt[0] = new Vector3(triangleList[k + 1].pt[1]);\r\n              triangleList[k].pt[1] = new Vector3(triangleList[k + 1].pt[2]);\r\n              triangleList[k].pt[2] = v2Tov1;\r\n              triangleCount++;\r\n              k++;\r\n            } else {\r\n              triangleList[k].culled = false;\r\n            }\r\n          }\r\n          k++;\r\n        }\r\n      }\r\n      for (let index = 0; index < triangleCount; index++) {\r\n        if (!triangleList[index].culled) {\r\n          for (let v = 0; v < 3; v++) {\r\n            const z = triangleList[index].pt[v].z;\r\n            if (nearPlane > z) {\r\n              nearPlane = z;\r\n            }\r\n            if (farPlane < z) {\r\n              farPlane = z;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return [nearPlane, farPlane];\r\n  }\r\n}\r\n\r\nexport class PointLight extends PunctualLight {\r\n  /** @internal */\r\n  protected _range: number;\r\n  constructor(scene: Scene) {\r\n    super(scene, LIGHT_TYPE_POINT);\r\n    this._range = 1;\r\n    this.invalidateBoundingVolume();\r\n  }\r\n  get range() {\r\n    return this._range;\r\n  }\r\n  set range(val: number) {\r\n    this.setRange(val);\r\n  }\r\n  setRange(val: number) {\r\n    if (this._range !== val) {\r\n      this._range = val;\r\n      this.invalidateUniforms();\r\n      this.invalidateBoundingVolume();\r\n    }\r\n    return this;\r\n  }\r\n  isPointLight(): this is PointLight {\r\n    return true;\r\n  }\r\n  /** @internal */\r\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\r\n    const bbox = bv ? (bv as BoundingBox) : new BoundingBox();\r\n    bbox.minPoint = new Vector3(-this._range, -this._range, -this._range);\r\n    bbox.maxPoint = new Vector3(this._range, this._range, this._range);\r\n    return bbox;\r\n  }\r\n  /** @internal */\r\n  computeUniforms() {\r\n    const a = this.worldMatrix.getRow(3);\r\n    const b = this.worldMatrix.getRow(2);\r\n    this._positionRange = new Vector4(a.x, a.y, a.z, this.range);\r\n    this._directionCutoff = new Vector4(b.x, b.y, b.z, 0);\r\n    this._diffuseIntensity = new Vector4(this.color.x, this.color.y, this.color.z, this.intensity);\r\n  }\r\n}\r\n\r\nexport class SpotLight extends PunctualLight {\r\n  /** @internal */\r\n  protected _range: number;\r\n  /** @internal */\r\n  protected _cutoff: number;\r\n  constructor(scene: Scene) {\r\n    super(scene, LIGHT_TYPE_SPOT);\r\n    this._range = 1;\r\n    this._cutoff = Math.cos(Math.PI / 4);\r\n    this.invalidateBoundingVolume();\r\n  }\r\n  get range() {\r\n    return this._range;\r\n  }\r\n  set range(val: number) {\r\n    this.setRange(val);\r\n  }\r\n  setRange(val: number) {\r\n    if (this._range !== val) {\r\n      this._range = val;\r\n      this.invalidateUniforms();\r\n      this.invalidateBoundingVolume();\r\n    }\r\n    return this;\r\n  }\r\n  get cutoff() {\r\n    return this._cutoff;\r\n  }\r\n  set cutoff(val: number) {\r\n    this.setCutoff(val);\r\n  }\r\n  setCutoff(val: number) {\r\n    if (this._cutoff !== val) {\r\n      this._cutoff = val;\r\n      this.invalidateUniforms();\r\n      this.invalidateBoundingVolume();\r\n    }\r\n    return this;\r\n  }\r\n  isSpotLight(): this is SpotLight {\r\n    return true;\r\n  }\r\n  /** @internal */\r\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\r\n    const bbox = bv ? (bv as BoundingBox) : new BoundingBox();\r\n    const cosCutoff = Math.cos(this._cutoff);\r\n    const r = (this._range / cosCutoff) * Math.sqrt(1 - cosCutoff * cosCutoff);\r\n    bbox.minPoint = new Vector3(-r, -r, 0);\r\n    bbox.maxPoint = new Vector3(r, r, this._range);\r\n    return bbox;\r\n  }\r\n  /** @internal */\r\n  computeUniforms() {\r\n    const a = this.worldMatrix.getRow(3);\r\n    const b = this.worldMatrix.getRow(2).scaleBy(-1);\r\n    this._positionRange = new Vector4(a.x, a.y, a.z, this.range);\r\n    this._directionCutoff = new Vector4(b.x, b.y, b.z, Math.cos(this.cutoff));\r\n    this._diffuseIntensity = new Vector4(this.color.x, this.color.y, this.color.z, this.intensity);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}