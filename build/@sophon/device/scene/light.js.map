{"version":3,"file":"light.js","sources":["../../../../libs/device/src/scene/light.ts"],"sourcesContent":["import { Vector3, Vector4, Matrix4x4 } from '@sophon/base';\nimport { GraphNode } from './graph_node';\nimport { BoundingVolume, BoundingBox } from './bounding_volume';\nimport { ShadowMapper } from './shadow/shadowmapper';\nimport { LIGHT_TYPE_DIRECTIONAL, LIGHT_TYPE_ENVIRONMENT, LIGHT_TYPE_HEMISPHERIC, LIGHT_TYPE_POINT, LIGHT_TYPE_SPOT } from './values';\nimport type { Scene } from './scene';\nimport type { TextureCube } from '../device/gpuobject';\n\nexport enum LightingFalloffMode {\n  UNKNOWN = 0,\n  CONSTANT = 1,\n  LINEAR = 2,\n  QUADRATIC = 3,\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport abstract class BaseLight extends GraphNode {\n  /** @internal */\n  protected _type: number;\n  /** @internal */\n  protected _intensity: number;\n  /** @internal */\n  protected _positionRange: Vector4;\n  /** @internal */\n  protected _directionCutoff: Vector4;\n  /** @internal */\n  protected _diffuseIntensity: Vector4;\n  constructor(scene: Scene, type: number) {\n    super(scene);\n    this._intensity = 1;\n    this._type = type;\n    this._positionRange = null;\n    this._directionCutoff = null;\n    this._diffuseIntensity = null;\n    this.addDefaultEventListener('xform_change', () => {\n      this.invalidateUniforms();\n    });\n  }\n  get lightType(): number {\n    return this._type;\n  }\n  get intensity() {\n    return this._intensity;\n  }\n  set intensity(val: number) {\n    this.setIntensity(val);\n  }\n  get positionAndRange() {\n    if (!this._positionRange) {\n      this.computeUniforms();\n    }\n    return this._positionRange;\n  }\n  get directionAndCutoff() {\n    if (!this._directionCutoff) {\n      this.computeUniforms();\n    }\n    return this._directionCutoff;\n  }\n  get diffuseAndIntensity() {\n    if (!this._diffuseIntensity) {\n      this.computeUniforms();\n    }\n    return this._diffuseIntensity;\n  }\n  get viewMatrix(): Matrix4x4 {\n    return this.invWorldMatrix;\n  }\n  get viewProjMatrix(): Matrix4x4 {\n    return null;\n  }\n  setIntensity(val: number) {\n    if (this._intensity !== val) {\n      this._intensity = val;\n      this.invalidateUniforms();\n    }\n    return this;\n  }\n  invalidateUniforms() {\n    this._positionRange = null;\n    this._directionCutoff = null;\n    this._diffuseIntensity = null;\n  }\n  isLight(): this is BaseLight {\n    return true;\n  }\n  isPunctualLight(): this is PunctualLight {\n    return false;\n  }\n  isAmbientLight(): this is AmbientLight {\n    return false;\n  }\n  isHemiSphericLight(): this is HemiSphericLight {\n    return false;\n  }\n  isDirectionLight(): this is DirectionalLight {\n    return false;\n  }\n  isPointLight(): this is PointLight {\n    return false;\n  }\n  isSpotLight(): this is SpotLight {\n    return false;\n  }\n  /** @internal */\n  abstract computeUniforms(): void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport abstract class AmbientLight extends BaseLight {\n  constructor(scene: Scene, type: number) {\n    super(scene, type);\n  }\n  isAmbientLight(): this is AmbientLight {\n    return true;\n  }\n}\n\nexport class EnvironmentLight extends AmbientLight {\n  /** @internal */\n  protected _radianceMap: TextureCube;\n  /** @internal */\n  protected _irradianceMap: TextureCube;\n  constructor(scene: Scene, radianceMap?: TextureCube, irradianceMap?: TextureCube) {\n    super(scene, LIGHT_TYPE_ENVIRONMENT);\n    this._radianceMap = radianceMap || null;\n    this._irradianceMap = irradianceMap || null;\n  }\n  get radianceMap(): TextureCube {\n    return this._radianceMap;\n  }\n  set radianceMap(map: TextureCube) {\n    this._radianceMap = map || null;\n  }\n  get irradianceMap(): TextureCube {\n    return this._irradianceMap;\n  }\n  set irradianceMap(map: TextureCube) {\n    this._irradianceMap = map || null;\n  }\n  computeUniforms() {\n  }\n}\nexport class HemiSphericLight extends AmbientLight {\n  /** @internal */\n  protected _colorUp: Vector4;\n  /** @internal */\n  protected _colorDown: Vector4;\n  constructor(scene: Scene) {\n    super(scene, LIGHT_TYPE_HEMISPHERIC);\n    this._colorUp = Vector4.zero();\n    this._colorDown = Vector4.zero();\n  }\n  get colorUp() {\n    return this._colorUp;\n  }\n  set colorUp(val: Vector4) {\n    this.setColorUp(val);\n  }\n  setColorUp(val: Vector4) {\n    this._colorUp.assign(val.getArray());\n    this.invalidateUniforms();\n    return this;\n  }\n  get colorDown() {\n    return this._colorDown;\n  }\n  set colorDown(val: Vector4) {\n    this.setColorDown(val);\n  }\n  setColorDown(val: Vector4) {\n    this._colorDown.assign(val.getArray());\n    this.invalidateUniforms();\n    return this;\n  }\n  isHemiSphericLight(): this is HemiSphericLight {\n    return true;\n  }\n  /** @internal */\n  computeUniforms() {\n    this._positionRange = this.colorUp;\n    this._directionCutoff = this.colorDown;\n    this._diffuseIntensity = new Vector4(1, 1, 1, this.intensity);\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport abstract class PunctualLight extends BaseLight {\n  /** @internal */\n  protected _color: Vector4;\n  /** @internal */\n  protected _castShadow: boolean;\n  /** @internal */\n  protected _lightViewProjectionMatrix: Matrix4x4;\n  /** @internal */\n  protected _shadowMapper: ShadowMapper;\n  constructor(scene: Scene, type: number) {\n    super(scene, type);\n    this._color = Vector4.one();\n    this._castShadow = false;\n    this._lightViewProjectionMatrix = Matrix4x4.identity();\n    this._shadowMapper = new ShadowMapper(this);\n  }\n  get color(): Vector4 {\n    return this._color;\n  }\n  set color(clr: Vector4) {\n    this.setColor(clr);\n  }\n  setColor(clr: Vector4) {\n    this._color.assign(clr.getArray());\n    this.invalidateUniforms();\n    return this;\n  }\n  get castShadow(): boolean {\n    return this._castShadow;\n  }\n  set castShadow(b: boolean) {\n    this.setCastShadow(b);\n  }\n  setCastShadow(b: boolean): this {\n    this._castShadow = b;\n    return this;\n  }\n  get viewProjMatrix(): Matrix4x4 {\n    return this._lightViewProjectionMatrix;\n  }\n  set viewProjMatrix(mat: Matrix4x4) {\n    this.setLightViewProjectionMatrix(mat);\n  }\n  get shadow(): ShadowMapper {\n    return this._shadowMapper;\n  }\n  setLightViewProjectionMatrix(mat: Matrix4x4): this {\n    this._lightViewProjectionMatrix.assign(mat.getArray());\n    return this;\n  }\n  isPunctualLight(): this is PunctualLight {\n    return true;\n  }\n  dispose() {\n    this._shadowMapper.dispose();\n    super.dispose();\n  }\n}\n\nexport class DirectionalLight extends PunctualLight {\n  constructor(scene: Scene) {\n    super(scene, LIGHT_TYPE_DIRECTIONAL);\n  }\n  isDirectionLight(): this is DirectionalLight {\n    return true;\n  }\n  /** @internal */\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\n    return null;\n  }\n  /** @internal */\n  computeUniforms() {\n    const a = this.worldMatrix.getRow(3);\n    const b = this.worldMatrix.getRow(2).scaleBy(-1);\n    this._positionRange = new Vector4(a.x, a.y, a.z, 0);\n    this._directionCutoff = new Vector4(b.x, b.y, b.z, 0);\n    this._diffuseIntensity = new Vector4(this.color.x, this.color.y, this.color.z, this.intensity);\n  }\n  // adapt from DXSDK\n  /** @internal */\n  private _computeNearAndFar(frustumMin: Vector3, frustumMax: Vector3, aabbLightSpace: Vector3[]): [number, number] {\n    type Triangle = { pt: [Vector3, Vector3, Vector3], culled: boolean };\n    function dupTriangle(src: Triangle): Triangle {\n      return {\n        pt: [\n          src.pt[0] ? new Vector3(src.pt[0]) : null,\n          src.pt[1] ? new Vector3(src.pt[1]) : null,\n          src.pt[2] ? new Vector3(src.pt[2]) : null\n        ],\n        culled: src.culled\n      };\n    }\n    let nearPlane = Number.MAX_VALUE;\n    let farPlane = -Number.MAX_VALUE;\n    const triangleList: Triangle[] = Array.from({ length: 16 }).map(val => ({ pt: [null, null, null], culled: false }));\n    let triangleCount = 1;\n    triangleList[0].pt[0] = aabbLightSpace[0];\n    triangleList[0].pt[1] = aabbLightSpace[1];\n    triangleList[0].pt[2] = aabbLightSpace[2];\n    const triIndices = [0, 1, 2, 1, 2, 3, 4, 5, 6, 5, 6, 7, 0, 2, 4, 2, 4, 6, 1, 3, 5, 3, 5, 7, 0, 1, 4, 1, 4, 5, 2, 3, 6, 3, 6, 7];\n    const pointPassesCollision: number[] = [0, 0, 0];\n    const minx = frustumMin.x;\n    const maxx = frustumMax.x;\n    const miny = frustumMin.y;\n    const maxy = frustumMax.y;\n    for (let i = 0; i < 12; i++) {\n      triangleList[0].pt[0] = aabbLightSpace[triIndices[i * 3 + 0]];\n      triangleList[0].pt[1] = aabbLightSpace[triIndices[i * 3 + 1]];\n      triangleList[0].pt[2] = aabbLightSpace[triIndices[i * 3 + 2]];\n      triangleList[0].culled = false;\n      triangleCount = 1;\n      for (let j = 0; j < 4; j++) {\n        let edge: number, comp: number;\n        if (j === 0) {\n          edge = minx;\n          comp = 0;\n        } else if (j === 1) {\n          edge = maxx;\n          comp = 0;\n        } else if (j === 2) {\n          edge = miny;\n          comp = 1;\n        } else {\n          edge = maxy;\n          comp = 1;\n        }\n        let k = 0;\n        while (k < triangleCount) {\n          if (!triangleList[k].culled) {\n            let insideVertCount = 0;\n            let tempOrder: Vector3 = null;\n            if (j === 0) {\n              for (let t = 0; t < 3; t++) {\n                if (triangleList[k].pt[t].x > minx) {\n                  pointPassesCollision[t] = 1;\n                } else {\n                  pointPassesCollision[t] = 0;\n                }\n                insideVertCount += pointPassesCollision[t];\n              }\n            } else if (j === 1) {\n              for (let t = 0; t < 3; t++) {\n                if (triangleList[k].pt[t].x < maxx) {\n                  pointPassesCollision[t] = 1;\n                } else {\n                  pointPassesCollision[t] = 0;\n                }\n                insideVertCount += pointPassesCollision[t];\n              }\n            } else if (j === 2) {\n              for (let t = 0; t < 3; t++) {\n                if (triangleList[k].pt[t].y > miny) {\n                  pointPassesCollision[t] = 1;\n                } else {\n                  pointPassesCollision[t] = 0;\n                }\n                insideVertCount += pointPassesCollision[t];\n              }\n            } else {\n              for (let t = 0; t < 3; t++) {\n                if (triangleList[k].pt[t].y < maxy) {\n                  pointPassesCollision[t] = 1;\n                } else {\n                  pointPassesCollision[t] = 0;\n                }\n                insideVertCount += pointPassesCollision[t];\n              }\n            }\n            if (pointPassesCollision[1] && !pointPassesCollision[0]) {\n              tempOrder = triangleList[k].pt[0];\n              triangleList[k].pt[0] = triangleList[k].pt[1];\n              triangleList[k].pt[1] = tempOrder;\n              pointPassesCollision[0] = 1;\n              pointPassesCollision[1] = 0;\n            }\n            if (pointPassesCollision[2] && !pointPassesCollision[1]) {\n              tempOrder = triangleList[k].pt[1];\n              triangleList[k].pt[1] = triangleList[k].pt[2];\n              triangleList[k].pt[2] = tempOrder;\n              pointPassesCollision[1] = 1;\n              pointPassesCollision[2] = 0;\n            }\n            if (pointPassesCollision[1] && !pointPassesCollision[0]) {\n              tempOrder = triangleList[k].pt[0];\n              triangleList[k].pt[0] = triangleList[k].pt[1];\n              triangleList[k].pt[1] = tempOrder;\n              pointPassesCollision[0] = 1;\n              pointPassesCollision[1] = 0;\n            }\n            if (insideVertCount === 0) {\n              triangleList[k].culled = true;\n            } else if (insideVertCount === 1) {\n              triangleList[k].culled = false;\n              const v0Tov1 = Vector3.sub(triangleList[k].pt[1], triangleList[k].pt[0]);\n              const v0Tov2 = Vector3.sub(triangleList[k].pt[2], triangleList[k].pt[0]);\n              const hitPointTimeRatio = edge - triangleList[k].pt[0].getArray()[comp];\n              const distanceAlongV1 = hitPointTimeRatio / v0Tov1.getArray()[comp];\n              const distanceAloneV2 = hitPointTimeRatio / v0Tov2.getArray()[comp];\n              v0Tov1.scaleBy(distanceAlongV1);\n              v0Tov1.addBy(triangleList[k].pt[0]);\n              v0Tov2.scaleBy(distanceAloneV2);\n              v0Tov2.addBy(triangleList[k].pt[0]);\n              triangleList[k].pt[1] = v0Tov2;\n              triangleList[k].pt[2] = v0Tov1;\n            } else if (insideVertCount === 2) {\n              triangleList[triangleCount] = dupTriangle(triangleList[k + 1]);\n              triangleList[k].culled = false;\n              triangleList[k + 1].culled = false;\n              const v2Tov0 = Vector3.sub(triangleList[k].pt[0], triangleList[k].pt[2]);\n              const v2Tov1 = Vector3.sub(triangleList[k].pt[1], triangleList[k].pt[2]);\n              const hitPointTime_2_0 = edge - triangleList[k].pt[2].getArray()[comp];\n              const distanceAloneVec_2_0 = hitPointTime_2_0 / v2Tov0.getArray()[comp];\n              v2Tov0.scaleBy(distanceAloneVec_2_0);\n              v2Tov0.addBy(triangleList[k].pt[2]);\n              triangleList[k + 1].pt[0] = new Vector3(triangleList[k].pt[0]);\n              triangleList[k + 1].pt[1] = new Vector3(triangleList[k].pt[1]);\n              triangleList[k + 1].pt[2] = v2Tov0;\n              const hitPointTime_2_1 = edge - triangleList[k].pt[2].getArray()[comp];\n              const distanceAloneVec_2_1 = hitPointTime_2_1 / v2Tov1.getArray()[comp];\n              v2Tov1.scaleBy(distanceAloneVec_2_1);\n              v2Tov1.addBy(triangleList[k].pt[2]);\n              triangleList[k].pt[0] = new Vector3(triangleList[k + 1].pt[1]);\n              triangleList[k].pt[1] = new Vector3(triangleList[k + 1].pt[2]);\n              triangleList[k].pt[2] = v2Tov1;\n              triangleCount++;\n              k++;\n            } else {\n              triangleList[k].culled = false;\n            }\n          }\n          k++;\n        }\n      }\n      for (let index = 0; index < triangleCount; index++) {\n        if (!triangleList[index].culled) {\n          for (let v = 0; v < 3; v++) {\n            const z = triangleList[index].pt[v].z;\n            if (nearPlane > z) {\n              nearPlane = z;\n            }\n            if (farPlane < z) {\n              farPlane = z;\n            }\n          }\n        }\n      }\n    }\n    return [nearPlane, farPlane];\n  }\n}\n\nexport class PointLight extends PunctualLight {\n  /** @internal */\n  protected _range: number;\n  constructor(scene: Scene) {\n    super(scene, LIGHT_TYPE_POINT);\n    this._range = 1;\n    this.invalidateBoundingVolume();\n  }\n  get range() {\n    return this._range;\n  }\n  set range(val: number) {\n    this.setRange(val);\n  }\n  setRange(val: number) {\n    if (this._range !== val) {\n      this._range = val;\n      this.invalidateUniforms();\n      this.invalidateBoundingVolume();\n    }\n    return this;\n  }\n  isPointLight(): this is PointLight {\n    return true;\n  }\n  /** @internal */\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\n    const bbox = bv ? (bv as BoundingBox) : new BoundingBox();\n    bbox.minPoint = new Vector3(-this._range, -this._range, -this._range);\n    bbox.maxPoint = new Vector3(this._range, this._range, this._range);\n    return bbox;\n  }\n  /** @internal */\n  computeUniforms() {\n    const a = this.worldMatrix.getRow(3);\n    const b = this.worldMatrix.getRow(2);\n    this._positionRange = new Vector4(a.x, a.y, a.z, this.range);\n    this._directionCutoff = new Vector4(b.x, b.y, b.z, 0);\n    this._diffuseIntensity = new Vector4(this.color.x, this.color.y, this.color.z, this.intensity);\n  }\n}\n\nexport class SpotLight extends PunctualLight {\n  /** @internal */\n  protected _range: number;\n  /** @internal */\n  protected _cutoff: number;\n  constructor(scene: Scene) {\n    super(scene, LIGHT_TYPE_SPOT);\n    this._range = 1;\n    this._cutoff = Math.cos(Math.PI / 4);\n    this.invalidateBoundingVolume();\n  }\n  get range() {\n    return this._range;\n  }\n  set range(val: number) {\n    this.setRange(val);\n  }\n  setRange(val: number) {\n    if (this._range !== val) {\n      this._range = val;\n      this.invalidateUniforms();\n      this.invalidateBoundingVolume();\n    }\n    return this;\n  }\n  get cutoff() {\n    return this._cutoff;\n  }\n  set cutoff(val: number) {\n    this.setCutoff(val);\n  }\n  setCutoff(val: number) {\n    if (this._cutoff !== val) {\n      this._cutoff = val;\n      this.invalidateUniforms();\n      this.invalidateBoundingVolume();\n    }\n    return this;\n  }\n  isSpotLight(): this is SpotLight {\n    return true;\n  }\n  /** @internal */\n  computeBoundingVolume(bv: BoundingVolume): BoundingVolume {\n    const bbox = bv ? (bv as BoundingBox) : new BoundingBox();\n    const cosCutoff = Math.cos(this._cutoff);\n    const r = (this._range / cosCutoff) * Math.sqrt(1 - cosCutoff * cosCutoff);\n    bbox.minPoint = new Vector3(-r, -r, 0);\n    bbox.maxPoint = new Vector3(r, r, this._range);\n    return bbox;\n  }\n  /** @internal */\n  computeUniforms() {\n    const a = this.worldMatrix.getRow(3);\n    const b = this.worldMatrix.getRow(2).scaleBy(-1);\n    this._positionRange = new Vector4(a.x, a.y, a.z, this.range);\n    this._directionCutoff = new Vector4(b.x, b.y, b.z, Math.cos(this.cutoff));\n    this._diffuseIntensity = new Vector4(this.color.x, this.color.y, this.color.z, this.intensity);\n  }\n}\n"],"names":[],"mappings":"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"}