{"version":3,"file":"gamma.js","sources":["../../../../../libs/device/src/scene/blitter/gamma.ts"],"sourcesContent":["import { Blitter, BlitType } from \"./blitter\";\r\nimport { ShaderType } from \"../../device/base_types\";\r\nimport type { BindGroup } from '../../device/gpuobject';\r\nimport type { PBShaderExp, PBInsideFunctionScope, PBGlobalScope } from \"../../device/builder\";\r\n\r\nexport class GammaBlitter extends Blitter {\r\n  protected _gamma: number;\r\n  constructor(gamma: number) {\r\n    super();\r\n    this._gamma = gamma ?? 2.2;\r\n  }\r\n  setup(scope: PBGlobalScope, type: BlitType) {\r\n    const pb = scope.$builder;\r\n    if (pb.shaderType === ShaderType.Fragment) {\r\n      scope.gamma = pb.float().uniform(0);\r\n    }\r\n  }\r\n  setUniforms(bindGroup: BindGroup) {\r\n    bindGroup.setValue('gamma', this._gamma);\r\n  }\r\n  filter(scope: PBInsideFunctionScope, type: BlitType, srcTex: PBShaderExp, srcUV: PBShaderExp, srcLayer: PBShaderExp): PBShaderExp {\r\n    const pb = scope.$builder;\r\n    return pb.pow(this.readTexel(scope, type, srcTex, srcUV, srcLayer), pb.vec4(pb.vec3(scope.gamma), 1));\r\n  }\r\n  protected calcHash(): string {\r\n    return '';\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAKM,MAAO,YAAa,SAAQ,OAAO,CAAA;AAC7B,IAAA,MAAM,CAAS;AACzB,IAAA,WAAA,CAAY,KAAa,EAAA;AACvB,QAAA,KAAK,EAAE,CAAC;AACR,QAAA,IAAI,CAAC,MAAM,GAAG,KAAK,IAAI,GAAG,CAAC;KAC5B;IACD,KAAK,CAAC,KAAoB,EAAE,IAAc,EAAA;AACxC,QAAA,MAAM,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC;AAC1B,QAAA,IAAI,EAAE,CAAC,UAAU,KAAK,UAAU,CAAC,QAAQ,EAAE;AACzC,YAAA,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACrC,SAAA;KACF;AACD,IAAA,WAAW,CAAC,SAAoB,EAAA;QAC9B,SAAS,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;KAC1C;IACD,MAAM,CAAC,KAA4B,EAAE,IAAc,EAAE,MAAmB,EAAE,KAAkB,EAAE,QAAqB,EAAA;AACjH,QAAA,MAAM,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC;AAC1B,QAAA,OAAO,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;KACvG;IACS,QAAQ,GAAA;AAChB,QAAA,OAAO,EAAE,CAAC;KACX;AACF;;;;"}