{"version":3,"file":"renderscheme.js","sources":["../../../../../libs/device/src/scene/renderers/renderscheme.ts"],"sourcesContent":["import { Device, FrameBuffer, TextureFormat } from '../../device';\r\nimport type { Camera } from '../camera';\r\nimport type { Scene } from '../scene';\r\n\r\nexport abstract class RenderScheme {\r\n  protected _device: Device;\r\n  protected _shadowMapFormat: TextureFormat;\r\n  constructor(device: Device) {\r\n    this._device = device;\r\n    this._shadowMapFormat = device.getTextureCaps().supportHalfFloatColorBuffer\r\n      ? device.getDeviceType() === 'webgl' ? TextureFormat.RGBA16F : TextureFormat.R16F\r\n      : device.getTextureCaps().supportFloatColorBuffer\r\n        ? device.getDeviceType() === 'webgl' ? TextureFormat.RGBA32F : TextureFormat.R32F\r\n        : TextureFormat.RGBA8UNORM;\r\n  }\r\n  get device(): Device {\r\n    return this._device;\r\n  }\r\n  renderScene(scene: Scene, camera: Camera): void {\r\n    scene.frameUpdate(camera);\r\n    if (camera && !scene.device.isContextLost()) {\r\n      this._renderScene(scene, camera);\r\n    }\r\n  }\r\n  renderSceneToTexture(scene: Scene, camera: Camera, frameBuffer: FrameBuffer): void {\r\n    scene.frameUpdate(camera);\r\n    if (camera && !scene.device.isContextLost()) {\r\n      this._renderSceneToTexture(scene, camera, frameBuffer);\r\n    }\r\n  }\r\n  renderSceneToCubeTexture(scene: Scene, camera: Camera, frameBuffer: FrameBuffer): void {\r\n    scene.frameUpdate(camera);\r\n    if (camera && !scene.device.isContextLost()) {\r\n      this._renderSceneToCubeTexture(scene, camera, frameBuffer);\r\n    }\r\n  }\r\n  dispose(): void {\r\n    this._dispose();\r\n  }\r\n  getShadowMapFormat(): TextureFormat {\r\n    return this._shadowMapFormat;\r\n  }\r\n  protected abstract _renderScene(scene: Scene, camera: Camera);\r\n  protected abstract _renderSceneToTexture(scene: Scene, camera: Camera, frameBuffer: FrameBuffer);\r\n  protected abstract _renderSceneToCubeTexture(scene: Scene, camera: Camera, frameBuffer: FrameBuffer);\r\n  protected abstract _dispose();\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;MAIsB,YAAY,CAAA;AACtB,IAAA,OAAO,CAAS;AAChB,IAAA,gBAAgB,CAAgB;AAC1C,IAAA,WAAA,CAAY,MAAc,EAAA;AACxB,QAAA,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,gBAAgB,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC,2BAA2B;AACzE,cAAE,MAAM,CAAC,aAAa,EAAE,KAAK,OAAO,GAAG,aAAa,CAAC,OAAO,GAAG,aAAa,CAAC,IAAI;AACjF,cAAE,MAAM,CAAC,cAAc,EAAE,CAAC,uBAAuB;AAC/C,kBAAE,MAAM,CAAC,aAAa,EAAE,KAAK,OAAO,GAAG,aAAa,CAAC,OAAO,GAAG,aAAa,CAAC,IAAI;AACjF,kBAAE,aAAa,CAAC,UAAU,CAAC;KAChC;AACD,IAAA,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,OAAO,CAAC;KACrB;IACD,WAAW,CAAC,KAAY,EAAE,MAAc,EAAA;AACtC,QAAA,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAC1B,IAAI,MAAM,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE;AAC3C,YAAA,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;AAClC,SAAA;KACF;AACD,IAAA,oBAAoB,CAAC,KAAY,EAAE,MAAc,EAAE,WAAwB,EAAA;AACzE,QAAA,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAC1B,IAAI,MAAM,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE;YAC3C,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;AACxD,SAAA;KACF;AACD,IAAA,wBAAwB,CAAC,KAAY,EAAE,MAAc,EAAE,WAAwB,EAAA;AAC7E,QAAA,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAC1B,IAAI,MAAM,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE;YAC3C,IAAI,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;AAC5D,SAAA;KACF;IACD,OAAO,GAAA;QACL,IAAI,CAAC,QAAQ,EAAE,CAAC;KACjB;IACD,kBAAkB,GAAA;QAChB,OAAO,IAAI,CAAC,gBAAgB,CAAC;KAC9B;AAKF;;;;"}